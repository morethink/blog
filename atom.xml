<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>More Think</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.morethink.cn/"/>
  <updated>2019-02-08T09:27:11.679Z</updated>
  <id>https://www.morethink.cn/</id>
  
  <author>
    <name>morethink</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Javaè§£å†³LeetCode72é¢˜ Edit Distance</title>
    <link href="https://www.morethink.cn/%E7%AE%97%E6%B3%95/Edit-Distance/"/>
    <id>https://www.morethink.cn/ç®—æ³•/Edit-Distance/</id>
    <published>2019-02-07T16:00:00.000Z</published>
    <updated>2019-02-08T09:27:11.679Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>åœ°å€ ï¼š <a href="https://leetcode.com/problems/edit-distance/description/" target="_blank" rel="noopener">https://leetcode.com/problems/edit-distance/description/</a></p><p><img src="https://images.morethink.cn/7a55770b0fb66c36ef3f3eead5dc5174.png" alt="é¢˜ç›®æè¿°" title="é¢˜ç›®æè¿°"></p><a id="more"></a><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><ul><li>ä½¿ç”¨<code>dp[i][j]</code>ç”¨æ¥è¡¨ç¤º<code>word1</code>çš„<code>0~i-1</code>ã€<code>word2</code>çš„<code>0~j-1</code>çš„æœ€å°ç¼–è¾‘è·ç¦»</li><li>æˆ‘ä»¬å¯ä»¥çŸ¥é“è¾¹ç•Œæƒ…å†µï¼š<code>dp[i][0] = i</code>ã€<code>dp[0][j] = j</code>ï¼Œä»£è¡¨ä» <code>&quot;&quot;</code> å˜ä¸º <code>dp[0~i-1]</code> æˆ– <code>dp[0][0~j-1]</code> æ‰€éœ€è¦çš„æ¬¡æ•°</li></ul><p>åŒæ—¶å¯¹äºä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ï¼Œéƒ½èƒ½åˆ†ä¸ºæœ€åä¸€ä¸ªå­—ç¬¦ç›¸ç­‰æˆ–è€…ä¸ç­‰çš„æƒ…å†µï¼š</p><ul><li>å¦‚æœ<code>word1[i-1] == word2[j-1]</code>ï¼š<code>dp[i][j] = dp[i-1][j-1]</code></li><li>å¦‚æœ<code>word1[i-1] != word2[j-1]</code>ï¼š  <ul><li>å‘word1æ’å…¥ï¼š<code>dp[i][j] = dp[i][j-1] + 1</code></li><li>ä»word1åˆ é™¤ï¼š<code>dp[i][j] = dp[i-1][j] + 1</code></li><li>æ›¿æ¢word1å…ƒç´ ï¼š<code>dp[i][j] = dp[i-1][j-1] + 1</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDistance</span><span class="params">(String word1, String word2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = word1.length();</span><br><span class="line">    <span class="keyword">int</span> m = word2.length();</span><br><span class="line">    <span class="keyword">int</span>[][] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; m + <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (word1.charAt(i - <span class="number">1</span>) == word2.charAt(j - <span class="number">1</span>)) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = Math.min(Math.min(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]), dp[i - <span class="number">1</span>][j - <span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n][m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;/a&gt;é¢˜ç›®æè¿°&lt;/h1&gt;&lt;p&gt;åœ°å€ ï¼š &lt;a href=&quot;https://leetcode.com/problems/edit-distance/description/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode.com/problems/edit-distance/description/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://images.morethink.cn/7a55770b0fb66c36ef3f3eead5dc5174.png&quot; alt=&quot;é¢˜ç›®æè¿°&quot; title=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://www.morethink.cn/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’" scheme="https://www.morethink.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>å­¦ä»¥è‡´ç”¨:Pythonçˆ¬å–å»–å¤§Pythonæ•™ç¨‹åˆ¶ä½œpdf</title>
    <link href="https://www.morethink.cn/Python/python-tutorial-pdf/"/>
    <id>https://www.morethink.cn/Python/python-tutorial-pdf/</id>
    <published>2019-01-09T16:00:00.000Z</published>
    <updated>2019-05-04T06:42:57.807Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.morethink.cn/python-tutorial-pdf.jpeg" alt="python-tutorial-pdf" title="python-tutorial-pdf"></p><p>å½“æˆ‘å­¦äº†å»–å¤§çš„Pythonæ•™ç¨‹åï¼Œæ„Ÿè§‰æ€»å¾—åšç‚¹ä»€ä¹ˆï¼Œæ­£å¥½è‡ªå·±æƒ³éšæ—¶æŸ¥é˜…ï¼Œäºæ˜¯å°±å¼€å§‹æœ‰äº†åˆ¶ä½œPDFè¿™ä¸ªæƒ³æ³•ã€‚</p><p>æƒ³è¦æŠŠæ•™ç¨‹å˜æˆPDFæœ‰ä¸‰æ­¥ï¼š</p><ol><li>å…ˆç”Ÿæˆç©ºhtmlï¼Œçˆ¬å–æ¯ä¸€ç¯‡æ•™ç¨‹æ”¾è¿›ä¸€ä¸ªæ–°ç”Ÿæˆçš„divï¼Œè¿™æ ·å°±ç”Ÿæˆäº†åŒ…å«æ‰€æœ‰æ•™ç¨‹çš„htmlæ–‡ä»¶(<code>BeautifulSoup</code>)</li><li>å°†htmlè½¬æ¢æˆpdf(<code>wkhtmltopdf</code>)</li><li>ç”±äºå»–å¤§æ˜¯å†™æ•™ç¨‹çš„ï¼Œåçˆ¬åšçš„æ¯”è¾ƒå¥½ï¼Œåœ¨çˆ¬å–çš„è¿‡ç¨‹ä¸­è¿˜éœ€è¦ä»£ç†ip(<a href="https://center.abuyun.com/login" target="_blank" rel="noopener">é˜¿å¸ƒäº‘ä»£ç†</a>)</li></ol><a id="more"></a><h1 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h1><blockquote><p><a href="http://www.crummy.com/software/BeautifulSoup/" target="_blank" rel="noopener">Beautiful Soup</a> æ˜¯ä¸€ä¸ªå¯ä»¥ä»HTMLæˆ–XMLæ–‡ä»¶ä¸­æå–æ•°æ®çš„Pythonåº“.å®ƒèƒ½å¤Ÿé€šè¿‡ä½ å–œæ¬¢çš„è½¬æ¢å™¨å®ç°æƒ¯ç”¨çš„æ–‡æ¡£å¯¼èˆª,æŸ¥æ‰¾,ä¿®æ”¹æ–‡æ¡£çš„æ–¹å¼.Beautiful Soupä¼šå¸®ä½ èŠ‚çœæ•°å°æ—¶ç”šè‡³æ•°å¤©çš„å·¥ä½œæ—¶é—´.</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install BeautifulSoup4</span><br></pre></td></tr></table></figure><h2 id="å¼€å§‹ä½¿ç”¨"><a href="#å¼€å§‹ä½¿ç”¨" class="headerlink" title="å¼€å§‹ä½¿ç”¨"></a>å¼€å§‹ä½¿ç”¨</h2><p>å°†ä¸€æ®µæ–‡æ¡£ä¼ å…¥ <code>BeautifulSoup</code> çš„æ„é€ æ–¹æ³•,å°±èƒ½å¾—åˆ°ä¸€ä¸ªæ–‡æ¡£çš„å¯¹è±¡, å¯ä»¥ä¼ å…¥ä¸€æ®µå­—ç¬¦ä¸²æˆ–ä¸€ä¸ªæ–‡ä»¶å¥æŸ„.</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(open(<span class="string">"index.html"</span>))</span><br><span class="line">soup = BeautifulSoup(<span class="string">"&lt;html&gt;data&lt;/html&gt;"</span>)</span><br></pre></td></tr></table></figure></p><ul><li>é¦–å…ˆ,æ–‡æ¡£è¢«è½¬æ¢æˆUnicode,å¹¶ä¸”HTMLçš„å®ä¾‹éƒ½è¢«è½¬æ¢æˆUnicodeç¼–ç .</li><li>ç„¶å,Beautiful Soupé€‰æ‹©æœ€åˆé€‚çš„è§£æå™¨æ¥è§£æè¿™æ®µæ–‡æ¡£,å¦‚æœæ‰‹åŠ¨æŒ‡å®šè§£æå™¨é‚£ä¹ˆBeautiful Soupä¼šé€‰æ‹©æŒ‡å®šçš„è§£æå™¨æ¥è§£ææ–‡æ¡£.</li></ul><h2 id="å¯¹è±¡çš„ç§ç±»"><a href="#å¯¹è±¡çš„ç§ç±»" class="headerlink" title="å¯¹è±¡çš„ç§ç±»"></a>å¯¹è±¡çš„ç§ç±»</h2><p><code>Beautiful Soup</code> å°†å¤æ‚ <code>HTML</code> æ–‡æ¡£è½¬æ¢æˆä¸€ä¸ªå¤æ‚çš„æ ‘å½¢ç»“æ„,æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ <code>Python</code> å¯¹è±¡,æ‰€æœ‰å¯¹è±¡å¯ä»¥å½’çº³ä¸º 4 ç§: <code>Tag , NavigableString , BeautifulSoup , Comment .</code></p><ul><li><code>Tag</code>ï¼šé€šä¿—ç‚¹è®²å°±æ˜¯ <code>HTML</code> ä¸­çš„ä¸€ä¸ªä¸ªæ ‡ç­¾ï¼Œç±»ä¼¼ <code>divï¼Œp</code>ã€‚</li><li><code>NavigableString</code>ï¼šè·å–æ ‡ç­¾å†…éƒ¨çš„æ–‡å­—ï¼Œå¦‚ï¼Œ<code>soup.p.string</code>ã€‚</li><li><code>BeautifulSoup</code>ï¼šè¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£çš„å…¨éƒ¨å†…å®¹ã€‚</li><li><code>Commentï¼šComment</code> å¯¹è±¡æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ <code>NavigableString</code> å¯¹è±¡ï¼Œå…¶è¾“å‡ºçš„å†…å®¹ä¸åŒ…æ‹¬æ³¨é‡Šç¬¦å·.</li></ul><h2 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h2><p><code>Tag</code>å°±æ˜¯<code>html</code>ä¸­çš„ä¸€ä¸ªæ ‡ç­¾ï¼Œç”¨<code>BeautifulSoup</code>å°±èƒ½è§£æå‡ºæ¥<code>Tag</code>çš„å…·ä½“å†…å®¹ï¼Œå…·ä½“çš„æ ¼å¼ä¸º<code>soup.name</code>,å…¶ä¸­<code>name</code>æ˜¯<code>html</code>ä¸‹çš„æ ‡ç­¾ï¼Œå…·ä½“å®ä¾‹å¦‚ä¸‹ï¼š</p><ul><li><p><code>print soup.title</code>è¾“å‡º<code>title</code>æ ‡ç­¾ä¸‹çš„å†…å®¹ï¼ŒåŒ…æ‹¬æ­¤æ ‡ç­¾ï¼Œè¿™ä¸ªå°†ä¼šè¾“å‡º</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>print soup.head</code>è¾“å‡º<code>head</code>æ ‡ç­¾ä¸‹çš„å†…å®¹</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>The Dormouse's story<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>å¦‚æœ Tag å¯¹è±¡è¦è·å–çš„æ ‡ç­¾æœ‰å¤šä¸ªçš„è¯ï¼Œå®ƒåªä¼šè¿”å›æ‰€ä»¥å†…å®¹ä¸­ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ ‡ç­¾</strong>ã€‚</p><h3 id="Tag-å±æ€§"><a href="#Tag-å±æ€§" class="headerlink" title="Tag å±æ€§"></a>Tag å±æ€§</h3><p>æ¯ä¸ª <code>Tag</code> æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ <code>name</code> å’Œ <code>attrs</code>ï¼š</p><ul><li><code>name</code>ï¼šå¯¹äº<code>Tag</code>ï¼Œå®ƒçš„<code>name</code>å°±æ˜¯å…¶æœ¬èº«ï¼Œå¦‚<code>soup.p.name</code>å°±æ˜¯<code>p</code></li><li><code>attrs</code>æ˜¯ä¸€ä¸ªå­—å…¸ç±»å‹çš„ï¼Œå¯¹åº”çš„æ˜¯å±æ€§-å€¼ï¼Œå¦‚<code>print soup.p.attrs</code>,è¾“å‡ºçš„å°±æ˜¯<code>{&#39;class&#39;: [&#39;title&#39;], &#39;name&#39;: &#39;dromouse&#39;}</code>,å½“ç„¶ä½ ä¹Ÿå¯ä»¥å¾—åˆ°å…·ä½“çš„å€¼ï¼Œå¦‚<code>print soup.p.attrs[&#39;class&#39;]</code>,è¾“å‡ºçš„å°±æ˜¯<code>[title]</code>æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„ç±»å‹ï¼Œå› ä¸ºä¸€ä¸ªå±æ€§å¯èƒ½å¯¹åº”å¤šä¸ªå€¼,å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡getæ–¹æ³•å¾—åˆ°å±æ€§çš„ï¼Œå¦‚ï¼š<code>print soup.p.get(&#39;class&#39;)</code>ã€‚è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨<code>print soup.p[&#39;class&#39;]</code></li></ul><h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p><code>get</code>æ–¹æ³•ç”¨äºå¾—åˆ°æ ‡ç­¾ä¸‹çš„å±æ€§å€¼ï¼Œæ³¨æ„è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œåœ¨è®¸å¤šåœºåˆéƒ½èƒ½ç”¨åˆ°ï¼Œæ¯”å¦‚ä½ è¦å¾—åˆ°<code>&lt;img src=&quot;#&quot;&gt;</code>æ ‡ç­¾ä¸‹çš„å›¾åƒ<code>url</code>,é‚£ä¹ˆå°±å¯ä»¥ç”¨<code>soup.img.get(&#39;src&#39;)</code>,å…·ä½“è§£æå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¾—åˆ°ç¬¬ä¸€ä¸ªpæ ‡ç­¾ä¸‹çš„srcå±æ€§</span></span><br><span class="line"><span class="keyword">print</span> soup.p.get(<span class="string">"class"</span>)</span><br></pre></td></tr></table></figure><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>å¾—åˆ°æ ‡ç­¾ä¸‹çš„æ–‡æœ¬å†…å®¹ï¼Œåªæœ‰åœ¨æ­¤æ ‡ç­¾ä¸‹æ²¡æœ‰å­æ ‡ç­¾ï¼Œæˆ–è€…åªæœ‰ä¸€ä¸ªå­æ ‡ç­¾çš„æƒ…å†µä¸‹æ‰èƒ½è¿”å›å…¶ä¸­çš„å†…å®¹ï¼Œå¦åˆ™è¿”å›çš„æ˜¯<code>None</code>å…·ä½“å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸Šé¢çš„ä¸€æ®µæ–‡æœ¬ä¸­pæ ‡ç­¾æ²¡æœ‰å­æ ‡ç­¾ï¼Œå› æ­¤èƒ½å¤Ÿæ­£ç¡®è¿”å›æ–‡æœ¬çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">print</span> soup.p.string</span><br><span class="line"><span class="comment"># è¿™é‡Œå¾—åˆ°çš„å°±æ˜¯None,å› ä¸ºè¿™é‡Œçš„htmlä¸­æœ‰å¾ˆå¤šçš„å­æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">print</span> soup.html.string</span><br></pre></td></tr></table></figure><h3 id="get-text"><a href="#get-text" class="headerlink" title="get_text()"></a><code>get_text()</code></h3><p><strong>å¯ä»¥è·å¾—ä¸€ä¸ªæ ‡ç­¾ä¸­çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼ŒåŒ…æ‹¬å­å­™èŠ‚ç‚¹çš„å†…å®¹ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•</strong>ã€‚</p><h2 id="æœç´¢æ–‡æ¡£æ ‘"><a href="#æœç´¢æ–‡æ¡£æ ‘" class="headerlink" title="æœç´¢æ–‡æ¡£æ ‘"></a>æœç´¢æ–‡æ¡£æ ‘</h2><p>BeautifulSoup ä¸»è¦ç”¨æ¥éå†å­èŠ‚ç‚¹åŠå­èŠ‚ç‚¹çš„å±æ€§ï¼Œé€šè¿‡<code>Tag</code>å–å±æ€§çš„æ–¹å¼åªèƒ½è·å¾—å½“å‰æ–‡æ¡£ä¸­çš„ç¬¬ä¸€ä¸ª tagï¼Œä¾‹å¦‚ï¼Œ<code>soup.p</code>ã€‚å¦‚æœæƒ³è¦å¾—åˆ°æ‰€æœ‰çš„<code>&lt;p&gt;</code> æ ‡ç­¾,æˆ–æ˜¯é€šè¿‡åå­—å¾—åˆ°æ¯”ä¸€ä¸ª tag æ›´å¤šçš„å†…å®¹çš„æ—¶å€™,å°±éœ€è¦ç”¨åˆ° find_all()<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">find_all(name, attrs, recursive, text, **kwargs )</span><br></pre></td></tr></table></figure></p><p>find_allæ˜¯ç”¨äºæœç´¢èŠ‚ç‚¹ä¸­æ‰€æœ‰ç¬¦åˆè¿‡æ»¤æ¡ä»¶çš„èŠ‚ç‚¹ã€‚</p><p><strong>nameå‚æ•°</strong>ï¼šæ˜¯Tagçš„åå­—ï¼Œå¦‚p,div,title<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. èŠ‚ç‚¹å</span></span><br><span class="line">print(soup.find_all(<span class="string">'p'</span>))</span><br><span class="line"><span class="comment"># 2. æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">print(soup.find_all(re.compile(<span class="string">'^p'</span>)))</span><br><span class="line"><span class="comment"># 3. åˆ—è¡¨  </span></span><br><span class="line">print(soup.find_all([<span class="string">'p'</span>, <span class="string">'a'</span>]))</span><br></pre></td></tr></table></figure></p><p>å¦å¤– attrs å‚æ•°å¯ä»¥ä¹Ÿä½œä¸ºè¿‡æ»¤æ¡ä»¶æ¥è·å–å†…å®¹ï¼Œè€Œ limit å‚æ•°æ˜¯é™åˆ¶è¿”å›çš„æ¡æ•°ã€‚</p><h2 id="CSS-é€‰æ‹©å™¨"><a href="#CSS-é€‰æ‹©å™¨" class="headerlink" title="CSS é€‰æ‹©å™¨"></a>CSS é€‰æ‹©å™¨</h2><p>ä»¥ CSS è¯­æ³•ä¸ºåŒ¹é…æ ‡å‡†æ‰¾åˆ° Tagã€‚åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸º<code>select()</code>ï¼Œè¿”å›ç±»å‹æ˜¯ listã€‚å®ƒçš„å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. é€šè¿‡ tag æ ‡ç­¾æŸ¥æ‰¾</span></span><br><span class="line">print(soup.select(head))</span><br><span class="line"><span class="comment"># 2. é€šè¿‡ id æŸ¥æ‰¾</span></span><br><span class="line">print(soup.select(<span class="string">'#link1'</span>))</span><br><span class="line"><span class="comment"># 3. é€šè¿‡ class æŸ¥æ‰¾</span></span><br><span class="line">print(soup.select(<span class="string">'.sister'</span>))</span><br><span class="line"><span class="comment"># 4. é€šè¿‡å±æ€§æŸ¥æ‰¾</span></span><br><span class="line">print(soup.select(<span class="string">'p[name=dromouse]'</span>))</span><br><span class="line"><span class="comment"># 5. ç»„åˆæŸ¥æ‰¾</span></span><br><span class="line">print(soup.select(<span class="string">"body p"</span>))</span><br></pre></td></tr></table></figure><h1 id="wkhtmltopdf"><a href="#wkhtmltopdf" class="headerlink" title="wkhtmltopdf"></a>wkhtmltopdf</h1><blockquote><ul><li>wkhtmltopdfä¸»è¦ç”¨äºHTMLç”ŸæˆPDFã€‚</li><li>pdfkitæ˜¯åŸºäºwkhtmltopdfçš„pythonå°è£…ï¼Œæ”¯æŒURLï¼Œæœ¬åœ°æ–‡ä»¶ï¼Œæ–‡æœ¬å†…å®¹åˆ°PDFçš„è½¬æ¢ï¼Œå…¶æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨wkhtmltopdfå‘½ä»¤ã€‚</li></ul></blockquote><h2 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å…ˆå®‰è£…wkhtmltopdfï¼Œå†å®‰è£…pdfkitã€‚</p><ol><li><a href="https://wkhtmltopdf.org/downloads.html" target="_blank" rel="noopener">https://wkhtmltopdf.org/downloads.html</a></li><li>pdfkit <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install pdfkit</span><br></pre></td></tr></table></figure></li></ol><h2 id="è½¬æ¢url-file-string"><a href="#è½¬æ¢url-file-string" class="headerlink" title="è½¬æ¢url/file/string"></a>è½¬æ¢url/file/string</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pdfkit</span><br><span class="line"></span><br><span class="line">pdfkit.from_url(<span class="string">'http://google.com'</span>, <span class="string">'out.pdf'</span>)</span><br><span class="line">pdfkit.from_file(<span class="string">'index.html'</span>, <span class="string">'out.pdf'</span>)</span><br><span class="line">pdfkit.from_string(<span class="string">'Hello!'</span>, <span class="string">'out.pdf'</span>)</span><br></pre></td></tr></table></figure><h2 id="è½¬æ¢urlæˆ–è€…æ–‡ä»¶ååˆ—è¡¨"><a href="#è½¬æ¢urlæˆ–è€…æ–‡ä»¶ååˆ—è¡¨" class="headerlink" title="è½¬æ¢urlæˆ–è€…æ–‡ä»¶ååˆ—è¡¨"></a>è½¬æ¢urlæˆ–è€…æ–‡ä»¶ååˆ—è¡¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pdfkit.from_url([<span class="string">'google.com'</span>, <span class="string">'baidu.com'</span>], <span class="string">'out.pdf'</span>)</span><br><span class="line">pdfkit.from_file([<span class="string">'file1.html'</span>, <span class="string">'file2.html'</span>], <span class="string">'out.pdf'</span>)</span><br></pre></td></tr></table></figure><h2 id="è½¬æ¢æ‰“å¼€æ–‡ä»¶"><a href="#è½¬æ¢æ‰“å¼€æ–‡ä»¶" class="headerlink" title="è½¬æ¢æ‰“å¼€æ–‡ä»¶"></a>è½¬æ¢æ‰“å¼€æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'file.html'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pdfkit.from_file(f, <span class="string">'out.pdf'</span>)</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰è®¾ç½®"><a href="#è‡ªå®šä¹‰è®¾ç½®" class="headerlink" title="è‡ªå®šä¹‰è®¾ç½®"></a>è‡ªå®šä¹‰è®¾ç½®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">options = &#123;</span><br><span class="line">    <span class="string">'page-size'</span>: <span class="string">'Letter'</span>,</span><br><span class="line">    <span class="string">'margin-top'</span>: <span class="string">'0.75in'</span>,</span><br><span class="line">    <span class="string">'margin-right'</span>: <span class="string">'0.75in'</span>,</span><br><span class="line">    <span class="string">'margin-bottom'</span>: <span class="string">'0.75in'</span>,</span><br><span class="line">    <span class="string">'margin-left'</span>: <span class="string">'0.75in'</span>,</span><br><span class="line">    <span class="string">'encoding'</span>: <span class="string">"UTF-8"</span>,</span><br><span class="line">    <span class="string">'custom-header'</span> : [</span><br><span class="line">        (<span class="string">'Accept-Encoding'</span>, <span class="string">'gzip'</span>)</span><br><span class="line">    ]</span><br><span class="line">    <span class="string">'cookie'</span>: [</span><br><span class="line">        (<span class="string">'cookie-name1'</span>, <span class="string">'cookie-value1'</span>),</span><br><span class="line">        (<span class="string">'cookie-name2'</span>, <span class="string">'cookie-value2'</span>),</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'no-outline'</span>: <span class="keyword">None</span>,</span><br><span class="line">    <span class="string">'outline-depth'</span>: <span class="number">10</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pdfkit.from_url(<span class="string">'http://google.com'</span>, <span class="string">'out.pdf'</span>, options=options)</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨ä»£ç†ip"><a href="#ä½¿ç”¨ä»£ç†ip" class="headerlink" title="ä½¿ç”¨ä»£ç†ip"></a>ä½¿ç”¨ä»£ç†ip</h1><p>çˆ¬å–åå‡ ç¯‡æ•™ç¨‹ä¹‹åè§¦å‘äº†è¿™ä¸ªé”™è¯¯ï¼š<br><img src="https://images.morethink.cn/a7fa858c35a52d0bd1ed89a611546ef1.png" alt="503" title="503"></p><p>çœ‹æ¥å»–å¤§çš„åçˆ¬è™«åšçš„å¾ˆå¥½ï¼Œäºæ˜¯åªå¥½ä½¿ç”¨ä»£ç†ipäº†ï¼Œå°è¯•äº†å…è´¹çš„<a href="https://www.xicidaili.com/" target="_blank" rel="noopener">è¥¿åˆºå…è´¹ä»£ç†</a>åï¼Œæœ€åé€‰æ‹©äº†ä»˜è´¹çš„ <a href="http://www.moguproxy.com/" target="_blank" rel="noopener">è˜‘è‡ä»£ç†</a> ï¼Œæ„Ÿè§‰å“åº”é€Ÿåº¦å’Œç¨³å®šæ€§è¿˜OKã€‚</p><h1 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h1><p>è¿è¡Œè¿‡ç¨‹æˆªå›¾ï¼š</p><p><img src="https://images.morethink.cn/ad8217afdd1d38c665a1a0341ade499e.png" alt="è¿è¡Œè¿‡ç¨‹" title="è¿è¡Œè¿‡ç¨‹"></p><p>ç”Ÿæˆçš„æ•ˆæœå›¾ï¼š<br><img src="https://images.morethink.cn/3b24e8815b5e9ac26184a3f1ab96bd1d.png" alt="æ•ˆæœå›¾" title="æ•ˆæœå›¾"></p><p>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pdfkit</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ é˜¿å¸ƒäº‘ä»£ç†</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_soup</span><span class="params">(target_url)</span>:</span></span><br><span class="line">    proxy_host = <span class="string">"http-dyn.abuyun.com"</span></span><br><span class="line">    proxy_port = <span class="string">"9020"</span></span><br><span class="line">    proxy_user = <span class="string">"HKQL6V46321071VD"</span></span><br><span class="line">    proxy_pass = <span class="string">"1759D9C2F6DE34B3"</span></span><br><span class="line">    proxy_meta = <span class="string">"http://%(user)s:%(pass)s@%(host)s:%(port)s"</span> % &#123;</span><br><span class="line">        <span class="string">"host"</span>: proxy_host,</span><br><span class="line">        <span class="string">"port"</span>: proxy_port,</span><br><span class="line">        <span class="string">"user"</span>: proxy_user,</span><br><span class="line">        <span class="string">"pass"</span>: proxy_pass,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    proxies = &#123;</span><br><span class="line">        <span class="string">"http"</span>: proxy_meta,</span><br><span class="line">        <span class="string">"https"</span>: proxy_meta,</span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;<span class="string">'User-Agent'</span>:</span><br><span class="line">                   <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'</span>&#125;</span><br><span class="line">    flag = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">while</span> flag:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.get(target_url, proxies=proxies, headers=headers)</span><br><span class="line">            flag = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            time.sleep(<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line">    soup = BeautifulSoup(resp.text, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="keyword">return</span> soup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_toc</span><span class="params">(url)</span>:</span></span><br><span class="line">    soup = get_soup(url)</span><br><span class="line">    toc = soup.select(<span class="string">"#x-wiki-index a"</span>)</span><br><span class="line">    print(toc[<span class="number">0</span>][<span class="string">'href'</span>])</span><br><span class="line">    <span class="keyword">return</span> toc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â¬‡ï¸æ•™ç¨‹html</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_html</span><span class="params">(url, depth)</span>:</span></span><br><span class="line">    soup = get_soup(url)</span><br><span class="line">    <span class="comment"># å¤„ç†ç›®å½•</span></span><br><span class="line">    <span class="keyword">if</span> int(depth) &lt;= <span class="number">1</span>:</span><br><span class="line">        depth = <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">elif</span> int(depth) &gt;= <span class="number">2</span>:</span><br><span class="line">        depth = <span class="string">'2'</span></span><br><span class="line">    title = soup.select(<span class="string">"#x-content h4"</span>)[<span class="number">0</span>]</span><br><span class="line">    new_a = soup.new_tag(<span class="string">'a'</span>, href=url)</span><br><span class="line">    new_a.string = title.string</span><br><span class="line">    new_title = soup.new_tag(<span class="string">'h'</span> + depth)</span><br><span class="line">    new_title.append(new_a)</span><br><span class="line">    print(new_title)</span><br><span class="line">    <span class="comment"># åŠ è½½å›¾ç‰‡</span></span><br><span class="line">    images = soup.find_all(<span class="string">'img'</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> images:</span><br><span class="line">        x[<span class="string">'src'</span>] = <span class="string">'https://static.liaoxuefeng.com/'</span> + x[<span class="string">'data-src'</span>]</span><br><span class="line">    <span class="comment"># å°†bilibili iframe è§†é¢‘æ›´æ¢ä¸ºé“¾æ¥åœ°å€</span></span><br><span class="line">    iframes = soup.find_all(<span class="string">'iframe'</span>, src=re.compile(<span class="string">"bilibili"</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iframes:</span><br><span class="line">        x[<span class="string">'src'</span>] = <span class="string">"http:"</span> + x[<span class="string">'src'</span>]</span><br><span class="line">        a_tag = soup.new_tag(<span class="string">"a"</span>, href=x[<span class="string">'src'</span>])</span><br><span class="line">        a_tag.string = <span class="string">"vide play:"</span> + x[<span class="string">'src'</span>]</span><br><span class="line">        x.replace_with(a_tag)</span><br><span class="line"></span><br><span class="line">    div_content = soup.find(<span class="string">'div'</span>, class_=<span class="string">'x-wiki-content'</span>)</span><br><span class="line">    <span class="keyword">return</span> new_title, div_content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf</span><span class="params">(template)</span>:</span></span><br><span class="line">    html_file = <span class="string">"python-tutorial-pdf.html"</span></span><br><span class="line">    <span class="keyword">with</span> open(html_file, mode=<span class="string">"w"</span>) <span class="keyword">as</span> code:</span><br><span class="line">        code.write(str(template))</span><br><span class="line">    pdfkit.from_file(html_file, <span class="string">'python-tutorial-pdf.pdf'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># html æ¨¡æ¿</span></span><br><span class="line">    template = BeautifulSoup(</span><br><span class="line">        <span class="string">'&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;link rel="stylesheet" href="https://cdn.liaoxuefeng.com/cdn/static/themes/default/css/all.css?v=bc43d83"&gt; &lt;script src="https://cdn.liaoxuefeng.com/cdn/static/themes/default/js/all.js?v=bc43d83"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;/body&gt; &lt;/html&gt;'</span>,</span><br><span class="line">        <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># æ•™ç¨‹ç›®å½•</span></span><br><span class="line">    toc = get_toc(<span class="string">'https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000'</span>)</span><br><span class="line">    <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(toc):</span><br><span class="line">        url = <span class="string">'https://www.liaoxuefeng.com'</span> + x[<span class="string">'href'</span>]</span><br><span class="line">        <span class="comment"># â¬‡ï¸æ•™ç¨‹html</span></span><br><span class="line">        content = download_html(url, x.parent[<span class="string">'depth'</span>])</span><br><span class="line">        <span class="comment"># å¾€templateæ·»åŠ æ–°çš„æ•™ç¨‹</span></span><br><span class="line">        new_div = template.new_tag(<span class="string">'div'</span>, id=i)</span><br><span class="line">        template.body.insert(<span class="number">3</span> + i, new_div)</span><br><span class="line">        new_div.insert(<span class="number">3</span>, content[<span class="number">0</span>])</span><br><span class="line">        new_div.insert(<span class="number">3</span>, content[<span class="number">1</span>])</span><br><span class="line">        time.sleep(<span class="number">0.4</span>)</span><br><span class="line">    convert_pdf(template)</span><br></pre></td></tr></table></figure></p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://beautifulsoup.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">Beautiful Soup æ–‡æ¡£</a></li><li><a href="https://www.jianshu.com/p/4d65857ffe5e" target="_blank" rel="noopener">HTML è½¬ PDF ä¹‹ wkhtmltopdf å·¥å…·ç²¾è®²</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://images.morethink.cn/python-tutorial-pdf.jpeg&quot; alt=&quot;python-tutorial-pdf&quot; title=&quot;python-tutorial-pdf&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘å­¦äº†å»–å¤§çš„Pythonæ•™ç¨‹åï¼Œæ„Ÿè§‰æ€»å¾—åšç‚¹ä»€ä¹ˆï¼Œæ­£å¥½è‡ªå·±æƒ³éšæ—¶æŸ¥é˜…ï¼Œäºæ˜¯å°±å¼€å§‹æœ‰äº†åˆ¶ä½œPDFè¿™ä¸ªæƒ³æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦æŠŠæ•™ç¨‹å˜æˆPDFæœ‰ä¸‰æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆç”Ÿæˆç©ºhtmlï¼Œçˆ¬å–æ¯ä¸€ç¯‡æ•™ç¨‹æ”¾è¿›ä¸€ä¸ªæ–°ç”Ÿæˆçš„divï¼Œè¿™æ ·å°±ç”Ÿæˆäº†åŒ…å«æ‰€æœ‰æ•™ç¨‹çš„htmlæ–‡ä»¶(&lt;code&gt;BeautifulSoup&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;å°†htmlè½¬æ¢æˆpdf(&lt;code&gt;wkhtmltopdf&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;ç”±äºå»–å¤§æ˜¯å†™æ•™ç¨‹çš„ï¼Œåçˆ¬åšçš„æ¯”è¾ƒå¥½ï¼Œåœ¨çˆ¬å–çš„è¿‡ç¨‹ä¸­è¿˜éœ€è¦ä»£ç†ip(&lt;a href=&quot;https://center.abuyun.com/login&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é˜¿å¸ƒäº‘ä»£ç†&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Python" scheme="https://www.morethink.cn/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>puppeteeræˆªå›¾</title>
    <link href="https://www.morethink.cn/%E5%B7%A5%E5%85%B7/puppeteer-screenshot/"/>
    <id>https://www.morethink.cn/å·¥å…·/puppeteer-screenshot/</id>
    <published>2019-01-08T16:00:00.000Z</published>
    <updated>2019-01-09T13:09:39.906Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.morethink.cn/puppeteer.jpg" alt="puppeteer" title="puppeteer"></p><p>puppeteeræ˜¯è°·æ­Œå®˜æ–¹å‡ºå“çš„ä¸€ä¸ªé€šè¿‡ <a href="https://chromedevtools.github.io/devtools-protocol/" target="_blank" rel="noopener">DevTools</a> åè®®æ§åˆ¶ headless Chrome çš„Nodeåº“ã€‚å¯ä»¥é€šè¿‡Puppeteerçš„æä¾›çš„apiç›´æ¥æ§åˆ¶Chromeæ¨¡æ‹Ÿå¤§éƒ¨åˆ†ç”¨æˆ·æ“ä½œæ¥è¿›è¡ŒUI Testæˆ–è€…ä½œä¸ºçˆ¬è™«è®¿é—®é¡µé¢æ¥æ”¶é›†æ•°æ®ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ç›´æ¥è¿è¡Œå®‰è£…å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install puppeteer</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°æ— æ³•å®‰è£…çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æ·˜å®é•œåƒã€‚</p><a id="more"></a><h1 id="puppeteerå®ç°æ»‘åŠ¨æˆªå›¾"><a href="#puppeteerå®ç°æ»‘åŠ¨æˆªå›¾" class="headerlink" title="puppeteerå®ç°æ»‘åŠ¨æˆªå›¾"></a>puppeteerå®ç°æ»‘åŠ¨æˆªå›¾</h1><p>åœ¨æˆ‘ puppeteer ä½¿ç”¨æˆªå…¨å±çš„è¿‡ç¨‹ä¸­å‘ç°æœ‰äº›å›¾ç‰‡æ— æ³•æˆªå–åˆ°ï¼Œè€Œå®é™…ä¸Šæ˜¯å› ä¸ºæœ‰äº›å›¾ç‰‡æ˜¯æ‡’åŠ è½½çš„ï¼Œå¦‚æœä½ æ²¡æœ‰æ»‘åŠ¨åˆ°å›¾ç‰‡çš„ä½ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªå›¾ç‰‡æ˜¯ä¸ä¼šåŠ è½½ã€‚</p><p>ç°åœ¨æˆ‘çš„æ–¹å¼æ˜¯é‡‡ç”¨æ¨¡æ‹Ÿæµè§ˆå™¨æ»šåŠ¨æ¡æ»‘åŠ¨çš„æ–¹å¼æ»‘åŠ¨åº•éƒ¨æ¥ä½¿å›¾ç‰‡åŠ è½½å‡ºæ¥ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123;</span><br><span class="line">        headless: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://www.cnblogs.com/morethink/p/6525216.html'</span>);</span><br><span class="line">    <span class="keyword">await</span> page.setViewport(&#123;</span><br><span class="line">        width: <span class="number">1200</span>,</span><br><span class="line">        height: <span class="number">800</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> autoScroll(page);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;</span><br><span class="line">        path: <span class="string">'1.png'</span>,</span><br><span class="line">        fullPage: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">autoScroll</span>(<span class="params">page</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> page.evaluate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> totalHeight = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">var</span> distance = <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">var</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> scrollHeight = <span class="built_in">document</span>.body.scrollHeight;</span><br><span class="line">                <span class="built_in">window</span>.scrollBy(<span class="number">0</span>, distance);</span><br><span class="line">                totalHeight += distance;</span><br><span class="line">                <span class="keyword">if</span> (totalHeight &gt;= scrollHeight) &#123;</span><br><span class="line">                    clearInterval(timer);</span><br><span class="line">                    resolve();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">100</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://dev.tencent.com/u/morethink/p/images/git/raw/master/puppeteer-screenshot.gif" alt="puppeteer-screenshot" title="puppeteer-screenshot"></p><h1 id="puppeteer-å®ç°-html-element-æˆªå›¾"><a href="#puppeteer-å®ç°-html-element-æˆªå›¾" class="headerlink" title="puppeteer å®ç° html element æˆªå›¾"></a>puppeteer å®ç° html element æˆªå›¾</h1><p>åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬åªæƒ³è¦é’ˆå¯¹htmlçš„æŸä¸ªä½ç½®è¿›è¡Œæˆªå›¾è€Œä¸æ˜¯é’ˆå¯¹é¡µé¢æˆªå…¨å±ã€‚</p><p>puppeteeræä¾›äº†ElementHandle.screenshot æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å‚æ•°å’Œpage.screenshot ä¸€æ ·ã€‚è€ŒElementHandle å¯¹è±¡æ˜¯é¡µé¢å†…çš„Domå¯¹è±¡ã€‚å¯ä»¥å¸®åŠ©æˆ‘å¯¹ html elementè¿›è¡Œæˆªå›¾ã€‚è¿™æ ·çš„è¯ä½ æƒ³æˆªå–é¡µé¢çš„å“ªéƒ¨åˆ†å°±æˆªå–é¡µé¢çš„å“ªéƒ¨åˆ†ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123;</span><br><span class="line">        headless: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://www.cnblogs.com/morethink/p/6525216.html'</span>);</span><br><span class="line">    <span class="keyword">await</span> page.setViewport(&#123;</span><br><span class="line">        width: <span class="number">1200</span>,</span><br><span class="line">        height: <span class="number">800</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//è·å–é¡µé¢Domå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> body = <span class="keyword">await</span> page.$(<span class="string">'#cnblogs_post_body'</span>);</span><br><span class="line">    <span class="comment">//è°ƒç”¨é¡µé¢å†…Domå¯¹è±¡çš„ screenshot æ–¹æ³•è¿›è¡Œæˆªå›¾</span></span><br><span class="line">    <span class="keyword">await</span> body.screenshot(&#123;</span><br><span class="line">        path: <span class="string">'2.png'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://github.com/GoogleChrome/puppeteer/blob/v1.11.0/docs/api.md#elementhandlescreenshotoptions" target="_blank" rel="noopener">https://github.com/GoogleChrome/puppeteer/blob/v1.11.0/docs/api.md#elementhandlescreenshotoptions</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://images.morethink.cn/puppeteer.jpg&quot; alt=&quot;puppeteer&quot; title=&quot;puppeteer&quot;&gt;&lt;/p&gt;
&lt;p&gt;puppeteeræ˜¯è°·æ­Œå®˜æ–¹å‡ºå“çš„ä¸€ä¸ªé€šè¿‡ &lt;a href=&quot;https://chromedevtools.github.io/devtools-protocol/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DevTools&lt;/a&gt; åè®®æ§åˆ¶ headless Chrome çš„Nodeåº“ã€‚å¯ä»¥é€šè¿‡Puppeteerçš„æä¾›çš„apiç›´æ¥æ§åˆ¶Chromeæ¨¡æ‹Ÿå¤§éƒ¨åˆ†ç”¨æˆ·æ“ä½œæ¥è¿›è¡ŒUI Testæˆ–è€…ä½œä¸ºçˆ¬è™«è®¿é—®é¡µé¢æ¥æ”¶é›†æ•°æ®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h1&gt;&lt;p&gt;ç›´æ¥è¿è¡Œå®‰è£…å‘½ä»¤ï¼š&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install puppeteer&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœå‡ºç°æ— æ³•å®‰è£…çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æ·˜å®é•œåƒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>Python è±†ç“£é¡¶å¸–</title>
    <link href="https://www.morethink.cn/Python/douban-ding/"/>
    <id>https://www.morethink.cn/Python/douban-ding/</id>
    <published>2018-12-30T08:17:00.000Z</published>
    <updated>2019-01-06T09:32:34.372Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.morethink.cn/278d71ed0f07f6d1d72a8afa76039cc2.png" alt="" title="ğŸ†™ğŸ†™"></p><p>ç”±äºåœ¨è±†ç“£å‘äº†ä¸ªç§Ÿæˆ¿å¸–å­ï¼Œå‘ç°å¾ˆå¿«å°±è¢«å…¶ä»–çš„å¸–å­æ·¹æ²¡ï¼Œä½†æ˜¯æ‰‹åŠ¨é¡¶å¸–å®åœ¨å¤ªç´¯ï¼ŒğŸ˜­ï¼Œæ‰€ä»¥æƒ³é€šè¿‡è‡ªåŠ¨é¡¶å¸–çš„æ–¹å¼æ¥è§£æ”¾åŒæ‰‹ï¼</p><a id="more"></a><h1 id="è¯„è®ºè¯·æ±‚åˆ†æ"><a href="#è¯„è®ºè¯·æ±‚åˆ†æ" class="headerlink" title="è¯„è®ºè¯·æ±‚åˆ†æ"></a>è¯„è®ºè¯·æ±‚åˆ†æ</h1><p>é€šè¿‡Chrome network åˆ†æ</p><p><img src="https://images.morethink.cn/4220f35fed72284a44099dfcf27028d8.png" alt="" title="add_comment"></p><ul><li>è¯„è®ºurlæ˜¯<code>https://www.douban.com/group/topic/129122199/add_comment</code></li><li>éœ€è¦å¸¦5ä¸ªå‚æ•°ï¼Œå…¶ä¸­ ck æ˜¯ cookie é‡Œé¢çš„å€¼ï¼Œrv_comment æ˜¯ è¯„è®º</li><li>è¿”å›302ä»£è¡¨é‡å®šå‘</li></ul><p>Python æ¨¡æ‹Ÿè¯·æ±‚ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è±†ç“£å…·ä½“å¸–å­</span></span><br><span class="line">url = <span class="string">"https://www.douban.com/group/topic/129122199/"</span></span><br><span class="line"><span class="comment"># è±†ç“£å…·ä½“å¸–å­å›å¤çš„æ¥å£ï¼Œæ ¼å¼æ˜¯å¸–å­é“¾æ¥+/add_comment</span></span><br><span class="line">comment_url = url + <span class="string">"/add_comment"</span></span><br><span class="line">cookie = <span class="string">'cookie'</span></span><br><span class="line">referer = url</span><br><span class="line">agent = <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"www.douban.com"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>: referer,</span><br><span class="line">    <span class="string">'User-Agent'</span>: agent,</span><br><span class="line">    <span class="string">"Cookie"</span>: cookie</span><br><span class="line">&#125;</span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">"rv_comment"</span>: <span class="string">'ğŸ†™'</span>,</span><br><span class="line">    <span class="string">"ck"</span>: re.findall(<span class="string">"ck=(.*?);"</span>, headers[<span class="string">"Cookie"</span>])[<span class="number">-1</span>],</span><br><span class="line">    <span class="string">'start'</span>: <span class="string">'0'</span>,</span><br><span class="line">    <span class="string">'submit_btn'</span>: <span class="string">'å‘é€'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(comment_url, headers=headers, allow_redirects=<span class="keyword">False</span>,</span><br><span class="line">                         data=params, verify=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿è¡Œå³å¯ã€‚</p><p>ä½†æ˜¯å¤šè¿è¡Œå‡ æ¬¡å°±ä¼šå‘ç°ï¼Œè¿”å›çš„çŠ¶æ€ç æ˜¯200ï¼Œè€Œä¸”æ²¡æœ‰é¡¶å¸–æˆåŠŸã€‚å®é™…ä¸Šæ˜¯è§¦å‘äº†è±†ç“£çš„é˜²çˆ¬è™«ã€‚</p><p><img src="https://images.morethink.cn/96695d5876d98ca99abc79866020a284.png" alt="" title="è§¦å‘äº†è±†ç“£éªŒè¯ç "></p><p>è€Œä¸”åœ¨æˆ‘ä»¬é¡¶å¸–çš„æ—¶å€™å‘é€è¯·æ±‚çš„æ—¶å€™è¿˜å¸¦æœ‰ captcha-solution å’Œ captcha-id å­—æ®µã€‚</p><p><img src="https://images.morethink.cn/8a57550867a8e02b3272d6043632f51b.png" alt=""></p><p>ç›®å‰å‘ç°ï¼Œæ¯æ¬¡è¯„è®ºå°±ç®—ç›¸éš”1åˆ†é’Ÿï¼Œåªè¦æ»¡3æ¬¡ï¼Œå°±ä¸€å®šä¼šå¼¹å‡ºè¿™ä¸ªéªŒè¯ç è¿›è¡ŒéªŒè¯ã€‚</p><h1 id="éªŒè¯ç è§£æ"><a href="#éªŒè¯ç è§£æ" class="headerlink" title="éªŒè¯ç è§£æ"></a>éªŒè¯ç è§£æ</h1><p>é‡åˆ°éªŒè¯ç æˆ‘ä»¬å°±æ¥ç ´è§£éªŒè¯ç ã€‚</p><h2 id="tesserocr"><a href="#tesserocr" class="headerlink" title="tesserocr"></a>tesserocr</h2><p>è¯†åˆ«å›¾å½¢éªŒè¯ç éœ€è¦å®‰è£…tesserocrè¿™ä¸ªåº“ï¼Œä¸‹é¢ä»‹ç»ä¸‹tesserocrã€‚</p><p>tesserocræ˜¯Pythonçš„ä¸€ä¸ªOCRè¯†åˆ«åº“ï¼Œä½†å…¶å®æ˜¯å¯¹tesseractåšäº†ä¸€å±‚Python Apiçš„å°è£…ï¼Œæ ¸å¿ƒè¿˜æ˜¯tesseractï¼Œæ‰€ä»¥åœ¨å®‰è£…tesserocrä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£…tesseractã€‚<code>Tesseract</code>(/â€˜tesÉ™rÃ¦kt/) è¿™ä¸ªè¯çš„æ„æ€æ˜¯â€è¶…ç«‹æ–¹ä½“â€ï¼ŒæŒ‡çš„æ˜¯å‡ ä½•å­¦é‡Œçš„å››ç»´æ ‡å‡†æ–¹ä½“ï¼Œåˆç§°â€æ­£å…«èƒä½“â€ï¼Œæ˜¯ä¸€æ¬¾è¢«å¹¿æ³›ä½¿ç”¨çš„å¼€æº <code>OCR</code> å·¥å…·ã€‚</p><p>åœ¨Macä¸‹ï¼Œä½¿ç”¨ brew å®‰è£…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install tesseract --all-languages</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†å®‰è£…tesserocrå³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brew install imagemagick</span><br><span class="line">pip install tesserocr pillow</span><br></pre></td></tr></table></figure><p>Python ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># æ–°å»ºImageå¯¹è±¡</span></span><br><span class="line">    image = Image.open(<span class="string">"/Users/liwenhao/Desktop/douban-captcha-example1.jpeg"</span>)</span><br><span class="line">    <span class="comment"># è°ƒç”¨tesserocrçš„image_to_text()æ–¹æ³•ï¼Œä¼ å…¥imageå¯¹è±¡å®Œæˆè¯†åˆ«</span></span><br><span class="line">    result = tesserocr.image_to_text(image)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>éªŒè¯çš„å›¾ç‰‡å¦‚ä¸‹ï¼š</p><p><img src="https://images.morethink.cn/douban-captcha-example1.jpeg" alt="douban-captcha-example1" title="douban-captcha-example1"></p><p>ç»“æœæ— æ³•è¯†åˆ«ã€‚</p><p>æ¢ä¸€å¼ ç®€å•çš„å›¾ç‰‡è¯•è¯•ï¼š<br><img src="http://images.morethink.cn/captcha-example1.jpg" alt="captcha-example1.jpg"></p><p>ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5594</span><br></pre></td></tr></table></figure></p><p>çœ‹æ¥ Tesseract åªèƒ½è¯†åˆ«ä¸€äº›ç®€å•çš„éªŒè¯ç ï¼Œä¸é€‚åˆè±†ç“£éªŒè¯ç è¯†åˆ«ã€‚</p><p>è¯•è¯•è¯†åˆ«éªŒè¯ç å¹³å°ã€‚</p><h2 id="ç™¾åº¦OCR"><a href="#ç™¾åº¦OCR" class="headerlink" title="ç™¾åº¦OCR"></a>ç™¾åº¦OCR</h2><p><strong>å®˜æ–¹æ¥å…¥æ–‡æ¡£</strong>: <a href="https://cloud.baidu.com/doc/OCR/OCR-Python-SDK.html#.E5.BF.AB.E9.80.9F.E5.85.A5.E9.97.A8" target="_blank" rel="noopener">æ–‡å­—è¯†åˆ«-Python SDKæ¥å…¥æ–‡æ¡£</a></p><ul><li><strong>é‡ç‚¹ï¼šå…è´¹</strong>  </li><li>é€šç”¨è¯†åˆ«ï¼ˆåŒ…æ‹¬èº«ä»½è¯ã€é“¶è¡Œå¡ï¼‰500æ¬¡/æ—¥ï¼Œ  </li><li>é«˜ç²¾åº¦åˆ™50æ¬¡/æ—¥ï¼Œ  </li><li>é©¾é©¶è¯ï¼Œè¡Œé©¶è¯ï¼Œè½¦ç¥¨ï¼Œè¥ä¸šæ‰§ç…§ï¼Œé€šç”¨ç¥¨æ®å‡ä¸º200æ¬¡/æ—¥  </li></ul><p>æ³¨æ„ï¼š<br><strong>æ”¯æŒ2.7.+åŠ3.+</strong></p><h3 id="é…ç½®æµç¨‹ï¼š"><a href="#é…ç½®æµç¨‹ï¼š" class="headerlink" title="é…ç½®æµç¨‹ï¼š"></a>é…ç½®æµç¨‹ï¼š</h3><ol><li>å…ˆå¼€é€šä¸ªç™¾åº¦çš„è´¦å·ï¼›  </li><li>å¼€é€š<strong>æ–‡å­—è¯†åˆ«æœåŠ¡</strong>ï¼Œæ‰“å¼€åç‚¹å‡»ç«‹å³ä½¿ç”¨ï¼š<a href="https://cloud.baidu.com/product/ocr.html" target="_blank" rel="noopener">https://cloud.baidu.com/product/ocr.html</a>  </li><li>ç‚¹å‡»æ­¥éª¤2ï¼Œåº”è¯¥æœ‰ä¸ªä¿¡æ¯ç¡®è®¤çš„ï¼Œç¡®è®¤åï¼Œä¼šè¿›å…¥åˆ°ç”¨æˆ·ä¸ªäººé¦–é¡µï¼Œå‘ä¸‹æ»‘åŠ¨ï¼Œç›´æ¥ç‚¹å‡»æ–‡å­—è¯†åˆ«:<br><img src="https://user-gold-cdn.xitu.io/2018/6/11/163ecde99a94d224" alt=""></li><li>ç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼Œè¾“å…¥ä¸€å †å†…å®¹åï¼Œç‚¹å‡»ç¡®è®¤å³å¯ï¼Œç„¶åç‚¹å‡»æˆ‘çš„åº”ç”¨ï¼Œè¿™é‡Œé¢çš„<strong>API Key</strong> è·Ÿ<strong>Secret Key</strong>éœ€è¦ä½¿ç”¨åˆ°: <img src="https://user-gold-cdn.xitu.io/2018/6/11/163ece17b329ea80" alt=""></li><li><p>ç‚¹å‡»å³ä¸Šè§’ï¼Œç”¨æˆ·ä¸­å¿ƒï¼Œç”¨æˆ·IDä¹Ÿéœ€è¦ç”¨åˆ°:<br><img src="https://user-gold-cdn.xitu.io/2018/6/11/163ece27d4bc3e76" alt=""></p></li><li><p>éœ€è¦çš„ä¿¡æ¯å‡†å¤‡å¥½äº†ï¼Œ<strong>pip</strong> å®‰è£…ä¸€æ³¢</p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install baidu-aip</span><br></pre></td></tr></table></figure></li></ol><h3 id="æµ‹è¯•ä¸€æ³¢"><a href="#æµ‹è¯•ä¸€æ³¢" class="headerlink" title="æµ‹è¯•ä¸€æ³¢"></a>æµ‹è¯•ä¸€æ³¢</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> aip <span class="keyword">import</span> AipOcr</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    APP_ID = <span class="string">' '</span></span><br><span class="line">    API_KEY = <span class="string">' '</span></span><br><span class="line">    SECRET_KEY = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">    client = AipOcr(APP_ID, API_KEY, SECRET_KEY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–å›¾ç‰‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_file_content</span><span class="params">(file_path)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            <span class="keyword">return</span> fp.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    image = get_file_content(<span class="string">'/Users/liwenhao/Desktop/douban-captcha-example2.jpg'</span>)</span><br><span class="line">    <span class="string">""" è°ƒç”¨é€šç”¨æ–‡å­—è¯†åˆ«(é«˜ç²¾åº¦), å›¾ç‰‡å‚æ•°ä¸ºæœ¬åœ°å›¾ç‰‡ """</span></span><br><span class="line">    result = json.dumps(client.basicAccurate(image))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>éªŒè¯çš„å›¾ç‰‡å¦‚ä¸‹ï¼š</p><p><img src="https://images.morethink.cn/douban-captcha-example1.jpeg" alt="douban-captcha-example1" title="douban-captcha-example1"></p><p>ç»“æœèµ°ä¸€æ³¢ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;log_id&quot;: 3968431492157876638, &quot;words_result_num&quot;: 1, &quot;words_result&quot;: [&#123;&quot;words&quot;: &quot; minute:&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºè¯†åˆ«å‡ºäº†è¿™ä¸ªéªŒè¯ç ã€‚</p><ul><li><code>words_result_num</code> æ˜¯è¯†åˆ«ç»“æœæ•°</li><li><code>words_result</code> æ˜¯å®šä½å’Œè¯†åˆ«ç»“æœæ•°ç»„</li><li><code>words</code> æ˜¯è¯†åˆ«ç»“æœå­—ç¬¦ä¸²</li></ul><p>å†æ¥è¯•è¯•</p><p><img src="https://images.morethink.cn/douban-captcha-example2.jpg" alt="douban-captcha-example2" title="douban-captcha-example2"></p><p>ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;log_id&quot;: 5251449865676063710, &quot;words_result_num&quot;: 0, &quot;words_result&quot;: []&#125;</span><br></pre></td></tr></table></figure></p><p>æ²¡æœ‰è¯†åˆ«å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°å¯¹äºå¤æ‚ä¸€äº›çš„éªŒè¯ç è¿˜æ˜¯ä¼šå‡ºç°æ— æ³•è¯†åˆ«çš„æƒ…å†µï¼Œä½†æ˜¯èƒœåœ¨å…è´¹ã€‚</p><h2 id="è¶…çº§é¹°"><a href="#è¶…çº§é¹°" class="headerlink" title="è¶…çº§é¹°"></a>è¶…çº§é¹°</h2><p>å¯¹äºæ— æ³•è¯†åˆ«çš„æƒ…å†µå°±éœ€è¦æ‰“ç å¹³å°äº†ï¼Œä¸šç•Œæ¯”è¾ƒå‡ºåçš„æ˜¯ <a href="https://link.juejin.im?target=http%3A%2F%2Fwww.chaojiying.com%2F" target="_blank" rel="noopener">è¶…çº§é¹°</a> ã€‚</p><p>è¶…çº§é¹°æ˜¯æŒ‰é‡çº§æ”¶è´¹ï¼Œé‡å¤§ä¾¿å®œï¼Œæ ‡å‡†ä»·æ ¼:1å…ƒ=1000é¢˜åˆ†ï¼Œä¸åŒéªŒè¯ç ç±»å‹ï¼Œéœ€è¦çš„é¢˜åˆ†ä¸ä¸€æ ·ï¼Œè¯¦æƒ…å¯ä»¥åˆ°è¿™é‡ŒæŸ¥è¯¢ <a href="http://www.chaojiying.com/price.html" target="_blank" rel="noopener">http://www.chaojiying.com/price.html</a></p><p>python ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡è¶…çº§é¹°è¯†åˆ«éªŒè¯ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recognition_captcha</span><span class="params">(filename, code_type)</span>:</span></span><br><span class="line">    im = open(filename, <span class="string">'rb'</span>).read()</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'user'</span>: <span class="string">'è´¦å·'</span>,</span><br><span class="line">        <span class="string">'pass2'</span>: md5(<span class="string">'å¯†ç '</span>.encode(<span class="string">'utf8'</span>)).hexdigest(),</span><br><span class="line">        <span class="string">'softid'</span>: <span class="string">'softid'</span>,</span><br><span class="line">        <span class="string">'codetype'</span>: code_type</span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Connection'</span>: <span class="string">'Keep-Alive'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    files = &#123;<span class="string">'userfile'</span>: (<span class="string">'ccc.jpg'</span>, im)&#125;</span><br><span class="line">    resp = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/Processing.php'</span>, data=params, files=files,</span><br><span class="line">                         headers=headers).json()</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨ä»£ç </span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(json.dumps(recognition_captcha(<span class="string">'/Users/liwenhao/Desktop/douban-captcha-example2.jpg'</span>, <span class="number">1006</span>)))</span><br></pre></td></tr></table></figure></p><p>ä¸Šä¼ çš„éªŒè¯ç å°±æ˜¯ä¸Šé¢ç™¾åº¦ OCR æœªæ›¾è¯†åˆ«çš„éªŒè¯ç ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://images.morethink.cn/douban-captcha-example2.jpg" alt="douban-captcha-example2" title="douban-captcha-example2"><br>ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;err_str&quot;: &quot;OK&quot;, &quot;err_no&quot;: 0, &quot;md5&quot;: &quot;0475b05654c376deb409bfef7eee75cd&quot;, &quot;pic_id&quot;: &quot;8054415552001300054&quot;, &quot;pic_str&quot;: &quot;yacvmd&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>å‘ç° éªŒè¯ç  <code>yacvmd</code> å·²å‡ºæ¥ã€‚ä½†æ˜¯æ—¶é—´èŠ±äº†5så·¦å³ã€‚åæ¥æµ‹è¯•å‘ç°å¯¹äºè±†ç“£æ¯”è¾ƒå»ºçš„éªŒè¯ç èŠ±è´¹çš„æ—¶é—´åœ¨1så†…ï¼Œå› æ­¤ä»æ—¶é—´å’Œå‡†ç¡®æ€§ä¸Šé¢ï¼Œæœ€åè¿˜æ˜¯é‡‡ç”¨äº†è¶…çº§é¹°æ‰“ç å¹³å°ã€‚</p><h1 id="å¤±è´¥å¾®ä¿¡é€šçŸ¥"><a href="#å¤±è´¥å¾®ä¿¡é€šçŸ¥" class="headerlink" title="å¤±è´¥å¾®ä¿¡é€šçŸ¥"></a>å¤±è´¥å¾®ä¿¡é€šçŸ¥</h1><p>æ— è®ºé‡‡ç”¨ä»€ä¹ˆæ–¹å¼ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°å¤±è´¥çš„æƒ…å†µï¼Œæˆ‘æ€»ä¸èƒ½é‡‡å– è½®è¯¢ çš„æ–¹å¼ï¼Œéš”å‡ ä¸ªå°æ—¶å°±å»çœ‹çœ‹åˆ°åº•å‰é¢å‡ æ¬¡æ˜¯å¦ğŸ†™æˆåŠŸï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª å¼‚æ­¥é€šçŸ¥ ï¼Œæœ€å¼€å§‹æƒ³ç”¨ é‚®ä»¶ï¼Œåæ¥å‘ç°äº† <a href="http://sc.ftqq.com/3.version" target="_blank" rel="noopener">Serveré…±</a> è¿™ä¸ªç¥å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘é€å¾®ä¿¡é€šçŸ¥ï¼Œè€Œä¸”ç‰¹åˆ«ç®€å•ã€‚</p><p>å…·ä½“å¯ä»¥æŸ¥çœ‹ <a href="http://sc.ftqq.com/3.version" target="_blank" rel="noopener">Serveré…±</a>ã€‚</p><h1 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h1><p>é‡‡ç”¨ python2</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> html</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO, format=<span class="string">'%(asctime)s.%(msecs)03d %(levelname)s: %(message)s'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½éªŒè¯ç å›¾ç‰‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_captcha</span><span class="params">(captcha_url, agent)</span>:</span></span><br><span class="line">    <span class="comment"># findallè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line">    captcha_name = re.findall(<span class="string">"id=(.*?):"</span>, captcha_url)</span><br><span class="line">    filename = <span class="string">"douban_%s.jpg"</span> % (str(captcha_name[<span class="number">0</span>]))</span><br><span class="line">    logging.info(<span class="string">"æ–‡ä»¶åä¸º: "</span> + filename)</span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># ä»¥äºŒè¿›åˆ¶å†™å…¥çš„æ¨¡å¼åœ¨æœ¬åœ°æ„å»ºæ–°æ–‡ä»¶</span></span><br><span class="line">        header = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span>: agent,</span><br><span class="line">            <span class="string">'Referer'</span>: captcha_url</span><br><span class="line">        &#125;</span><br><span class="line">        f.write(requests.get(captcha_url, headers=header).content)</span><br><span class="line">        logging.info(<span class="string">"%s ä¸‹è½½å®Œæˆ"</span> % filename)</span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡è¶…çº§é¹°è¯†åˆ«éªŒè¯ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recognition_captcha</span><span class="params">(filename, code_type)</span>:</span></span><br><span class="line">    im = open(filename, <span class="string">'rb'</span>).read()</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">'user'</span>: <span class="string">'ç”¨æˆ·'</span>,</span><br><span class="line">        <span class="string">'pass2'</span>: md5(<span class="string">'å¯†ç '</span>.encode(<span class="string">'utf8'</span>)).hexdigest(),</span><br><span class="line">        <span class="string">'softid'</span>: <span class="string">'softid'</span>,</span><br><span class="line">        <span class="string">'codetype'</span>: code_type</span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Connection'</span>: <span class="string">'Keep-Alive'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    files = &#123;<span class="string">'userfile'</span>: (<span class="string">'ccc.jpg'</span>, im)&#125;</span><br><span class="line">    resp = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/Processing.php'</span>, data=params, files=files,</span><br><span class="line">                         headers=headers).json()</span><br><span class="line">    <span class="comment"># é”™è¯¯å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> resp.get(<span class="string">'err_no'</span>, <span class="number">0</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> resp.get(<span class="string">'pic_str'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result_verification</span><span class="params">(response)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">302</span>:</span><br><span class="line">        logging.info(<span class="string">"è±†ç“£dingæˆåŠŸ"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.info(response.status_code)</span><br><span class="line">        logging.info(response)</span><br><span class="line">        url = <span class="string">"https://sc.ftqq.com/ä½ çš„SCKEY.send?text=doubanå¤±è´¥"</span> + \</span><br><span class="line">              str(random.randint(<span class="number">0</span>, <span class="number">1000</span>))</span><br><span class="line">        requests.post(url)</span><br><span class="line">        logging.info(<span class="string">"è±†ç“£dingå¤±è´¥ï¼Œå‘é€å¤±è´¥ä¿¡æ¯åˆ°å¾®ä¿¡"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è±†ç“£é¡¶å¸–</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">douban_ding</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># è±†ç“£å…·ä½“å¸–å­</span></span><br><span class="line">    url = <span class="string">"https://www.douban.com/group/topic/129122199/"</span></span><br><span class="line">    <span class="comment"># è±†ç“£å…·ä½“å¸–å­å›å¤çš„æ¥å£ï¼Œæ ¼å¼æ˜¯å¸–å­é“¾æ¥+/add_comment</span></span><br><span class="line">    comment_url = url + <span class="string">"/add_comment"</span></span><br><span class="line">    cookie = <span class="string">'cookie'</span></span><br><span class="line">    referer = url</span><br><span class="line">    agent = <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">"Host"</span>: <span class="string">"www.douban.com"</span>,</span><br><span class="line">        <span class="string">"Referer"</span>: referer,</span><br><span class="line">        <span class="string">'User-Agent'</span>: agent,</span><br><span class="line">        <span class="string">"Cookie"</span>: cookie</span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">"rv_comment"</span>: <span class="string">'ğŸ†™'</span>,</span><br><span class="line">        <span class="string">"ck"</span>: re.findall(<span class="string">"ck=(.*?);"</span>, headers[<span class="string">"Cookie"</span>])[<span class="number">-1</span>],</span><br><span class="line">        <span class="string">'start'</span>: <span class="string">'0'</span>,</span><br><span class="line">        <span class="string">'submit_btn'</span>: <span class="string">'å‘é€'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url, headers=headers, verify=<span class="keyword">False</span>).content.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    selector = html.fromstring(response)</span><br><span class="line">    captcha_image = selector.xpath(<span class="string">"//img[@id=\"captcha_image\"]/@src"</span>)</span><br><span class="line">    <span class="keyword">if</span> captcha_image:</span><br><span class="line">        logging.info(<span class="string">"å‘ç°éªŒè¯ç ï¼Œä¸‹è½½éªŒè¯ç "</span>)</span><br><span class="line">        captcha_id = selector.xpath(<span class="string">"//input[@name=\"captcha-id\"]/@value"</span>)</span><br><span class="line">        filename = download_captcha(captcha_image[<span class="number">0</span>], agent)</span><br><span class="line">        captcha_solution = recognition_captcha(filename, <span class="number">1006</span>)</span><br><span class="line">        os.remove(filename)</span><br><span class="line">        params[<span class="string">'captcha-solution'</span>] = captcha_solution</span><br><span class="line">        params[<span class="string">'captcha-id'</span>] = captcha_id</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.info(<span class="string">"æ²¡æœ‰éªŒè¯ç "</span>)</span><br><span class="line">    response = requests.post(comment_url, headers=headers, allow_redirects=<span class="keyword">False</span>,</span><br><span class="line">                             data=params, verify=<span class="keyword">False</span>)</span><br><span class="line">    result_verification(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    douban_ding()</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><ol><li><p>ç¬¬1æ¬¡ï¼š</p> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2018-12-30 16:09:35.589 INFO: æ²¡æœ‰éªŒè¯ç </span><br><span class="line">2018-12-30 16:09:36.436 INFO: è±†ç“£dingæˆåŠŸ</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬4æ¬¡ï¼š</p> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2018-12-30 16:13:02.135 INFO: å‘ç°éªŒè¯ç ï¼Œä¸‹è½½éªŒè¯ç </span><br><span class="line">2018-12-30 16:13:02.135 INFO: æ–‡ä»¶åä¸º: douban_OJGsVa0hST4O2WhFA0VpMnR9.jpg</span><br><span class="line">2018-12-30 16:13:02.554 INFO: douban_OJGsVa0hST4O2WhFA0VpMnR9.jpg ä¸‹è½½å®Œæˆ</span><br><span class="line">2018-12-30 16:13:09.687 INFO: è±†ç“£dingæˆåŠŸ</span><br></pre></td></tr></table></figure></li></ol><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://images.morethink.cn/b9eeaa536e309a201824eac764d11e33.png" alt=""></p><p>æ³¨ï¼š</p><ol><li>é¡¶å¸–çš„æ—¶å€™æ§åˆ¶å¥½é¢‘ç‡ï¼Œä¸ç„¶å®¹æ˜“è¢«ç¦è¨€ã€‚ <img src="https://images.morethink.cn/douban-ban.jpg" alt="" title="è±†ç“£ç¦è¨€"></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://images.morethink.cn/278d71ed0f07f6d1d72a8afa76039cc2.png&quot; alt=&quot;&quot; title=&quot;ğŸ†™ğŸ†™&quot;&gt;&lt;/p&gt;
&lt;p&gt;ç”±äºåœ¨è±†ç“£å‘äº†ä¸ªç§Ÿæˆ¿å¸–å­ï¼Œå‘ç°å¾ˆå¿«å°±è¢«å…¶ä»–çš„å¸–å­æ·¹æ²¡ï¼Œä½†æ˜¯æ‰‹åŠ¨é¡¶å¸–å®åœ¨å¤ªç´¯ï¼ŒğŸ˜­ï¼Œæ‰€ä»¥æƒ³é€šè¿‡è‡ªåŠ¨é¡¶å¸–çš„æ–¹å¼æ¥è§£æ”¾åŒæ‰‹ï¼&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="https://www.morethink.cn/categories/Python/"/>
    
    
  </entry>
  
  <entry>
    <title>Dockerä¸­æ‰§è¡ŒShellå‡ºç°ä¹±ç </title>
    <link href="https://www.morethink.cn/Linux/Docker%E4%B8%AD%E6%89%A7%E8%A1%8CShell%E5%87%BA%E7%8E%B0%E4%B9%B1%E7%A0%81/"/>
    <id>https://www.morethink.cn/Linux/Dockerä¸­æ‰§è¡ŒShellå‡ºç°ä¹±ç /</id>
    <published>2018-10-13T16:00:00.000Z</published>
    <updated>2018-12-05T06:42:48.684Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š<br>æ‰§è¡Œå‘½ä»¤<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec f4af9b sh -c 'bash /tmp/build.sh'</span><br></pre></td></tr></table></figure></p><p>åœ¨dockerä¸­æ‰§è¡Œshellï¼Œä¼šå‡ºç°ä¸­æ–‡ä¹±ç çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨dockerå®¹å™¨ä¸­å•ç‹¬æ‰§è¡Œshellè„šæœ¬å´æ²¡æœ‰å‡ºç°ä¹±ç ã€‚æŸ¥çœ‹ç¯å¢ƒå˜é‡å­˜åœ¨<code>LANG=en_US.UTF-8</code>ï¼Œå› æ­¤ä»åŸç†ä¸Šæ¥è¯´æ˜¯ä¸åº”è¯¥å‡ºç°ä¹±ç çš„ã€‚</p><p>ä½†æ˜¯æ—¢ç„¶å‡ºç°äº†ä¹±ç ï¼Œé‚£ä¹ˆ<code>LANG=en_US.UTF-8</code>åº”è¯¥å°±æ²¡æœ‰è¯»å–åˆ°ï¼Œäºæ˜¯åœ¨ <code>build.sh</code>ä¸­è¿è¡Œ<code>env</code>å‘½ä»¤ï¼Œå‘ç°é€šè¿‡<code>docker exec f4af9b sh -c &#39;bash /tmp/build.sh&#39;</code>æ–¹å¼æ²¡æœ‰<code>LANG=en_US.UTF-8</code>ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><a id="more"></a><h1 id="åŸå› å®šä½"><a href="#åŸå› å®šä½" class="headerlink" title="åŸå› å®šä½"></a>åŸå› å®šä½</h1><p>åŸå› å¦‚ä¸‹ï¼š<br><code>docker exec f4af9b sh -c &#39;bash /tmp/build.sh&#39;</code> å¯¹äºdocker å®¹å™¨æ¥è¯´æ˜¯éç™»å½•å’Œéäº¤äº’å¼shellï¼Œè¿™æ ·å°±ä¸ä¼šè¯»å–æŸäº›é…ç½®æ–‡ä»¶ï¼Œå¯¼è‡´<code>LANG=en_US.UTF-8</code>æ²¡æœ‰åŠ è½½æˆåŠŸã€‚</p><h1 id="Linux-Shell"><a href="#Linux-Shell" class="headerlink" title="Linux Shell"></a>Linux Shell</h1><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹Linuxäº¤äº’å¼å’Œéäº¤äº’å¼shellã€ç™»å½•å’Œéç™»å½•shellä¹‹é—´çš„åŒºåˆ«ã€‚</p><ul><li><p><strong>äº¤äº’å¼shellï¼ˆinteractive shellï¼‰å’Œéäº¤äº’å¼shellï¼ˆnon-interactive shellï¼‰</strong>ï¼š</p><ul><li>äº¤äº’å¼çš„shellä¼šæœ‰ä¸€ä¸ªè¾“å…¥æç¤ºç¬¦ï¼Œå¹¶ä¸”å®ƒçš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½ä¼šæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚è¿™ç§æ¨¡å¼ä¹Ÿæ˜¯å¤§å¤šæ•°ç”¨æˆ·éå¸¸ç†Ÿæ‚‰çš„ï¼šç™»å½•ã€æ‰§è¡Œä¸€äº›å‘½ä»¤ã€é€€å‡ºã€‚å½“ä½ é€€å‡ºåï¼Œshellä¹Ÿç»ˆæ­¢äº†ã€‚  </li><li>éäº¤äº’å¼shellæ˜¯<code>bash script.sh</code>è¿™ç±»çš„shellã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œshellä¸ä¸ä½ è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯è¯»å–å­˜æ”¾åœ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒä»¬ã€‚å½“å®ƒè¯»åˆ°æ–‡ä»¶çš„ç»“å°¾EOFï¼Œshellä¹Ÿå°±ç»ˆæ­¢äº†ã€‚</li></ul></li><li><p><strong>ç™»å½•å¼shellï¼ˆlogin shellï¼‰å’Œéç™»é™†å¼shellï¼ˆno-login shellï¼‰</strong>ï¼š</p><ul><li>éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç çš„shellå°±æ˜¯ç™»é™†å¼shellã€‚å› æ­¤é€šå¸¸ä¸ç®¡ä»¥ä½•ç§æ–¹å¼ç™»é™†æœºå™¨åç”¨æˆ·è·å¾—çš„ç¬¬ä¸€ä¸ªshellå°±æ˜¯login shellã€‚ä¸è¾“å…¥å¯†ç çš„sshæ˜¯å…¬é’¥æ‰“é€šçš„ï¼ŒæŸç§æ„ä¹‰ä¸Šè¯´ä¹Ÿæ˜¯è¾“å…¥å¯†ç çš„ã€‚</li><li>éç™»é™†å¼çš„å°±æ˜¯åœ¨ç™»é™†åå¯åŠ¨bashç­‰ï¼Œå³ä¸æ˜¯è¿œç¨‹ç™»é™†åˆ°ä¸»æœºè¿™ç§ã€‚</li></ul></li></ul><p>å¯¹äºå¸¸ç”¨ç¯å¢ƒå˜é‡è®¾ç½®æ–‡ä»¶ï¼Œæ•´ç†å‡ºå¦‚ä¸‹åŠ è½½æƒ…å†µè¡¨ï¼š</p><table><thead><tr><th style="text-align:center">æ–‡ä»¶</th><th style="text-align:center">éäº¤äº’+ç™»é™†å¼</th><th style="text-align:center">äº¤äº’+ç™»é™†å¼</th><th style="text-align:center">äº¤äº’+éç™»é™†å¼</th><th style="text-align:center">éäº¤äº’+éç™»é™†å¼</th></tr></thead><tbody><tr><td style="text-align:center">/etc/profile</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">/etc/bashrc</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">~/.bash_profile</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">~/.bashrc</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">åŠ è½½</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">BASH_ENV</td><td style="text-align:center">-</td><td style="text-align:center">-</td><td style="text-align:center">-</td><td style="text-align:center">åŠ è½½</td></tr></tbody></table><p>æ‰§è¡Œè„šæœ¬ï¼Œå¦‚<code>bash script.sh</code>æ˜¯å±äºnon-login + non-interactiveã€‚</p><h1 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h1><p>å› è€Œï¼Œæ‰§è¡Œå‘½ä»¤<code>docker exec f4af9b sh -c &#39;bash /tmp/build.sh&#39;</code>å¯¹äºdockerå®¹å™¨æ¥è¯´æ˜¯å±äºnon-login + non-interactiveã€‚</p><p>å°†ä¸Šé¢çš„<code>bash /tmp/build.sh</code>æ”¹ä¸º<code>bash --login /tmp/build.sh</code>å˜ä¸ºç™»å½•shellï¼Œå°±å¯ä»¥è¯»å–/etc/profileå’Œ~/.bash_profileç­‰æ–‡ä»¶ã€‚</p><p>æˆ–è€…åœ¨æ‰§è¡Œ<code>bash /tmp/build.sh</code>æ—¶åœ¨<code>build.sh</code>åŠ å…¥<code>export LANG=&quot;en_US.UTF-8&quot;</code>æ‰‹åŠ¨è®¾ç½®ã€‚</p><h1 id="å¸¸è§çš„shellå˜é‡"><a href="#å¸¸è§çš„shellå˜é‡" class="headerlink" title="å¸¸è§çš„shellå˜é‡"></a>å¸¸è§çš„shellå˜é‡</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PATHï¼šå†³å®šäº†shellå°†åˆ°å“ªäº›ç›®å½•ä¸­å¯»æ‰¾å‘½ä»¤æˆ–ç¨‹åº</span><br><span class="line">HOMEï¼šå½“å‰ç”¨æˆ·ä¸»ç›®å½•</span><br><span class="line">MAILï¼šæ˜¯æŒ‡å½“å‰ç”¨æˆ·çš„é‚®ä»¶å­˜æ”¾ç›®å½•ã€‚</span><br><span class="line">SHELLï¼šæ˜¯æŒ‡å½“å‰ç”¨æˆ·ç”¨çš„æ˜¯å“ªç§Shellã€‚</span><br><span class="line">HISTSIZEï¼šæ˜¯æŒ‡ä¿å­˜å†å²å‘½ä»¤è®°å½•çš„æ¡æ•°</span><br><span class="line">LOGNAMEï¼šæ˜¯æŒ‡å½“å‰ç”¨æˆ·çš„ç™»å½•åã€‚</span><br><span class="line">HOSTNAMEï¼šæ˜¯æŒ‡ä¸»æœºçš„åç§°ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºå¦‚æœè¦ç”¨åˆ°ä¸»æœºåçš„è¯ï¼Œé€šå¸¸æ˜¯ä»è¿™ä¸ªç¯å¢ƒå˜é‡ä¸­æ¥å–å¾—çš„ã€‚</span><br><span class="line">LANG/LANGUGEï¼šæ˜¯å’Œè¯­è¨€ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨å¤šç§è¯­è¨€çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹æ­¤ç¯å¢ƒå˜é‡ã€‚</span><br><span class="line">PS1ï¼šæ˜¯åŸºæœ¬æç¤ºç¬¦ï¼Œå¯¹äºrootç”¨æˆ·æ˜¯#ï¼Œå¯¹äºæ™®é€šç”¨æˆ·æ˜¯$ã€‚</span><br><span class="line">PS2ï¼šæ˜¯é™„å±æç¤ºç¬¦ï¼Œé»˜è®¤æ˜¯&quot;&gt;&quot;ã€‚</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h1&gt;&lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š&lt;br&gt;æ‰§è¡Œå‘½ä»¤&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker exec f4af9b sh -c &#39;bash /tmp/build.sh&#39;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åœ¨dockerä¸­æ‰§è¡Œshellï¼Œä¼šå‡ºç°ä¸­æ–‡ä¹±ç çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨dockerå®¹å™¨ä¸­å•ç‹¬æ‰§è¡Œshellè„šæœ¬å´æ²¡æœ‰å‡ºç°ä¹±ç ã€‚æŸ¥çœ‹ç¯å¢ƒå˜é‡å­˜åœ¨&lt;code&gt;LANG=en_US.UTF-8&lt;/code&gt;ï¼Œå› æ­¤ä»åŸç†ä¸Šæ¥è¯´æ˜¯ä¸åº”è¯¥å‡ºç°ä¹±ç çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ—¢ç„¶å‡ºç°äº†ä¹±ç ï¼Œé‚£ä¹ˆ&lt;code&gt;LANG=en_US.UTF-8&lt;/code&gt;åº”è¯¥å°±æ²¡æœ‰è¯»å–åˆ°ï¼Œäºæ˜¯åœ¨ &lt;code&gt;build.sh&lt;/code&gt;ä¸­è¿è¡Œ&lt;code&gt;env&lt;/code&gt;å‘½ä»¤ï¼Œå‘ç°é€šè¿‡&lt;code&gt;docker exec f4af9b sh -c &amp;#39;bash /tmp/build.sh&amp;#39;&lt;/code&gt;æ–¹å¼æ²¡æœ‰&lt;code&gt;LANG=en_US.UTF-8&lt;/code&gt;ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.morethink.cn/categories/Linux/"/>
    
    
      <category term="Docker" scheme="https://www.morethink.cn/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Nettyæ¥æ”¶HTTPæ–‡ä»¶ä¸Šä¼ åŠæ–‡ä»¶ä¸‹è½½</title>
    <link href="https://www.morethink.cn/Netty%E6%8E%A5%E6%94%B6HTTP%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8F%8A%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
    <id>https://www.morethink.cn/Nettyæ¥æ”¶HTTPæ–‡ä»¶ä¸Šä¼ åŠæ–‡ä»¶ä¸‹è½½/</id>
    <published>2018-10-13T16:00:00.000Z</published>
    <updated>2018-10-19T12:11:44.869Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h1><p>è¿™ä¸ªå¤„ç†å™¨çš„åŸç†æ˜¯æ¥æ”¶HttpObjectå¯¹è±¡ï¼ŒæŒ‰ç…§HttpRequestï¼ŒHttpContentæ¥åšå¤„ç†ï¼Œæ–‡ä»¶å†…å®¹æ˜¯åœ¨HttpContentæ¶ˆæ¯å¸¦æ¥çš„ã€‚</p><p>ç„¶ååœ¨HttpContentä¸­ä¸€ä¸ªchunkä¸€ä¸ªchunkè¯»ï¼Œchunkå¤§å°å¯ä»¥åœ¨åˆå§‹åŒ–HttpServerCodecæ—¶è®¾ç½®ã€‚å°†æ¯ä¸ªchunkäº¤ä¸ªhttpDecoderå¤åˆ¶ä¸€ä»½ï¼Œå½“è¯»åˆ°LastHttpContentå¯¹è±¡æ—¶ï¼Œè¡¨æ˜ä¸Šä¼ ç»“æŸï¼Œå¯ä»¥å°†httpDecoderä¸­ç¼“å­˜çš„æ–‡ä»¶é€šè¿‡HttpDataFactoryå†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶ååœ¨åˆ é™¤ç¼“å­˜çš„HttpContentå¯¹è±¡ã€‚</p><a id="more"></a><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttUploadHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">HttpObject</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttUploadHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HttpDataFactory factory = <span class="keyword">new</span> DefaultHttpDataFactory(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_UPLOAD = <span class="string">"/data/"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URI = <span class="string">"/upload"</span>;</span><br><span class="line">    <span class="keyword">private</span> HttpPostRequestDecoder httpDecoder;</span><br><span class="line">    HttpRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(<span class="keyword">final</span> ChannelHandlerContext ctx, <span class="keyword">final</span> HttpObject httpObject)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (httpObject <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line">            request = (HttpRequest) httpObject;</span><br><span class="line">            <span class="keyword">if</span> (request.uri().startsWith(URI) &amp;&amp; request.method().equals(HttpMethod.POST)) &#123;</span><br><span class="line">                httpDecoder = <span class="keyword">new</span> HttpPostRequestDecoder(factory, request);</span><br><span class="line">                httpDecoder.setDiscardThreshold(<span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//ä¼ é€’ç»™ä¸‹ä¸€ä¸ªHandler</span></span><br><span class="line">                ctx.fireChannelRead(httpObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (httpObject <span class="keyword">instanceof</span> HttpContent) &#123;</span><br><span class="line">            <span class="keyword">if</span> (httpDecoder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> HttpContent chunk = (HttpContent) httpObject;</span><br><span class="line">                httpDecoder.offer(chunk);</span><br><span class="line">                <span class="keyword">if</span> (chunk <span class="keyword">instanceof</span> LastHttpContent) &#123;</span><br><span class="line">                    writeChunk(ctx);</span><br><span class="line">                    <span class="comment">//å…³é—­httpDecoder</span></span><br><span class="line">                    httpDecoder.destroy();</span><br><span class="line">                    httpDecoder = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ReferenceCountUtil.release(httpObject);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ctx.fireChannelRead(httpObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeChunk</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (httpDecoder.hasNext()) &#123;</span><br><span class="line">            InterfaceHttpData data = httpDecoder.next();</span><br><span class="line">            <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; HttpDataType.FileUpload.equals(data.getHttpDataType())) &#123;</span><br><span class="line">                <span class="keyword">final</span> FileUpload fileUpload = (FileUpload) data;</span><br><span class="line">                <span class="keyword">final</span> File file = <span class="keyword">new</span> File(FILE_UPLOAD + fileUpload.getFilename());</span><br><span class="line">                log.info(<span class="string">"upload file: &#123;&#125;"</span>, file);</span><br><span class="line">                <span class="keyword">try</span> (FileChannel inputChannel = <span class="keyword">new</span> FileInputStream(fileUpload.getFile()).getChannel();</span><br><span class="line">                     FileChannel outputChannel = <span class="keyword">new</span> FileOutputStream(file).getChannel()) &#123;</span><br><span class="line">                    outputChannel.transferFrom(inputChannel, <span class="number">0</span>, inputChannel.size());</span><br><span class="line">                    ResponseUtil.response(ctx, request, <span class="keyword">new</span> GeneralResponse(HttpResponseStatus.OK, <span class="string">"SUCCESS"</span>, <span class="keyword">null</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"&#123;&#125;"</span>, cause);</span><br><span class="line">        ctx.channel().close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (httpDecoder != <span class="keyword">null</span>) &#123;</span><br><span class="line">            httpDecoder.cleanFiles();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h1><p>å‚è€ƒå®˜æ–¹Demoï¼š <a href="https://github.com/netty/netty/blob/4.1/example/src/main/java/io/netty/example/http/file/HttpStaticFileServerHandler.java" target="_blank" rel="noopener">https://github.com/netty/netty/blob/4.1/example/src/main/java/io/netty/example/http/file/HttpStaticFileServerHandler.java</a></p><p>åšäº†æ”¹åŠ¨ï¼š</p><ul><li>ä¸ºäº†æ›´é«˜æ•ˆçš„ä¼ è¾“å¤§æ•°æ®ï¼Œå®ä¾‹ä¸­ç”¨åˆ°äº†ChunkedWriteHandlerç¼–ç å™¨ï¼Œå®ƒæä¾›äº†ä»¥zero-memory-copyæ–¹å¼å†™æ–‡ä»¶ã€‚</li><li>é€šè¿‡ChannelProgressiveFutureListenerå¯¹æ–‡ä»¶ä¸‹è½½è¿‡ç¨‹è¿›è¡Œç›‘å¬ã€‚</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// æ–°å¢ChunkedHandlerï¼Œä¸»è¦ä½œç”¨æ˜¯æ”¯æŒå¼‚æ­¥å‘é€å¤§çš„ç æµï¼ˆä¾‹å¦‚å¤§æ–‡ä»¶ä¼ è¾“ï¼‰ï¼Œä½†æ˜¯ä¸å ç”¨è¿‡å¤šçš„å†…å­˜ï¼Œé˜²æ­¢å‘ç”Ÿjavaå†…å­˜æº¢å‡ºé”™è¯¯</span></span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> ChunkedWriteHandler());</span><br><span class="line"><span class="comment">// ç”¨äºä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">ch.pipeline().addLast(<span class="keyword">new</span> HttpDownloadHandler());</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpDownloadHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">FullHttpRequest</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpDownloadHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filePath = <span class="string">"/data/body.csv"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, FullHttpRequest request)</span> </span>&#123;</span><br><span class="line">        String uri = request.uri();</span><br><span class="line">        <span class="keyword">if</span> (uri.startsWith(<span class="string">"/download"</span>) &amp;&amp; request.method().equals(HttpMethod.GET)) &#123;</span><br><span class="line">            GeneralResponse generalResponse = <span class="keyword">null</span>;</span><br><span class="line">            File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(file, <span class="string">"r"</span>);</span><br><span class="line">                <span class="keyword">long</span> fileLength = raf.length();</span><br><span class="line">                HttpResponse response = <span class="keyword">new</span> DefaultHttpResponse(HTTP_1_1, HttpResponseStatus.OK);</span><br><span class="line">                response.headers().set(HttpHeaderNames.CONTENT_LENGTH, fileLength);</span><br><span class="line">                response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">"application/octet-stream"</span>);</span><br><span class="line">                response.headers().add(HttpHeaderNames.CONTENT_DISPOSITION, String.format(<span class="string">"attachment; filename=\"%s\""</span>, file.getName()));</span><br><span class="line">                ctx.write(response);</span><br><span class="line">                ChannelFuture sendFileFuture = ctx.write(<span class="keyword">new</span> DefaultFileRegion(raf.getChannel(), <span class="number">0</span>, fileLength), ctx.newProgressivePromise());</span><br><span class="line">                sendFileFuture.addListener(<span class="keyword">new</span> ChannelProgressiveFutureListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationComplete</span><span class="params">(ChannelProgressiveFuture future)</span></span></span><br><span class="line"><span class="function">                            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        log.info(<span class="string">"file &#123;&#125; transfer complete."</span>, file.getName());</span><br><span class="line">                        raf.close();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationProgressed</span><span class="params">(ChannelProgressiveFuture future,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                    <span class="keyword">long</span> progress, <span class="keyword">long</span> total)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (total &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            log.warn(<span class="string">"file &#123;&#125; transfer progress: &#123;&#125;"</span>, file.getName(), progress);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            log.debug(<span class="string">"file &#123;&#125; transfer progress: &#123;&#125;/&#123;&#125;"</span>, file.getName(), progress, total);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                ctx.writeAndFlush(LastHttpContent.EMPTY_LAST_CONTENT);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">                log.warn(<span class="string">"file &#123;&#125; not found"</span>, file.getPath());</span><br><span class="line">                generalResponse = <span class="keyword">new</span> GeneralResponse(HttpResponseStatus.NOT_FOUND, String.format(<span class="string">"file %s not found"</span>, file.getPath()), <span class="keyword">null</span>);</span><br><span class="line">                ResponseUtil.response(ctx, request, generalResponse);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                log.warn(<span class="string">"file &#123;&#125; has a IOException: &#123;&#125;"</span>, file.getName(), e.getMessage());</span><br><span class="line">                generalResponse = <span class="keyword">new</span> GeneralResponse(HttpResponseStatus.INTERNAL_SERVER_ERROR, String.format(<span class="string">"è¯»å– file %s å‘ç”Ÿå¼‚å¸¸"</span>, filePath), <span class="keyword">null</span>);</span><br><span class="line">                ResponseUtil.response(ctx, request, generalResponse);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ctx.fireChannelRead(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable e)</span> </span>&#123;</span><br><span class="line">        log.warn(<span class="string">"&#123;&#125;"</span>, e);</span><br><span class="line">        ctx.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½æ–‡ä»¶é‡åˆ°çš„å‘"><a href="#ä¸‹è½½æ–‡ä»¶é‡åˆ°çš„å‘" class="headerlink" title="ä¸‹è½½æ–‡ä»¶é‡åˆ°çš„å‘"></a>ä¸‹è½½æ–‡ä»¶é‡åˆ°çš„å‘</h2><p>ç”±äº<code>RandomAccessFile</code>æ˜¯ä¸€ç§æ–‡ä»¶èµ„æºï¼Œæ‰€ä»¥æˆ‘ä¹ æƒ¯æ€§çš„åœ¨æœ€åå…³é—­æ–‡ä»¶èµ„æºï¼Œé‡‡ç”¨çš„æ˜¯Java7çš„ <code>try-with-resources</code> è¯­æ³•ï¼Œäºæ˜¯é—®é¢˜å°±å‡ºç°äº†ï¼Œç”±äº <code>ctx.write(new DefaultFileRegion(raf.getChannel(), 0, fileLength), ctx.newProgressivePromise());</code> æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨æˆ‘å…³é—­<code>RandomAccessFile</code>æ—¶ï¼Œæ–‡ä»¶è¿˜æœªä¼ è¾“å®Œæ¯•ï¼Œå°±ä¼šå¯¼è‡´ä¸‹è½½æ–‡ä»¶åœæ­¢ã€‚</p><p>ä»£ç æ”¾åœ¨ï¼š <a href="https://github.com/morethink/code/tree/master/java/netty-example" target="_blank" rel="noopener">https://github.com/morethink/code/tree/master/java/netty-example</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ–‡ä»¶ä¸Šä¼ &quot;&gt;&lt;a href=&quot;#æ–‡ä»¶ä¸Šä¼ &quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶ä¸Šä¼ &quot;&gt;&lt;/a&gt;æ–‡ä»¶ä¸Šä¼ &lt;/h1&gt;&lt;p&gt;è¿™ä¸ªå¤„ç†å™¨çš„åŸç†æ˜¯æ¥æ”¶HttpObjectå¯¹è±¡ï¼ŒæŒ‰ç…§HttpRequestï¼ŒHttpContentæ¥åšå¤„ç†ï¼Œæ–‡ä»¶å†…å®¹æ˜¯åœ¨HttpContentæ¶ˆæ¯å¸¦æ¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨HttpContentä¸­ä¸€ä¸ªchunkä¸€ä¸ªchunkè¯»ï¼Œchunkå¤§å°å¯ä»¥åœ¨åˆå§‹åŒ–HttpServerCodecæ—¶è®¾ç½®ã€‚å°†æ¯ä¸ªchunkäº¤ä¸ªhttpDecoderå¤åˆ¶ä¸€ä»½ï¼Œå½“è¯»åˆ°LastHttpContentå¯¹è±¡æ—¶ï¼Œè¡¨æ˜ä¸Šä¼ ç»“æŸï¼Œå¯ä»¥å°†httpDecoderä¸­ç¼“å­˜çš„æ–‡ä»¶é€šè¿‡HttpDataFactoryå†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶ååœ¨åˆ é™¤ç¼“å­˜çš„HttpContentå¯¹è±¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="https://www.morethink.cn/categories/Java/"/>
    
    
      <category term="Netty" scheme="https://www.morethink.cn/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Netty URLè·¯ç”±æ–¹æ¡ˆæ¢è®¨</title>
    <link href="https://www.morethink.cn/Netty-URL-routing-scheme/"/>
    <id>https://www.morethink.cn/Netty-URL-routing-scheme/</id>
    <published>2018-09-26T16:00:00.000Z</published>
    <updated>2018-09-27T09:16:37.473Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç”¨Nettyåšå¼€å‘ï¼Œéœ€è¦æä¾›ä¸€ä¸ªhttp web serverï¼Œä¾›è°ƒç”¨æ–¹è°ƒç”¨ã€‚é‡‡ç”¨Nettyæœ¬èº«æä¾›çš„<code>HttpServerCodec</code> handlerè¿›è¡ŒHttpåè®®çš„è§£æï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æä¾›è·¯ç”±ã€‚</p><p>æœ€å¼€å§‹æ˜¯é€šè¿‡å¯¹Http methodåŠuri é‡‡ç”¨å¤šå±‚if else åµŒå¥—åˆ¤æ–­çš„æ–¹æ³•è·¯ç”±åˆ°çœŸæ­£çš„controllerç±»ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String uri = request.uri();</span><br><span class="line">HttpMethod method = request.method();</span><br><span class="line"><span class="keyword">if</span> (method == HttpMethod.POST) &#123;</span><br><span class="line">    <span class="keyword">if</span> (uri.startsWith(<span class="string">"/login"</span>)) &#123;</span><br><span class="line">        <span class="comment">//urlå‚æ•°è§£æï¼Œè°ƒç”¨controllerçš„æ–¹æ³•</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uri.startsWith(<span class="string">"/logout"</span>)) &#123;</span><br><span class="line">        <span class="comment">//åŒä¸Š</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == HttpMethod.GET) &#123;</span><br><span class="line">    <span class="keyword">if</span> (uri.startsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uri.startsWith(<span class="string">"/status"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>åœ¨åªéœ€æä¾›<code>login</code>åŠ<code>logout</code>APIæ—¶ï¼Œä»£ç å¯ä»¥å®ŒæˆåŠŸèƒ½ï¼Œå¯æ˜¯éšç€APIçš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œéœ€è¦æ”¯æŒçš„æ–¹æ³•åŠuriè¶Šæ¥è¶Šå¤šï¼Œ<code>else if</code> è¶Šæ¥è¶Šå¤šï¼Œä»£ç è¶Šæ¥è¶Šå¤æ‚ã€‚</p><p><img src="https://images.morethink.cn/time-for-change.jpg" alt="time-for-change" title="æ˜¯æ—¶å€™è€ƒè™‘é‡æ„äº†"></p><p>åœ¨é˜¿é‡Œå¼€å‘æ‰‹å†Œä¸­ä¹Ÿæåˆ°è¿‡ï¼š</p><p><img src="https://images.morethink.cn/e1a6f2bd638f0baf5aba0d7a63e77230.png" alt="" title="é‡æ„å¤šå±‚else if"></p><p>å› æ­¤é¦–å…ˆè€ƒè™‘é‡‡ç”¨çŠ¶æ€è®¾è®¡æ¨¡å¼åŠç­–ç•¥è®¾è®¡æ¨¡å¼é‡æ„ã€‚</p><h1 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h1><h2 id="çŠ¶æ€æ¨¡å¼çš„è§’è‰²ï¼š"><a href="#çŠ¶æ€æ¨¡å¼çš„è§’è‰²ï¼š" class="headerlink" title="çŠ¶æ€æ¨¡å¼çš„è§’è‰²ï¼š"></a>çŠ¶æ€æ¨¡å¼çš„è§’è‰²ï¼š</h2><ul><li>stateçŠ¶æ€<br>è¡¨ç¤ºçŠ¶æ€ï¼Œå®šä¹‰äº†æ ¹æ®ä¸åŒçŠ¶æ€è¿›è¡Œä¸åŒå¤„ç†çš„æ¥å£ï¼Œè¯¥æ¥å£æ˜¯é‚£äº›å¤„ç†å†…å®¹ä¾èµ–äºçŠ¶æ€çš„æ–¹æ³•é›†åˆï¼Œå¯¹åº”å®ä¾‹çš„stateç±»</li><li>å…·ä½“çš„çŠ¶æ€<br>å®ç°äº†stateæ¥å£ï¼Œå¯¹åº”daystateå’Œnightstate</li><li>context<br>contextæŒæœ‰å½“å‰çŠ¶æ€çš„å…·ä½“çŠ¶æ€çš„å®ä¾‹ï¼Œæ­¤å¤–ï¼Œä»–è¿˜å®šä¹‰äº†ä¾›å¤–éƒ¨è°ƒç”¨è€…ä½¿ç”¨çš„çŠ¶æ€æ¨¡å¼çš„æ¥å£ã€‚</li></ul><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“æ¯ä¸ªhttpè¯·æ±‚éƒ½æ˜¯ç”±methodåŠuriæ¥å”¯ä¸€æ ‡è¯†çš„ï¼Œæ‰€è°“è·¯ç”±å°±æ˜¯é€šè¿‡è¿™ä¸ªå”¯ä¸€æ ‡è¯†å®šä½åˆ°controllerç±»çš„ä¸­çš„æŸä¸ªæ–¹æ³•ã€‚</p><p>å› æ­¤æŠŠHttpLabelä½œä¸ºçŠ¶æ€<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpLabel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line">    <span class="keyword">private</span> HttpMethod method;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çŠ¶æ€æ¥å£ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Route</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·¯ç”±</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">GeneralResponse <span class="title">call</span><span class="params">(FullHttpRequest request)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸ºæ¯ä¸ªçŠ¶æ€æ·»åŠ çŠ¶æ€å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">route</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å•ä¾‹controllerç±»</span></span><br><span class="line">    <span class="keyword">final</span> DemoController demoController = DemoController.getInstance();</span><br><span class="line">    Map&lt;HttpLabel, Route&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="keyword">new</span> HttpLabel(<span class="string">"/login"</span>, HttpMethod.POST), demoController::login);</span><br><span class="line">    map.put(<span class="keyword">new</span> HttpLabel(<span class="string">"/logout"</span>, HttpMethod.POST), demoController::login);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥åˆ°è¯·æ±‚ï¼Œåˆ¤æ–­çŠ¶æ€ï¼Œè°ƒç”¨ä¸åŒæ¥å£ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">FullHttpRequest</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, FullHttpRequest request)</span> </span>&#123;</span><br><span class="line">        String uri = request.uri();</span><br><span class="line">        GeneralResponse generalResponse;</span><br><span class="line">        <span class="keyword">if</span> (uri.contains(<span class="string">"?"</span>)) &#123;</span><br><span class="line">            uri = uri.substring(<span class="number">0</span>, uri.indexOf(<span class="string">"?"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        Route route = map.get(<span class="keyword">new</span> HttpLabel(uri, request.method()));</span><br><span class="line">        <span class="keyword">if</span> (route != <span class="keyword">null</span>) &#123;</span><br><span class="line">            ResponseUtil.response(ctx, request, route.call(request));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            generalResponse = <span class="keyword">new</span> GeneralResponse(HttpResponseStatus.BAD_REQUEST, <span class="string">"è¯·æ£€æŸ¥ä½ çš„è¯·æ±‚æ–¹æ³•åŠurl"</span>, <span class="keyword">null</span>);</span><br><span class="line">            ResponseUtil.response(ctx, request, generalResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨çŠ¶æ€è®¾è®¡æ¨¡å¼é‡æ„ä»£ç ï¼Œåœ¨å¢åŠ urlæ—¶åªéœ€è¦ç½‘mapé‡Œé¢putä¸€ä¸ªå€¼å°±è¡Œäº†ã€‚</p><h1 id="ç±»ä¼¼SpringMVCè·¯ç”±åŠŸèƒ½"><a href="#ç±»ä¼¼SpringMVCè·¯ç”±åŠŸèƒ½" class="headerlink" title="ç±»ä¼¼SpringMVCè·¯ç”±åŠŸèƒ½"></a>ç±»ä¼¼SpringMVCè·¯ç”±åŠŸèƒ½</h1><p>åæ¥çœ‹äº† <a href="https://yuerblog.cc/2018/03/08/java-router-with-annotation/" target="_blank" rel="noopener">JAVAåå°„+è¿è¡Œæ—¶æ³¨è§£å®ç°URLè·¯ç”±</a> å‘ç°åå°„+æ³¨è§£çš„æ–¹å¼å¾ˆä¼˜é›…ï¼Œä»£ç ä¹Ÿä¸å¤æ‚ã€‚</p><p>ä¸‹é¢ä»‹ç»Nettyä½¿ç”¨åå°„å®ç°URLè·¯ç”±ã€‚</p><p>è·¯ç”±æ³¨è§£ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestMapping &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·¯ç”±çš„uri</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">uri</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·¯ç”±çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰«æclasspathä¸‹å¸¦æœ‰<code>@RequestMapping</code>æ³¨è§£çš„æ–¹æ³•ï¼Œå°†è¿™ä¸ªæ–¹æ³•æ”¾è¿›ä¸€ä¸ªè·¯ç”±Mapï¼š<code>Map&lt;HttpLabel, Action&lt;GeneralResponse&gt;&gt; httpRouterAction</code>ï¼Œkeyä¸ºä¸Šé¢æåˆ°è¿‡çš„Httpå”¯ä¸€æ ‡è¯†  <code>HttpLabel</code>ï¼Œvalueä¸ºé€šè¿‡åå°„è°ƒç”¨çš„æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpRouter</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;HttpLabel, Action&lt;GeneralResponse&gt;&gt; httpRouterAction = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String classpath = <span class="keyword">this</span>.getClass().getResource(<span class="string">""</span>).getPath();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; controllerBeans = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        String path = classpath + name.replaceAll(<span class="string">"\\."</span>, <span class="string">"/"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes;</span><br><span class="line">        <span class="keyword">try</span> (InputStream ins = <span class="keyword">new</span> FileInputStream(path)) &#123;</span><br><span class="line">            <span class="keyword">try</span> (ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream()) &#123;</span><br><span class="line">                <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">5</span>];</span><br><span class="line">                <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> ((b = ins.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    out.write(buffer, <span class="number">0</span>, b);</span><br><span class="line">                &#125;</span><br><span class="line">                bytes = out.toByteArray();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defineClass(name, bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRouter</span><span class="params">(String controllerClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; cls = loadClass(controllerClass);</span><br><span class="line">            Method[] methods = cls.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method invokeMethod : methods) &#123;</span><br><span class="line">                Annotation[] annotations = invokeMethod.getAnnotations();</span><br><span class="line">                <span class="keyword">for</span> (Annotation annotation : annotations) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (annotation.annotationType() == RequestMapping.class) &#123;</span><br><span class="line">                        RequestMapping requestMapping = (RequestMapping) annotation;</span><br><span class="line">                        String uri = requestMapping.uri();</span><br><span class="line">                        String httpMethod = requestMapping.method().toUpperCase();</span><br><span class="line">                        <span class="comment">// ä¿å­˜Beanå•ä¾‹</span></span><br><span class="line">                        <span class="keyword">if</span> (!controllerBeans.containsKey(cls.getName())) &#123;</span><br><span class="line">                            controllerBeans.put(cls.getName(), cls.newInstance());</span><br><span class="line">                        &#125;</span><br><span class="line">                        Action action = <span class="keyword">new</span> Action(controllerBeans.get(cls.getName()), invokeMethod);</span><br><span class="line">                        <span class="comment">//å¦‚æœéœ€è¦FullHttpRequestï¼Œå°±æ³¨å…¥FullHttpRequestå¯¹è±¡</span></span><br><span class="line">                        Class[] params = invokeMethod.getParameterTypes();</span><br><span class="line">                        <span class="keyword">if</span> (params.length == <span class="number">1</span> &amp;&amp; params[<span class="number">0</span>] == FullHttpRequest.class) &#123;</span><br><span class="line">                            action.setInjectionFullhttprequest(<span class="keyword">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// ä¿å­˜æ˜ å°„å…³ç³»</span></span><br><span class="line">                        httpRouterAction.put(<span class="keyword">new</span> HttpLabel(uri, <span class="keyword">new</span> HttpMethod(httpMethod)), action);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">"&#123;&#125;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Action <span class="title">getRoute</span><span class="params">(HttpLabel httpLabel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> httpRouterAction.get(httpLabel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡åå°„è°ƒç”¨<code>controller</code> ç±»ä¸­çš„æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Action</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Method method;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> injectionFullhttprequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) method.invoke(object, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">            log.warn(<span class="string">"&#123;&#125;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>ServerHandler.java</code>å¤„ç†å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//æ ¹æ®ä¸åŒçš„è¯·æ±‚APIåšä¸åŒçš„å¤„ç†(è·¯ç”±åˆ†å‘)</span></span><br><span class="line">Action&lt;GeneralResponse&gt; action = httpRouter.getRoute(<span class="keyword">new</span> HttpLabel(uri, request.method()));</span><br><span class="line"><span class="keyword">if</span> (action != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (action.isInjectionFullhttprequest()) &#123;</span><br><span class="line">        ResponseUtil.response(ctx, request, action.call(request));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ResponseUtil.response(ctx, request, action.call());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//é”™è¯¯å¤„ç†</span></span><br><span class="line">    generalResponse = <span class="keyword">new</span> GeneralResponse(HttpResponseStatus.BAD_REQUEST, <span class="string">"è¯·æ£€æŸ¥ä½ çš„è¯·æ±‚æ–¹æ³•åŠurl"</span>, <span class="keyword">null</span>);</span><br><span class="line">    ResponseUtil.response(ctx, request, generalResponse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>DemoController</code> æ–¹æ³•é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@RequestMapping(uri = &quot;/login&quot;, method = &quot;POST&quot;)</span><br><span class="line">public GeneralResponse login(FullHttpRequest request) &#123;</span><br><span class="line">    User user = JsonUtil.fromJson(request, User.class);</span><br><span class="line">    log.info(&quot;/login called,user: &#123;&#125;&quot;, user);</span><br><span class="line">    return new GeneralResponse(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://images.morethink.cn/5166aac96c36b6fca7645a5aca07f630.png" alt="" title="æµ‹è¯•ç»“æœ"></p><p>å®Œæ•´ä»£ç åœ¨ <a href="https://github.com/morethink/Netty-Route" target="_blank" rel="noopener">https://github.com/morethink/Netty-Route</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ç”¨Nettyåšå¼€å‘ï¼Œéœ€è¦æä¾›ä¸€ä¸ªhttp web serverï¼Œä¾›è°ƒç”¨æ–¹è°ƒç”¨ã€‚é‡‡ç”¨Nettyæœ¬èº«æä¾›çš„&lt;code&gt;HttpServerCodec&lt;/code&gt; handlerè¿›è¡ŒHttpåè®®çš„è§£æï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æä¾›è·¯ç”±ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¼€å§‹æ˜¯é€šè¿‡å¯¹Http methodåŠuri é‡‡ç”¨å¤šå±‚if else åµŒå¥—åˆ¤æ–­çš„æ–¹æ³•è·¯ç”±åˆ°çœŸæ­£çš„controllerç±»ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;String uri = request.uri();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HttpMethod method = request.method();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (method == HttpMethod.POST) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (uri.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;/login&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//urlå‚æ•°è§£æï¼Œè°ƒç”¨controllerçš„æ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (uri.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;/logout&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//åŒä¸Š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (method == HttpMethod.GET) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (uri.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (uri.startsWith(&lt;span class=&quot;string&quot;&gt;&quot;/status&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="https://www.morethink.cn/categories/Java/"/>
    
    
      <category term="Netty" scheme="https://www.morethink.cn/tags/Netty/"/>
    
  </entry>
  
  <entry>
    <title>Javaä½¿ç”¨UDPå‘é€æ•°æ®åˆ°InfluxDB</title>
    <link href="https://www.morethink.cn/Java-USES-InfluxDB-UDP-sending-data/"/>
    <id>https://www.morethink.cn/Java-USES-InfluxDB-UDP-sending-data/</id>
    <published>2018-09-22T16:00:00.000Z</published>
    <updated>2018-09-23T11:36:26.859Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšå‹æµ‹å¼•æ“ç›¸å…³çš„å¼€å‘ï¼Œéœ€è¦å°†èšåˆæ•°æ®å‘é€åˆ°InfluxDBä¿å­˜ä»¥ä¾¿å®æ—¶åˆ†æå’Œæ§åˆ¶QPSã€‚</p><p>ä¸‹é¢ä»‹ç»å¯¹InfluxDBçš„ä½¿ç”¨ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯InfluxDB"><a href="#ä»€ä¹ˆæ˜¯InfluxDB" class="headerlink" title="ä»€ä¹ˆæ˜¯InfluxDB"></a>ä»€ä¹ˆæ˜¯InfluxDB</h1><p>InfluxDBæ˜¯ä¸€æ¬¾ç”¨Goè¯­è¨€ç¼–å†™çš„å¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚è¯¥æ•°æ®åº“ç°åœ¨ä¸»è¦ç”¨äºå­˜å‚¨æ¶‰åŠå¤§é‡çš„æ—¶é—´æˆ³æ•°æ®ï¼Œå¦‚DevOpsç›‘æ§æ•°æ®ï¼ŒAPP metrics, loTä¼ æ„Ÿå™¨æ•°æ®å’Œå®æ—¶åˆ†ææ•°æ®ã€‚</p><a id="more"></a><p>InfluxDBç‰¹å¾ï¼š</p><ul><li>æ— ç»“æ„(æ— æ¨¡å¼)ï¼šå¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„åˆ—(tags)ã€‚</li><li>å¯ä»¥è®¾ç½®metricçš„ä¿å­˜æ—¶é—´ã€‚</li><li>æ”¯æŒä¸æ—¶é—´æœ‰å…³çš„ç›¸å…³å‡½æ•°(å¦‚minã€maxã€sumã€countã€meanã€medianç­‰)ï¼Œæ–¹ä¾¿ç»Ÿè®¡ã€‚</li><li>æ”¯æŒå­˜å‚¨ç­–ç•¥ï¼šå¯ä»¥ç”¨äºæ•°æ®çš„åˆ æ”¹(influxDBæ²¡æœ‰æä¾›æ•°æ®çš„åˆ é™¤ä¸ä¿®æ”¹æ–¹æ³•)ã€‚</li><li>æ”¯æŒè¿ç»­æŸ¥è¯¢ï¼šæ˜¯æ•°æ®åº“ä¸­è‡ªåŠ¨å®šæ—¶å¯åŠ¨çš„ä¸€ç»„è¯­å¥ï¼Œå’Œå­˜å‚¨ç­–ç•¥æ­é…å¯ä»¥é™ä½InfluxDBçš„ç³»ç»Ÿå ç”¨é‡ã€‚</li><li>åŸç”Ÿçš„HTTPæ”¯æŒï¼Œå†…ç½®HTTP APIã€‚</li><li>æ”¯æŒç±»ä¼¼SQLè¯­æ³•ã€‚</li><li>æ”¯æŒè®¾ç½®æ•°æ®åœ¨é›†ç¾¤ä¸­çš„å‰¯æœ¬æ•°ã€‚</li><li>æ”¯æŒå®šæœŸé‡‡æ ·æ•°æ®ï¼Œå†™å…¥å¦å¤–çš„measurementï¼Œæ–¹ä¾¿åˆ†ç²’åº¦å­˜å‚¨æ•°æ®ã€‚</li><li>è‡ªå¸¦webç®¡ç†ç•Œé¢ï¼Œæ–¹ä¾¿ä½¿ç”¨(ç™»å…¥æ–¹å¼ï¼šhttp://&lt; InfluxDB-IP &gt;:8083)ã€‚</li><li>æ”¯æŒGrafanaç”»å›¾å±•ç¤ºã€‚</li></ul><p>PSï¼šæœ‰äº†InfluxDB+Grafanaåï¼Œä½ å°±å¯ä»¥å†™ä¸€äº›ç®€å•çš„ç¨‹åºäº†ï¼Œå¯ä»¥åªè´Ÿè´£å†™åç«¯é€»è¾‘éƒ¨åˆ†ï¼Œæ•°æ®éƒ½å¯ä»¥å­˜å…¥InfluxDBï¼Œç„¶åé€šè¿‡Grafanaå±•ç¤ºå‡ºæ¥ã€‚</p><h1 id="Macå®‰è£…InfluxDB"><a href="#Macå®‰è£…InfluxDB" class="headerlink" title="Macå®‰è£…InfluxDB"></a>Macå®‰è£…InfluxDB</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> å®‰è£…</span><br><span class="line">brew install influxdb</span><br><span class="line"><span class="meta">#</span> å¯åŠ¨</span><br><span class="line">influxd -config /usr/local/etc/influxdb.conf</span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹influxdbè¿è¡Œé…ç½®</span><br><span class="line">influxd config</span><br><span class="line"><span class="meta">#</span> å¯åŠ¨å®¢æˆ·ç«¯</span><br><span class="line">influx -precision rfc3339</span><br></pre></td></tr></table></figure><h1 id="InfluxDBå¼€å¯UDPé…ç½®"><a href="#InfluxDBå¼€å¯UDPé…ç½®" class="headerlink" title="InfluxDBå¼€å¯UDPé…ç½®"></a>InfluxDBå¼€å¯UDPé…ç½®</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /usr/local/etc/influxdb.conf</span><br></pre></td></tr></table></figure><p>å¼€å¯udpé…ç½®ï¼Œå…¶ä»–ä¸ºé»˜è®¤å€¼<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[[udp]]</span><br><span class="line">  enabled = true</span><br></pre></td></tr></table></figure></p><p>udpé…ç½®å«ä¹‰ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[[udp]] â€“ udpé…ç½®</span><br><span class="line"></span><br><span class="line">    enabledï¼šæ˜¯å¦å¯ç”¨è¯¥æ¨¡å—ï¼Œé»˜è®¤å€¼ï¼šfalseã€‚</span><br><span class="line"></span><br><span class="line">    bind-addressï¼šç»‘å®šåœ°å€ï¼Œé»˜è®¤å€¼ï¼šâ€:8089â€³ã€‚</span><br><span class="line"></span><br><span class="line">    databaseï¼šæ•°æ®åº“åç§°ï¼Œé»˜è®¤å€¼ï¼šâ€udpâ€ã€‚</span><br><span class="line"></span><br><span class="line">    retention-policyï¼šå­˜å‚¨ç­–ç•¥ï¼Œæ— é»˜è®¤å€¼ã€‚</span><br><span class="line"></span><br><span class="line">    batch-sizeï¼šé»˜è®¤å€¼ï¼š5000ã€‚</span><br><span class="line"></span><br><span class="line">    batch-pendingï¼šé»˜è®¤å€¼ï¼š10ã€‚</span><br><span class="line"></span><br><span class="line">    read-bufferï¼šudpè¯»å–bufferçš„å¤§å°ï¼Œ0è¡¨ç¤ºä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å€¼ï¼Œå¦‚æœè¶…è¿‡æ“ä½œç³»ç»Ÿçš„é»˜è®¤é…ç½®åˆ™ä¼šå‡ºé”™ã€‚ è¯¥é…ç½®çš„é»˜è®¤å€¼ï¼š0ã€‚</span><br><span class="line"></span><br><span class="line">    batch-timeoutï¼šè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ï¼šâ€1sâ€ã€‚</span><br><span class="line"></span><br><span class="line">    precisionï¼šæ—¶é—´ç²¾åº¦ï¼Œæ— é»˜è®¤å€¼ã€‚</span><br></pre></td></tr></table></figure></p><h1 id="Javaå‘é€UDPæ•°æ®æŠ¥"><a href="#Javaå‘é€UDPæ•°æ®æŠ¥" class="headerlink" title="Javaå‘é€UDPæ•°æ®æŠ¥"></a>Javaå‘é€UDPæ•°æ®æŠ¥</h1><p>æˆ‘ä»¬çŸ¥é“InfluxDBæ˜¯æ”¯æŒHttpçš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦é‡‡ç”¨UDPæ–¹å¼å‘é€æ•°æ®å‘¢ï¼Ÿ</p><p>åŸºäºä¸‹åˆ—åŸå› ï¼š</p><ol><li>TCPæ•°æ®ä¼ è¾“æ…¢ï¼ŒUDPæ•°æ®ä¼ è¾“å¿«ã€‚</li><li>ç½‘ç»œå¸¦å®½éœ€æ±‚è¾ƒå°ï¼Œè€Œå®æ—¶æ€§è¦æ±‚é«˜ã€‚</li><li>InfluxDBå’ŒæœåŠ¡å™¨åœ¨åŒæœºæˆ¿ï¼Œå‘ç”Ÿæ•°æ®ä¸¢åŒ…çš„å¯èƒ½æ€§è¾ƒå°ï¼Œå³ä½¿çœŸçš„å‘ç”Ÿä¸¢åŒ…ï¼Œå¯¹æ•´ä¸ªè¯·æ±‚æµé‡çš„æ”¶é›†å½±å“ä¹Ÿè¾ƒå°ã€‚</li></ol><p>æˆ‘ä»¬é‡‡ç”¨äº†workerçº¿ç¨‹è°ƒç”¨<code>addMetric</code>æ–¹æ³•å°†æ•°æ®å­˜å‚¨åˆ°ç¼“å­˜ <code>map</code> ä¸­ï¼Œsendçº¿ç¨‹æ± æ¥è¿›è¡Œæ¯ä¸ªæŒ‡å®šæ—¶é—´å‘é€æ•°æ®åˆ°Influxdbã€‚</p><p>ä»£ç å¦‚ä¸‹(ä¹Ÿå¯å‚è€ƒ<code>Jmeter</code>çš„<code>UdpMetricsSender</code>ç±»)ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfluxDBClient</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String measurement = <span class="string">"example"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InetAddress hostAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> udpPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, List&lt;Response&gt;&gt; metrics = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String transaction;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InfluxDBClient</span><span class="params">(String influxdbUrl, String transaction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transaction = transaction;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">"Setting up with url:&#123;&#125;"</span>, influxdbUrl);</span><br><span class="line">            String[] urlComponents = influxdbUrl.split(<span class="string">":"</span>);</span><br><span class="line">            <span class="keyword">if</span> (urlComponents.length == <span class="number">2</span>) &#123;</span><br><span class="line">                hostAddress = InetAddress.getByName(urlComponents[<span class="number">0</span>]);</span><br><span class="line">                udpPort = Integer.parseInt(urlComponents[<span class="number">1</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"InfluxDBClient url '"</span> + influxdbUrl + <span class="string">"'Â is wrong. The format shoule be &lt;host/ip&gt;:&lt;port&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"InfluxDBClient url '"</span> + influxdbUrl + <span class="string">"'Â is wrong. The format shoule be &lt;host/ip&gt;:&lt;port&gt;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMetric</span><span class="params">(Response response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">if</span> (metrics.containsKey(response.getLabel())) &#123;</span><br><span class="line">                metrics.get(response.getLabel()).add(response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                metrics.put(response.getLabel(), <span class="keyword">new</span> ArrayList&lt;&gt;(Collections.singletonList(response)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sendMetrics();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMetrics</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, List&lt;Response&gt;&gt; tempMetrics;</span><br><span class="line">        <span class="comment">//å¤åˆ¶æ•°æ®åˆ°tempMetricsï¼Œæ¸…ç©ºåŸæ¥metricså¹¶åˆå§‹åŒ–ä¸Šæ¬¡çš„å¤§å°</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isEmpty(metrics)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            time = System.currentTimeMillis();</span><br><span class="line">            tempMetrics = metrics;</span><br><span class="line">            metrics = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;Response&gt;&gt; entry : tempMetrics.entrySet()) &#123;</span><br><span class="line">                metrics.put(entry.getKey(), <span class="keyword">new</span> ArrayList&lt;&gt;(entry.getValue().size()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, List&lt;Response&gt;&gt; copyMetrics = tempMetrics;</span><br><span class="line">        <span class="keyword">final</span> List&lt;MetricTuple&gt; aggregateMetrics = aggregate(copyMetrics);</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(aggregateMetrics.size() * <span class="number">200</span>);</span><br><span class="line">        <span class="comment">//å‘é€tempMetrics,ç”Ÿæˆä¸€è¡Œæ•°æ®ï¼Œç„¶åæ¢è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (MetricTuple metric : aggregateMetrics) &#123;</span><br><span class="line">            sb.append(metric.getMeasurement()).append(metric.getTag()).append(<span class="string">" "</span>)</span><br><span class="line">                    .append(metric.getField()).append(<span class="string">" "</span>).append(metric.getTimestamp() + <span class="string">"000000"</span>).append(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//udpå‘é€æ•°æ®åˆ°Influxdb</span></span><br><span class="line">        <span class="keyword">try</span> (DatagramSocket ds = <span class="keyword">new</span> DatagramSocket()) &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] buf = sb.toString().getBytes();</span><br><span class="line">            DatagramPacket dp = <span class="keyword">new</span> DatagramPacket(buf, buf.length, <span class="keyword">this</span>.hostAddress, <span class="keyword">this</span>.udpPort);</span><br><span class="line">            ds.send(dp);</span><br><span class="line">            log.debug(<span class="string">"send &#123;&#125; to influxdb"</span>, sb.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SocketException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Cannot open udp port!"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Error in transferring udp package"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾—åˆ°èšåˆæ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metrics</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;MetricTuple&gt; <span class="title">aggregate</span><span class="params">(Map&lt;String, List&lt;Response&gt;&gt; metrics)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(Map&lt;String, List&lt;Response&gt;&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;Response&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!entry.getValue().isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://jasper-zhang1.gitbooks.io/influxdb/content/" target="_blank" rel="noopener">InfluxDBä¸­æ–‡æ–‡æ¡£</a></li><li><a href="http://www.ywnds.com/?p=10763" target="_blank" rel="noopener">ç©è½¬æ—¶åºæ•°æ®åº“InfluxDB</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨åšå‹æµ‹å¼•æ“ç›¸å…³çš„å¼€å‘ï¼Œéœ€è¦å°†èšåˆæ•°æ®å‘é€åˆ°InfluxDBä¿å­˜ä»¥ä¾¿å®æ—¶åˆ†æå’Œæ§åˆ¶QPSã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»‹ç»å¯¹InfluxDBçš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä»€ä¹ˆæ˜¯InfluxDB&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯InfluxDB&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯InfluxDB&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯InfluxDB&lt;/h1&gt;&lt;p&gt;InfluxDBæ˜¯ä¸€æ¬¾ç”¨Goè¯­è¨€ç¼–å†™çš„å¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚è¯¥æ•°æ®åº“ç°åœ¨ä¸»è¦ç”¨äºå­˜å‚¨æ¶‰åŠå¤§é‡çš„æ—¶é—´æˆ³æ•°æ®ï¼Œå¦‚DevOpsç›‘æ§æ•°æ®ï¼ŒAPP metrics, loTä¼ æ„Ÿå™¨æ•°æ®å’Œå®æ—¶åˆ†ææ•°æ®ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ•°æ®åº“" scheme="https://www.morethink.cn/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="InfluxDB" scheme="https://www.morethink.cn/tags/InfluxDB/"/>
    
      <category term="UDP" scheme="https://www.morethink.cn/tags/UDP/"/>
    
  </entry>
  
  <entry>
    <title>Gitä¸ºæŸä¸ªåŸŸåè®¾ç½®ä»£ç†</title>
    <link href="https://www.morethink.cn/%E5%B7%A5%E5%85%B7/Git-set-proxy-for-a-domain/"/>
    <id>https://www.morethink.cn/å·¥å…·/Git-set-proxy-for-a-domain/</id>
    <published>2018-08-03T16:00:00.000Z</published>
    <updated>2018-08-04T09:51:45.987Z</updated>
    
    <content type="html"><![CDATA[<p>å›½å†…è®¿é—®Githubå¾ˆæ…¢ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä»£ç†æ¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œä½†æ˜¯å¯¹å…¬å¸å†…éƒ¨gitæœåŠ¡å™¨å´ä¸èƒ½ä½¿ç”¨ä»£ç†ã€‚</p><p>ä¸‹é¢é€šè¿‡æ›´æ”¹Gité…ç½®æ–‡ä»¶å¯¹ä¸åŒçš„åŸŸåä½¿ç”¨ä¸åŒçš„ä»£ç†é…ç½®ã€‚<br><br><a id="more"></a></p><ol><li><p>æ‰“å¼€Git é…ç½®æ–‡ä»¶</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi ~/.gitconfig</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[http "https://github.com/"]</span><br><span class="line">    proxy = http://127.0.0.1:1081</span><br><span class="line">[https "https://github.com/"]</span><br><span class="line">    proxy = http://127.0.0.1:1081</span><br><span class="line">[http "https://my.comapnyserver.com/"]</span><br><span class="line">    proxy = ""</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å›½å†…è®¿é—®Githubå¾ˆæ…¢ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä»£ç†æ¥åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œä½†æ˜¯å¯¹å…¬å¸å†…éƒ¨gitæœåŠ¡å™¨å´ä¸èƒ½ä½¿ç”¨ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢é€šè¿‡æ›´æ”¹Gité…ç½®æ–‡ä»¶å¯¹ä¸åŒçš„åŸŸåä½¿ç”¨ä¸åŒçš„ä»£ç†é…ç½®ã€‚&lt;br&gt;&lt;br&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Git" scheme="https://www.morethink.cn/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Javaå‹ç¼©/è§£å‹ .zipã€.tar.gzã€.tar.bz2(æ”¯æŒä¸­æ–‡)</title>
    <link href="https://www.morethink.cn/Java%E5%8E%8B%E7%BC%A9/%E8%A7%A3%E5%8E%8B%20.zip%E3%80%81.tar.gz%E3%80%81.tar.bz2(%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87)/"/>
    <id>https://www.morethink.cn/Javaå‹ç¼©/è§£å‹ .zipã€.tar.gzã€.tar.bz2(æ”¯æŒä¸­æ–‡)/</id>
    <published>2018-08-03T16:00:00.000Z</published>
    <updated>2018-10-14T16:09:56.337Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»Javaå‹ç¼©/è§£å‹.zipã€.tar.gzã€.tar.bz2çš„æ–¹å¼ã€‚</p><ol><li>å¯¹äºzipæ–‡ä»¶ï¼šä½¿ç”¨<code>java.util.zip.ZipEntry</code> å’Œ <code>java.util.zip.ZipFile</code>ï¼Œé€šè¿‡è®¾ç½®<code>Charset</code>ä¸º<code>StandardCharsets.UTF_8</code>æ”¯æŒä¸­æ–‡ã€‚</li><li>å¯¹äº.tar.gzã€tgzæ–‡ä»¶ï¼šå¯ä»¥çœ‹åšå…ˆç”¨taræ‰“åŒ…ï¼Œå†ä½¿ç”¨gzè¿›è¡Œå‹ç¼©ã€‚ä½¿ç”¨<code>commons-compress</code>åŒ…çš„<code>TarArchiveInputStream</code>å’Œ<code>GzipCompressorInputStream</code>ã€‚</li><li>å¯¹äº.tar.bz2æ–‡ä»¶ï¼šå¯ä»¥çœ‹åšå…ˆç”¨taræ‰“åŒ…ï¼Œå†ä½¿ç”¨bz2è¿›è¡Œå‹ç¼©ã€‚ä½¿ç”¨<code>commons-compress</code>åŒ…çš„<code>TarArchiveInputStream</code>å’Œ<code>BZip2CompressorInputStream</code>ã€‚</li></ol><p>åœ¨è¿™é‡Œæœ‰ä¸ªé—®é¢˜å¦‚æœä½¿ç”¨<code>TarInputStream</code>æ­é…jdkçš„ <code>GZIPInputStream</code>ä¼šäº§ç”Ÿä¹±ç ã€‚è€Œä½¿ç”¨<code>commons-compress</code>åŒ…çš„<code>TarArchiveInputStream</code>å’Œ<code>GzipCompressorInputStream</code>åˆ™å¯è§£å†³ä¹±ç é—®é¢˜ã€‚</p><a id="more"></a><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZipUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(ZipUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_SIZE = <span class="number">1024</span> * <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ZipUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§æœ‰å‡½æ•°å°†æ–‡ä»¶é›†åˆå‹ç¼©æˆtaråŒ…åè¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> files  è¦å‹ç¼©çš„æ–‡ä»¶é›†åˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target tar è¾“å‡ºæµçš„ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> File  æŒ‡å®šè¿”å›çš„ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> File <span class="title">pack</span><span class="params">(List&lt;File&gt; files, File target)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(target)) &#123;</span><br><span class="line">            <span class="keyword">try</span> (BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(fos, BUFFER_SIZE)) &#123;</span><br><span class="line">                <span class="keyword">try</span> (TarArchiveOutputStream taos = <span class="keyword">new</span> TarArchiveOutputStream(bos)) &#123;</span><br><span class="line">                    <span class="comment">//è§£å†³æ–‡ä»¶åè¿‡é•¿é—®é¢˜</span></span><br><span class="line">                    taos.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);</span><br><span class="line">                    <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                        taos.putArchiveEntry(<span class="keyword">new</span> TarArchiveEntry(file));</span><br><span class="line">                        <span class="keyword">try</span> (FileInputStream fis = <span class="keyword">new</span> FileInputStream(file)) &#123;</span><br><span class="line">                            IOUtils.copy(fis, taos);</span><br><span class="line">                            taos.closeArchiveEntry();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†tarå‹ç¼©æˆtar.gzæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outPutPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">compress</span><span class="params">(List&lt;File&gt; list, String outPutPath, String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File outPutFile = <span class="keyword">new</span> File(outPutPath + File.separator + fileName + <span class="string">".tar.gz"</span>);</span><br><span class="line">        File tempTar = <span class="keyword">new</span> File(<span class="string">"temp.tar"</span>);</span><br><span class="line">        <span class="keyword">try</span> (FileInputStream fis = <span class="keyword">new</span> FileInputStream(pack(list, tempTar))) &#123;</span><br><span class="line">            <span class="keyword">try</span> (BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(fis, BUFFER_SIZE)) &#123;</span><br><span class="line">                <span class="keyword">try</span> (FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(outPutFile)) &#123;</span><br><span class="line">                    <span class="keyword">try</span> (GZIPOutputStream gzp = <span class="keyword">new</span> GZIPOutputStream(fos)) &#123;</span><br><span class="line">                        <span class="keyword">int</span> count;</span><br><span class="line">                        <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_SIZE];</span><br><span class="line">                        <span class="keyword">while</span> ((count = bis.read(data, <span class="number">0</span>, BUFFER_SIZE)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                            gzp.write(data, <span class="number">0</span>, count);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Files.deleteIfExists(tempTar.toPath());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> outPutFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">decompress</span><span class="params">(String filePath, String outputDir, <span class="keyword">boolean</span> isDeleted)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            LOG.error(<span class="string">"decompress file not exist."</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (filePath.endsWith(<span class="string">".zip"</span>)) &#123;</span><br><span class="line">                unZip(file, outputDir);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (filePath.endsWith(<span class="string">".tar.gz"</span>) || filePath.endsWith(<span class="string">".tgz"</span>)) &#123;</span><br><span class="line">                decompressTarGz(file, outputDir);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (filePath.endsWith(<span class="string">".tar.bz2"</span>)) &#123;</span><br><span class="line">                decompressTarBz2(file, outputDir);</span><br><span class="line">            &#125;</span><br><span class="line">            filterFile(<span class="keyword">new</span> File(outputDir));</span><br><span class="line">            <span class="keyword">if</span> (isDeleted) &#123;</span><br><span class="line">                FileUtils.deleteQuietly(file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOG.error(<span class="string">"decompress occur error."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å‹ .zip æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file      è¦è§£å‹çš„zipæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputDir è¦è§£å‹åˆ°æŸä¸ªæŒ‡å®šçš„ç›®å½•ä¸‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unZip</span><span class="params">(File file, String outputDir)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (ZipFile zipFile = <span class="keyword">new</span> ZipFile(file, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line">            createDirectory(outputDir, <span class="keyword">null</span>);</span><br><span class="line">            Enumeration&lt;?&gt; enums = zipFile.entries();</span><br><span class="line">            <span class="keyword">while</span> (enums.hasMoreElements()) &#123;</span><br><span class="line">                ZipEntry entry = (ZipEntry) enums.nextElement();</span><br><span class="line">                <span class="keyword">if</span> (entry.isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">//åˆ›å»ºç©ºç›®å½•</span></span><br><span class="line">                    createDirectory(outputDir, entry.getName());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> (InputStream in = zipFile.getInputStream(entry)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> (OutputStream out = <span class="keyword">new</span> FileOutputStream(</span><br><span class="line">                                <span class="keyword">new</span> File(outputDir + File.separator + entry.getName()))) &#123;</span><br><span class="line">                            writeFile(in, out);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">decompressTarGz</span><span class="params">(File file, String outputDir)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (TarArchiveInputStream tarIn = <span class="keyword">new</span> TarArchiveInputStream(</span><br><span class="line">                <span class="keyword">new</span> GzipCompressorInputStream(</span><br><span class="line">                        <span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">                                <span class="keyword">new</span> FileInputStream(file))))) &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line">            createDirectory(outputDir, <span class="keyword">null</span>);</span><br><span class="line">            TarArchiveEntry entry = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((entry = tarIn.getNextTarEntry()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ˜¯ç›®å½•</span></span><br><span class="line">                <span class="keyword">if</span> (entry.isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">//åˆ›å»ºç©ºç›®å½•</span></span><br><span class="line">                    createDirectory(outputDir, entry.getName());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//æ˜¯æ–‡ä»¶</span></span><br><span class="line">                    <span class="keyword">try</span> (OutputStream out = <span class="keyword">new</span> FileOutputStream(</span><br><span class="line">                            <span class="keyword">new</span> File(outputDir + File.separator + entry.getName()))) &#123;</span><br><span class="line">                        writeFile(tarIn, out);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å‹ç¼©tar.bz2æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file      å‹ç¼©åŒ…æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputDir ç›®æ ‡æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">decompressTarBz2</span><span class="params">(File file, String outputDir)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (TarArchiveInputStream tarIn =</span><br><span class="line">                     <span class="keyword">new</span> TarArchiveInputStream(</span><br><span class="line">                             <span class="keyword">new</span> BZip2CompressorInputStream(</span><br><span class="line">                                     <span class="keyword">new</span> FileInputStream(file)))) &#123;</span><br><span class="line">            createDirectory(outputDir, <span class="keyword">null</span>);</span><br><span class="line">            TarArchiveEntry entry;</span><br><span class="line">            <span class="keyword">while</span> ((entry = tarIn.getNextTarEntry()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (entry.isDirectory()) &#123;</span><br><span class="line">                    createDirectory(outputDir, entry.getName());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> (OutputStream out = <span class="keyword">new</span> FileOutputStream(</span><br><span class="line">                            <span class="keyword">new</span> File(outputDir + File.separator + entry.getName()))) &#123;</span><br><span class="line">                        writeFile(tarIn, out);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†™æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> out</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">(InputStream in, OutputStream out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> length;</span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_SIZE];</span><br><span class="line">        <span class="keyword">while</span> ((length = in.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            out.write(b, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputDir</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subDir</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createDirectory</span><span class="params">(String outputDir, String subDir)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(outputDir);</span><br><span class="line">        <span class="comment">//å­ç›®å½•ä¸ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (!(subDir == <span class="keyword">null</span> || subDir.trim().equals(<span class="string">""</span>))) &#123;</span><br><span class="line">            file = <span class="keyword">new</span> File(outputDir + File.separator + subDir);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!file.getParentFile().exists()) &#123;</span><br><span class="line">                file.getParentFile().mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤Macå‹ç¼©å†è§£å‹äº§ç”Ÿçš„ __MACOSX æ–‡ä»¶å¤¹å’Œ .å¼€å¤´çš„å…¶ä»–æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filteredFile</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">filterFile</span><span class="params">(File filteredFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (filteredFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">            File[] files = filteredFile.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                <span class="keyword">if</span> (file.getName().startsWith(<span class="string">"."</span>) ||</span><br><span class="line">                        (file.isDirectory() &amp;&amp; file.getName().equals(<span class="string">"__MACOSX"</span>))) &#123;</span><br><span class="line">                    FileUtils.deleteQuietly(file);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç åœ°å€ï¼š <a href="https://github.com/morethink/code/blob/master/java/tools/src/main/java/cn/morethink/tools/util/ZipUtil.java" target="_blank" rel="noopener">https://github.com/morethink/code/blob/master/java/tools/src/main/java/cn/morethink/tools/util/ZipUtil.java</a></p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://www.programcreek.com/java-api-examples/?api=org.apache.commons.compress.archivers.tar.TarArchiveInputStream" target="_blank" rel="noopener">commons-compresså®˜æ–¹å®ä¾‹</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä»‹ç»Javaå‹ç¼©/è§£å‹.zipã€.tar.gzã€.tar.bz2çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹äºzipæ–‡ä»¶ï¼šä½¿ç”¨&lt;code&gt;java.util.zip.ZipEntry&lt;/code&gt; å’Œ &lt;code&gt;java.util.zip.ZipFile&lt;/code&gt;ï¼Œé€šè¿‡è®¾ç½®&lt;code&gt;Charset&lt;/code&gt;ä¸º&lt;code&gt;StandardCharsets.UTF_8&lt;/code&gt;æ”¯æŒä¸­æ–‡ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº.tar.gzã€tgzæ–‡ä»¶ï¼šå¯ä»¥çœ‹åšå…ˆç”¨taræ‰“åŒ…ï¼Œå†ä½¿ç”¨gzè¿›è¡Œå‹ç¼©ã€‚ä½¿ç”¨&lt;code&gt;commons-compress&lt;/code&gt;åŒ…çš„&lt;code&gt;TarArchiveInputStream&lt;/code&gt;å’Œ&lt;code&gt;GzipCompressorInputStream&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äº.tar.bz2æ–‡ä»¶ï¼šå¯ä»¥çœ‹åšå…ˆç”¨taræ‰“åŒ…ï¼Œå†ä½¿ç”¨bz2è¿›è¡Œå‹ç¼©ã€‚ä½¿ç”¨&lt;code&gt;commons-compress&lt;/code&gt;åŒ…çš„&lt;code&gt;TarArchiveInputStream&lt;/code&gt;å’Œ&lt;code&gt;BZip2CompressorInputStream&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨è¿™é‡Œæœ‰ä¸ªé—®é¢˜å¦‚æœä½¿ç”¨&lt;code&gt;TarInputStream&lt;/code&gt;æ­é…jdkçš„ &lt;code&gt;GZIPInputStream&lt;/code&gt;ä¼šäº§ç”Ÿä¹±ç ã€‚è€Œä½¿ç”¨&lt;code&gt;commons-compress&lt;/code&gt;åŒ…çš„&lt;code&gt;TarArchiveInputStream&lt;/code&gt;å’Œ&lt;code&gt;GzipCompressorInputStream&lt;/code&gt;åˆ™å¯è§£å†³ä¹±ç é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>MongoDB åŠ Mysql èƒŒåçš„ B/B+æ ‘</title>
    <link href="https://www.morethink.cn/%E7%AE%97%E6%B3%95/data-structure-behind-the-index/"/>
    <id>https://www.morethink.cn/ç®—æ³•/data-structure-behind-the-index/</id>
    <published>2018-06-30T16:00:00.000Z</published>
    <updated>2018-08-22T11:18:45.493Z</updated>
    
    <content type="html"><![CDATA[<p>ç´¢å¼•æ˜¯æ•°æ®åº“å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªåå°å¼€å‘äººå‘˜éƒ½åº”è¯¥å¯¹ç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„æœ‰æ‰€äº†è§£ã€‚</p><p>æœ¬æ–‡é€šè¿‡åˆ†æB-TreeåŠB-/+Treeæ•°æ®ç»“æ„åŠç´¢å¼•æ€§èƒ½åˆ†æåŠç£ç›˜å­˜å–åŸç†å°è¯•ç€å›ç­”ä¸€ä¸‹é—®é¢˜ï¼š</p><ol><li>ä¸ºä»€ä¹ˆB-Treeé€‚åˆæ•°æ®åº“ç´¢å¼•åŠçº¢é»‘æ ‘çš„äºŒå‰å¹³è¡¡æ ‘ä¸é€‚åˆä½œä¸ºç´¢å¼•</li><li>B+Treeæ¯”BTreeåšç´¢å¼•çš„ä¼˜åŠ¿</li><li>ä¸ºä»€ä¹ˆMongoDBé‡‡ç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„è€ŒMySQLé‡‡ç”¨B+Treeä½œä¸ºç´¢å¼•å­˜å‚¨ç»“æ„</li></ol><a id="more"></a><h1 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h1><p>B æ ‘ï¼ˆB-Treeï¼‰æ˜¯ä¸ºç£ç›˜ç­‰è¾…åŠ©å­˜å–è®¾å¤‡è®¾è®¡çš„ä¸€ç§å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œå®ƒå®ç°äº†ä»¥ $O(\lg n)$ æ—¶é—´å¤æ‚åº¦æ‰§è¡ŒæŸ¥æ‰¾ã€é¡ºåºè¯»å–ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ç”±äº B æ ‘å’Œ B æ ‘çš„å˜ç§åœ¨é™ä½ç£ç›˜ I/O æ“ä½œæ¬¡æ•°æ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼Œæ‰€ä»¥ç»å¸¸ç”¨äºè®¾è®¡æ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®åº“ã€‚</p><p>ä½¿ç”¨é˜¶æ¥å®šä¹‰ B æ ‘ï¼Œä¸€æ£µ m é˜¶çš„ B æ ‘ï¼Œéœ€è¦æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæ‹¥æœ‰mä¸ªå­èŠ‚ç‚¹ä¸”m&gt;=2ï¼Œç©ºæ ‘é™¤å¤–</li><li><strong>é™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—æ•°é‡å¤§äºç­‰äº<code>ceil(m/2)-1</code>ï¼Œå°äºç­‰äº<code>m-1</code>ï¼Œéæ ¹èŠ‚ç‚¹å…³é”®å­—æ•°å¿…é¡»&gt;=2</strong></li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡åœ¨åŒä¸€å±‚ã€å¶å­èŠ‚ç‚¹é™¤äº†åŒ…å«äº†å…³é”®å­—å’Œå…³é”®å­—è®°å½•çš„æŒ‡é’ˆå¤–ä¹Ÿæœ‰æŒ‡å‘å…¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆåªä¸è¿‡å…¶æŒ‡é’ˆåœ°å€éƒ½ä¸ºnullå¯¹åº”ä¸‹å›¾æœ€åä¸€å±‚èŠ‚ç‚¹çš„ç©ºæ ¼å­</li><li><strong>å¦‚æœä¸€ä¸ªéå¶èŠ‚ç‚¹æœ‰nä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹çš„å…³é”®å­—æ•°ç­‰äºn-1</strong></li><li>æ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—æ˜¯æŒ‰é€’å¢æ¬¡åºæ’åˆ—ï¼Œå¹¶éµå¾ªå·¦å°å³å¤§åŸåˆ™</li></ol><p>æ³¨ï¼š</p><ol><li>mé˜¶ä»£è¡¨ä¸€ä¸ªæ ‘èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼Œmé˜¶=mè·¯,å½“m=2åˆ™æ˜¯2å‰æ ‘ï¼Œm=3åˆ™æ˜¯3å‰ã€‚</li><li>ceil()æ˜¯ä¸ªæœæ­£æ— ç©·æ–¹å‘å–æ•´çš„å‡½æ•°ï¼Œå¦‚ceil(1.1)ç»“æœä¸º2ï¼Œå³å‘ä¸Šå–æ•´ã€‚</li></ol><p><img src="https://images.morethink.cn/B-Tree-1.jpg" alt="B-Tree" title="B-Tree"></p><p>B æ ‘ä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºå†…éƒ¨èŠ‚ç‚¹ï¼ˆInternal Nodeï¼‰å’Œå¶èŠ‚ç‚¹ï¼ˆLeaf Nodeï¼‰ï¼Œå†…éƒ¨èŠ‚ç‚¹ä¹Ÿå°±æ˜¯éå¶èŠ‚ç‚¹ï¼ˆNon-Leaf Nodeï¼‰ã€‚</p><h2 id="B-Treeçš„æŸ¥æ‰¾"><a href="#B-Treeçš„æŸ¥æ‰¾" class="headerlink" title="B-Treeçš„æŸ¥æ‰¾"></a>B-Treeçš„æŸ¥æ‰¾</h2><p>B-Treeçš„æŸ¥æ‰¾è¿‡ç¨‹ï¼šæ ¹æ®ç»™å®šå€¼æŸ¥æ‰¾ç»“ç‚¹å’Œåœ¨ç»“ç‚¹çš„å…³é”®å­—ä¸­è¿›è¡ŒæŸ¥æ‰¾äº¤å‰è¿›è¡Œã€‚</p><p>é¦–å…ˆä»æ ¹ç»“ç‚¹å¼€å§‹é‡å¤å¦‚ä¸‹è¿‡ç¨‹ï¼šè‹¥æ¯”ç»“ç‚¹çš„ç¬¬ä¸€ä¸ªå…³é”®å­—å°ï¼Œåˆ™æŸ¥æ‰¾åœ¨è¯¥ç»“ç‚¹ç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹è¿›è¡Œï¼›è‹¥ç­‰äºç»“ç‚¹ä¸­æŸä¸ªå…³é”®å­—ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›è‹¥åœ¨ä¸¤ä¸ªå…³é”®å­—ä¹‹é—´ï¼Œåˆ™æŸ¥æ‰¾åœ¨å®ƒä»¬ä¹‹é—´çš„æŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹è¿›è¡Œï¼›è‹¥æ¯”è¯¥ç»“ç‚¹æ‰€æœ‰å…³é”®å­—å¤§ï¼Œåˆ™æŸ¥æ‰¾åœ¨è¯¥ç»“ç‚¹æœ€åä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹è¿›è¡Œï¼›è‹¥æŸ¥æ‰¾å·²ç»åˆ°è¾¾æŸä¸ªå¶ç»“ç‚¹ï¼Œåˆ™è¯´æ˜ç»™å®šå€¼å¯¹åº”çš„æ•°æ®è®°å½•ä¸å­˜åœ¨ï¼ŒæŸ¥æ‰¾å¤±è´¥ã€‚</p><p>ä¾‹å¦‚ï¼š<br>åœ¨ä¸€æ£µ 5 é˜¶B-æ ‘ä¸­æŸ¥æ‰¾å…ƒç´  29</p><p><img src="https://upload-images.jianshu.io/upload_images/1630488-43897a4dd77bf18f.gif" alt="" title="B-Treeçš„æŸ¥è¯¢"></p><p>é¦–å…ˆ29æ¯”æ ¹èŠ‚ç‚¹å€¼å¤§ï¼Œæ‰€ä»¥æ‰¾æ ¹èŠ‚ç‚¹çš„å³å­æ•°ï¼Œç„¶åå†æ ¹æ®å€¼å¾—åˆ¤æ–­ï¼Œå‘ç° 29 ä»‹äº 28 å’Œ 48 ä¹‹é—´ï¼Œç„¶ååœ¨ä»ä¸­é—´å­æ ‘ç»§ç»­æŸ¥æ‰¾ä¸‹å»ã€‚</p><h2 id="B-Treeçš„æ’å…¥"><a href="#B-Treeçš„æ’å…¥" class="headerlink" title="B-Treeçš„æ’å…¥"></a>B-Treeçš„æ’å…¥</h2><p>æ’å…¥çš„è¿‡ç¨‹åˆ†ä¸¤æ­¥å®Œæˆï¼š</p><ol><li><p>åˆ©ç”¨å‰è¿°çš„B-æ ‘çš„æŸ¥æ‰¾ç®—æ³•æŸ¥æ‰¾å…³é”®å­—çš„æ’å…¥ä½ç½®ã€‚è‹¥æ‰¾åˆ°ï¼Œåˆ™è¯´æ˜è¯¥å…³é”®å­—å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™æŸ¥æ‰¾æ“ä½œå¿…å¤±è´¥äºæŸä¸ªæœ€ä½å±‚çš„éç»ˆç«¯ç»“ç‚¹ä¸Šã€‚</p></li><li><p>åˆ¤æ–­è¯¥ç»“ç‚¹æ˜¯å¦è¿˜æœ‰ç©ºä½ç½®ã€‚<strong>å³åˆ¤æ–­è¯¥ç»“ç‚¹çš„å…³é”®å­—æ€»æ•°æ˜¯å¦æ»¡è¶³n&lt;=m-1</strong>ã€‚è‹¥æ»¡è¶³ï¼Œåˆ™è¯´æ˜è¯¥ç»“ç‚¹è¿˜æœ‰ç©ºä½ç½®ï¼Œç›´æ¥æŠŠå…³é”®å­—kæ’å…¥åˆ°è¯¥ç»“ç‚¹çš„åˆé€‚ä½ç½®ä¸Šã€‚è‹¥ä¸æ»¡è¶³ï¼Œè¯´æ˜è¯¥ç»“ç‚¹å·±æ²¡æœ‰ç©ºä½ç½®ï¼Œéœ€è¦æŠŠç»“ç‚¹åˆ†è£‚æˆä¸¤ä¸ªã€‚</p></li></ol><p>åˆ†è£‚çš„æ–¹æ³•æ˜¯ï¼š<br>ç”Ÿæˆä¸€æ–°ç»“ç‚¹ã€‚æŠŠåŸç»“ç‚¹ä¸Šçš„å…³é”®å­—å’ŒkæŒ‰å‡åºæ’åºåï¼Œ<strong>ä»ä¸­é—´ä½ç½®æŠŠå…³é”®å­—ï¼ˆä¸åŒ…æ‹¬ä¸­é—´ä½ç½®çš„å…³é”®å­—ï¼‰åˆ†æˆä¸¤éƒ¨åˆ†</strong>ã€‚å·¦éƒ¨åˆ†æ‰€å«å…³é”®å­—æ”¾åœ¨æ—§ç»“ç‚¹ä¸­ï¼Œå³éƒ¨åˆ†æ‰€å«å…³é”®å­—æ”¾åœ¨æ–°ç»“ç‚¹ä¸­ï¼Œä¸­é—´ä½ç½®çš„å…³é”®å­—è¿åŒæ–°ç»“ç‚¹çš„å­˜å‚¨ä½ç½®æ’å…¥åˆ°çˆ¶ç»“ç‚¹ä¸­ã€‚å¦‚æœçˆ¶ç»“ç‚¹çš„å…³é”®å­—ä¸ªæ•°ä¹Ÿè¶…è¿‡ï¼ˆm-1ï¼‰ï¼Œåˆ™è¦å†åˆ†è£‚ï¼Œå†å¾€ä¸Šæ’ã€‚ç›´è‡³è¿™ä¸ªè¿‡ç¨‹ä¼ åˆ°æ ¹ç»“ç‚¹ä¸ºæ­¢ã€‚</p><p>ä¾‹å­ï¼š</p><p><strong>å¦‚æœè¯¥èŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°è¿˜æ²¡è¾¾åˆ° mï¼Œåˆ™æ’å…¥å®Œåæ— éœ€å¤„ç†</strong><br>æ¯”å¦‚ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1630488-25083e10d9708891.gif" alt="" title="åœ¨ B-æ ‘ä¸­æ’å…¥å…ƒç´  3"></p><p><strong>å¦‚æœè¯¥èŠ‚ç‚¹å…ƒç´ ä¸ªæ•°è¾¾åˆ° m æ—¶ï¼Œè¿™æ—¶å€™å°†å…ƒç´ æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ï¼Œå°†æœ€ä¸­é—´çš„å…ƒç´ å–å‡ºï¼Œæˆä¸ºè¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å…ƒç´ ï¼Œç„¶åå°†å…¶ä½™å·¦å³å…ƒç´ æ‹†æˆä¸¤ä¸ªæ–°èŠ‚ç‚¹</strong></p><p>æ¯”å¦‚ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1630488-afa3b6b35908cf99.gif" alt="" title="åœ¨ B-æ ‘ä¸­æ’å…¥å…ƒç´  44"></p><p><strong>åˆšæ‰çš„æ“ä½œå¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ° mï¼Œè¿™æ—¶å€™ç”¨æƒ…å†µ 2 è¿­ä»£å¤„ç†ï¼Œç›´åˆ°å¦‚æœé‡åˆ°æ ¹ç»“ç‚¹å…ƒç´ ä¸ªæ•°è¾¾åˆ° mï¼Œåˆ™æœ€ä¸­é—´å…ƒç´ å°†æˆä¸ºæ–°çš„æ ¹ç»“ç‚¹ã€‚</strong></p><p>æ¯”å¦‚ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1630488-8dda91b45852ba9d.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="" title="åœ¨ B-æ ‘ä¸­æ’å…¥å…ƒç´  45"></p><h2 id="B-Tree-çš„åˆ é™¤"><a href="#B-Tree-çš„åˆ é™¤" class="headerlink" title="B-Tree çš„åˆ é™¤"></a>B-Tree çš„åˆ é™¤</h2><p>æˆ‘ä»¬éœ€è¦åˆ†ä¸¤ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼š</p><ul><li>å¦‚æœè¯¥å…ƒç´ å­˜åœ¨äºå¶å­ç»“ç‚¹ï¼Œç›´æ¥åˆ é™¤å®ƒï¼Œæ— éœ€è¿›è¡Œå…¶å®ƒå¤„ç†ã€‚</li><li>å¦‚æœè¯¥å…ƒç´ å­˜åœ¨äºéå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåˆ é™¤å®ƒå°†ä¼šç•™ä¸‹ä¸€ä¸ªç©ºä½ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€äº›å¤„ç†æ¥å¡«å……è¯¥ä½ç½®ã€‚<br>å› ä¸ºèŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°åœ¨ [M/2, M] çš„èŒƒå›´å†…ï¼Œæ‰€ä»¥æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬ä»¥ 5 é˜¶B-æ ‘ä¸ºä¾‹ï¼Œåˆ¤æ–­èŠ‚ç‚¹å…ƒç´ æ˜¯å¦å……è¶³å³æ»¡è¶³ä¸ªæ•°åˆ™è‡³å°‘æ‹¥æœ‰ä¸‰ï¼ˆ2 + 1ï¼‰ä¸ªå…ƒç´ çš„èŠ‚ç‚¹æ‰ç®—æ˜¯æœ‰å……è¶³çš„å…ƒç´ ã€‚<ol><li>å¦‚æœè¢«åˆ å…ƒç´ çš„å·¦å­æ ‘æ‹¥æœ‰è¶³å¤Ÿçš„å…ƒç´ ï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªéœ€æ‹¿å·¦å­èŠ‚ç‚¹çš„æœ€å¤§å€¼å…ƒç´ ä¸Šæ¥å¡«å……å³å¯</li><li>å½“å·¦å­æ ‘ä¸å¤Ÿå…ƒç´ è€Œå³å­æ ‘å…ƒç´ å……è¶³æ—¶ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ‹¿å³å­æ ‘çš„æœ€å°å€¼å…ƒç´ ä¸Šæ¥è¿›è¡Œå¡«å……</li><li>å½“å·¦å³å­æ ‘æ‰€å«å…ƒç´ å‡ä¸è¶³æ—¶ï¼Œä½†å·¦å­æ ‘çš„å·¦è¾¹å…„å¼ŸèŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°å……è¶³ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦æ‹¿å·¦è¾¹çš„å…„å¼ŸèŠ‚ç‚¹æ¥è¿›è¡Œè°ƒæ•´ã€‚</li><li>å½“å·¦å³å­æ ‘æ‰€å«å…ƒç´ å‡ä¸è¶³æ—¶ï¼Œä½†å·¦å­æ ‘çš„å·¦è¾¹å…„å¼ŸèŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•°ä¹Ÿä¸è¶³æ—¶ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯æ‹¿å·¦å­æ ‘çš„æœ€å¤§å€¼å…ƒç´ è¿›è¡Œå¡«å……ï¼Œä¹‹åå†å°†è¯¥èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹åˆå¹¶å½¢æˆæ–°çš„èŠ‚ç‚¹ã€‚</li></ol></li></ul><h1 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h1><p>B-Treeæœ‰è®¸å¤šå˜ç§ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯B+Treeï¼Œä¾‹å¦‚MySQLå°±æ™®éä½¿ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p><p>ä¸B-Treeç›¸æ¯”ï¼ŒB+Treeæœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸Šé™ä¸º2dè€Œä¸æ˜¯2d+1ã€‚</li><li>B+Treeå¶å­èŠ‚ç‚¹ä¿å­˜äº†çˆ¶èŠ‚ç‚¹çš„æ‰€æœ‰å…³é”®å­—å’Œå…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹çš„å…³é”®å­—ä»å°åˆ°å¤§é“¾æ¥</li><li>å†…èŠ‚ç‚¹ä¸å­˜å‚¨dataï¼Œåªå­˜å‚¨keyï¼›å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æŒ‡é’ˆã€‚å› æ­¤æ‰€æœ‰æ•°æ®åœ°å€å¿…é¡»è¦åˆ°å¶å­èŠ‚ç‚¹æ‰èƒ½è·å–åˆ°ï¼Œæ‰€ä»¥æ¯æ¬¡æ•°æ®æŸ¥è¯¢çš„æ¬¡æ•°éƒ½ä¸€æ ·ã€‚<br><img src="https://images.morethink.cn/B+Tree.jpg" alt="" title="B+Tree"></li></ul><h1 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h1><p>çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨B-/+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œè¿™ä¸€èŠ‚å°†ç»“åˆè®¡ç®—æœºç»„æˆåŸç†ç›¸å…³çŸ¥è¯†è®¨è®ºB-/+Treeä½œä¸ºç´¢å¼•çš„ç†è®ºåŸºç¡€ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I/Oæ¶ˆè€—ï¼Œç›¸å¯¹äºå†…å­˜å­˜å–ï¼ŒI/Oå­˜å–çš„æ¶ˆè€—è¦é«˜å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥è¯„ä»·ä¸€ä¸ªæ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•çš„ä¼˜åŠ£æœ€é‡è¦çš„æŒ‡æ ‡å°±æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oæ“ä½œæ¬¡æ•°çš„æ¸è¿›å¤æ‚åº¦ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>ç´¢å¼•çš„ç»“æ„ç»„ç»‡è¦å°½é‡å‡å°‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oçš„å­˜å–æ¬¡æ•°</strong>ã€‚</p><p>ä¸‹é¢å…ˆä»‹ç»å†…å­˜å’Œç£ç›˜å­˜å–åŸç†ï¼Œç„¶åå†ç»“åˆè¿™äº›åŸç†åˆ†æB-/+Treeä½œä¸ºç´¢å¼•çš„æ•ˆç‡ã€‚</p><h1 id="ç£ç›˜å­˜å–åŸç†"><a href="#ç£ç›˜å­˜å–åŸç†" class="headerlink" title="ç£ç›˜å­˜å–åŸç†"></a>ç£ç›˜å­˜å–åŸç†</h1><p>ç´¢å¼•ä¸€èˆ¬ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç´¢å¼•æ£€ç´¢éœ€è¦ç£ç›˜I/Oæ“ä½œã€‚ä¸ä¸»å­˜ä¸åŒï¼Œç£ç›˜I/Oå­˜åœ¨æœºæ¢°è¿åŠ¨è€—è´¹ï¼Œå› æ­¤ç£ç›˜I/Oçš„æ—¶é—´æ¶ˆè€—æ˜¯å·¨å¤§çš„ã€‚</p><p>ä¸‹é¢æ˜¯ç£ç›˜çš„æ•´ä½“ç»“æ„ç¤ºæ„å›¾ï¼š</p><p><img src="http://blog.codinglabs.org/uploads/pictures/theory-of-mysql-index/6.png" alt="" title="ç£ç›˜çš„æ•´ä½“ç»“æ„"></p><p>ä¸€ä¸ªç£ç›˜ç”±å¤§å°ç›¸åŒä¸”åŒè½´çš„åœ†å½¢ç›˜ç‰‡ç»„æˆï¼Œç£ç›˜å¯ä»¥è½¬åŠ¨ï¼ˆå„ä¸ªç£ç›˜å¿…é¡»åŒæ­¥è½¬åŠ¨ï¼‰ã€‚åœ¨ç£ç›˜çš„ä¸€ä¾§æœ‰ç£å¤´æ”¯æ¶ï¼Œç£å¤´æ”¯æ¶å›ºå®šäº†ä¸€ç»„ç£å¤´ï¼Œæ¯ä¸ªç£å¤´è´Ÿè´£å­˜å–ä¸€ä¸ªç£ç›˜çš„å†…å®¹ã€‚ç£å¤´ä¸èƒ½è½¬åŠ¨ï¼Œä½†æ˜¯å¯ä»¥æ²¿ç£ç›˜åŠå¾„æ–¹å‘è¿åŠ¨ï¼ˆå®é™…æ˜¯æ–œåˆ‡å‘è¿åŠ¨ï¼‰ï¼Œæ¯ä¸ªç£å¤´åŒä¸€æ—¶åˆ»ä¹Ÿå¿…é¡»æ˜¯åŒè½´çš„ï¼Œå³ä»æ­£ä¸Šæ–¹å‘ä¸‹çœ‹ï¼Œæ‰€æœ‰ç£å¤´ä»»ä½•æ—¶å€™éƒ½æ˜¯é‡å çš„ï¼ˆä¸è¿‡ç›®å‰å·²ç»æœ‰å¤šç£å¤´ç‹¬ç«‹æŠ€æœ¯ï¼Œå¯ä¸å—æ­¤é™åˆ¶ï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯ç£ç›˜ç»“æ„çš„ç¤ºæ„å›¾ï¼š</p><p><img src="http://blog.codinglabs.org/uploads/pictures/theory-of-mysql-index/7.png" alt="" title="ç£ç›˜ç»“æ„"></p><p>ç›˜ç‰‡è¢«åˆ’åˆ†æˆä¸€ç³»åˆ—åŒå¿ƒç¯ï¼Œåœ†å¿ƒæ˜¯ç›˜ç‰‡ä¸­å¿ƒï¼Œæ¯ä¸ªåŒå¿ƒç¯å«åšä¸€ä¸ªç£é“ï¼Œæ‰€æœ‰åŠå¾„ç›¸åŒçš„ç£é“ç»„æˆä¸€ä¸ªæŸ±é¢ã€‚ç£é“è¢«æ²¿åŠå¾„çº¿åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°çš„æ®µï¼Œæ¯ä¸ªæ®µå«åšä¸€ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºæ˜¯ç£ç›˜çš„æœ€å°å­˜å‚¨å•å…ƒã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¸‹é¢å‡è®¾ç£ç›˜åªæœ‰ä¸€ä¸ªç›˜ç‰‡å’Œä¸€ä¸ªç£å¤´ã€‚</p><p>å½“éœ€è¦ä»ç£ç›˜è¯»å–æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šå°†æ•°æ®é€»è¾‘åœ°å€ä¼ ç»™ç£ç›˜ï¼Œç£ç›˜çš„æ§åˆ¶ç”µè·¯æŒ‰ç…§å¯»å€é€»è¾‘å°†é€»è¾‘åœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œå³ç¡®å®šè¦è¯»çš„æ•°æ®åœ¨å“ªä¸ªç£é“ï¼Œå“ªä¸ªæ‰‡åŒºã€‚ä¸ºäº†è¯»å–è¿™ä¸ªæ‰‡åŒºçš„æ•°æ®ï¼Œéœ€è¦å°†ç£å¤´æ”¾åˆ°è¿™ä¸ªæ‰‡åŒºä¸Šæ–¹ï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç£å¤´éœ€è¦ç§»åŠ¨å¯¹å‡†ç›¸åº”ç£é“ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå¯»é“ï¼Œæ‰€è€—è´¹æ—¶é—´å«åšå¯»é“æ—¶é—´ï¼Œç„¶åç£ç›˜æ—‹è½¬å°†ç›®æ ‡æ‰‡åŒºæ—‹è½¬åˆ°ç£å¤´ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—è´¹çš„æ—¶é—´å«åšæ—‹è½¬æ—¶é—´ã€‚</p><h2 id="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"><a href="#å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»" class="headerlink" title="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"></a>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»</h2><p>ç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚</p><p>è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŸç†ï¼š</p><blockquote><p>å½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚</p></blockquote><p>ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚</p><p>ç”±äºç£ç›˜é¡ºåºè¯»å–çš„æ•ˆç‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆç‡ã€‚</p><p>é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åè¿ç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åå¼‚å¸¸è¿”å›ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚</p><h1 id="B-Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ"><a href="#B-Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ" class="headerlink" title="B-/+Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ"></a>B-/+Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ</h1><p>ä¸€èˆ¬ä½¿ç”¨ç£ç›˜I/Oæ¬¡æ•°è¯„ä»·ç´¢å¼•ç»“æ„çš„ä¼˜åŠ£ã€‚å…ˆä»B-Treeåˆ†æï¼Œæ ¹æ®B-Treeçš„å®šä¹‰ï¼Œå¯çŸ¥æ£€ç´¢ä¸€æ¬¡æœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ã€‚æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…å·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼š</p><p>æ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I/Oã€‚</p><p>B-Treeä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1æ¬¡I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸º$O(h)=O(\log_d N)$ã€‚ä¸€èˆ¬å®é™…åº”ç”¨ä¸­ï¼Œå‡ºåº¦dæ˜¯éå¸¸å¤§çš„æ•°å­—ï¼Œé€šå¸¸è¶…è¿‡100ï¼Œå› æ­¤héå¸¸å°ï¼ˆé€šå¸¸ä¸è¶…è¿‡3ï¼‰ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚</p><p><strong>è€Œçº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œhæ˜æ˜¾è¦æ·±çš„å¤šã€‚ç”±äºé€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹ï¼ˆçˆ¶å­ï¼‰ç‰©ç†ä¸Šå¯èƒ½å¾ˆè¿œï¼Œæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„I/Oæ¸è¿›å¤æ‚åº¦ä¹Ÿä¸ºO(h)ï¼Œæ•ˆç‡æ˜æ˜¾æ¯”B-Treeå·®å¾ˆå¤šã€‚</strong></p><p>ä¸Šæ–‡è¿˜è¯´è¿‡ï¼ŒB+Treeæ›´é€‚åˆå¤–å­˜ç´¢å¼•ï¼ŒåŸå› å’Œå†…èŠ‚ç‚¹å‡ºåº¦dæœ‰å…³ã€‚ä»ä¸Šé¢åˆ†æå¯ä»¥çœ‹åˆ°ï¼Œdè¶Šå¤§ç´¢å¼•çš„æ€§èƒ½è¶Šå¥½ï¼Œè€Œå‡ºåº¦çš„ä¸Šé™å–å†³äºèŠ‚ç‚¹å†…keyå’Œdataçš„å¤§å°ï¼š</p><p>$$<br>d_{max}=floor({pagesize \over keysize+datasize+pointsize})<br>$$</p><p>floorè¡¨ç¤ºå‘ä¸‹å–æ•´ã€‚</p><p><strong>ç”±äºB+Treeå†…èŠ‚ç‚¹å»æ‰äº†dataåŸŸï¼Œå› æ­¤å¯ä»¥æ‹¥æœ‰æ›´å¤§çš„å‡ºåº¦ï¼Œå®¹çº³æ›´å¤šçš„èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ç£ç›˜IOæ¬¡æ•°</strong>ã€‚</p><p>ä¸€èˆ¬åœ¨æ•°æ®åº“ç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„B+Treeç»“æ„éƒ½åœ¨ç»å…¸B+Treeçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†é¡ºåºè®¿é—®æŒ‡é’ˆã€‚</p><p><img src="https://images.morethink.cn/B+Tree.jpg" alt="" title="B+Tree"></p><p>å¦‚ä¸Šå›¾å›¾æ‰€ç¤ºï¼Œåœ¨B+Treeçš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Treeã€‚åšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œä¾‹å¦‚å›¾4ä¸­å¦‚æœè¦æŸ¥è¯¢keyä¸ºä»18åˆ°49çš„æ‰€æœ‰æ•°æ®è®°å½•ï¼Œå½“æ‰¾åˆ°18åï¼Œ<strong>åªéœ€é¡ºç€èŠ‚ç‚¹å’ŒæŒ‡é’ˆé¡ºåºéå†å°±å¯ä»¥ä¸€æ¬¡æ€§è®¿é—®åˆ°æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæå¤§æåˆ°äº†åŒºé—´æŸ¥è¯¢æ•ˆç‡</strong>ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼š<br>B+Treeåšç´¢å¼•çš„ä¼˜åŠ¿æ˜¯ï¼š</p><ol><li>å†…éƒ¨èŠ‚ç‚¹å–æ¶ˆdataåŸŸï¼Œæ¯ä¸€é¡µå¯ä»¥å®¹çº³æ›´å¤šçš„æ•°æ®ï¼Œæœ‰æ•ˆå‡å°‘ç£ç›˜IOæ¬¡æ•°ã€‚</li><li>æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾å¿…é¡»èµ°ä¸€æ¡ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯ã€‚æ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œå¯¼è‡´æ¯ä¸€ä¸ªæ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚æ‰€ä»¥B+æ ‘æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºlog nï¼Œè€ŒBæ ‘æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸å›ºå®šï¼Œä¸æ‰€æŸ¥ç»“ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®æœ‰å…³ï¼Œæœ€å¥½ä¸ºO(1)ã€‚</li><li>é€šè¿‡å¢åŠ é¡ºåºè®¿é—®æŒ‡é’ˆæé«˜åŒºé—´æŸ¥è¯¢æ•ˆç‡ã€‚</li></ol><p>è€ŒMongoDBç´¢å¼•é€‰æ‹©Bæ ‘å¯èƒ½æ˜¯å› ä¸ºï¼š<br>MongoDB æ˜¯æ–‡æ¡£å‹çš„æ•°æ®åº“ï¼Œæ˜¯ä¸€ç§nosqlï¼Œå®ƒä½¿ç”¨BSONæ ¼å¼ä¿å­˜æ•°æ®ï¼Œå½’å±äºèšåˆå‹æ•°æ®åº“ã€‚è¢«è®¾è®¡ç”¨åœ¨æ•°æ®æ¨¡å‹ç®€å•ï¼Œæ€§èƒ½è¦æ±‚é«˜çš„åœºåˆã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨Bæ ‘ï¼Œæ˜¯å› ä¸ºBæ ‘keyå’ŒdataåŸŸèšåˆåœ¨ä¸€èµ·ã€‚å› æ­¤å¹¶ä¸éœ€è¦ç±»ä¼¼äºåŒºé—´æŸ¥è¯¢çš„æ“ä½œã€‚</p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener">MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</a></li><li><a href="https://www.cnblogs.com/gaochundong/p/btree_and_bplustree.html#bplustree_implementation" target="_blank" rel="noopener">äººäººéƒ½æ˜¯ DBAï¼ˆVIIï¼‰B æ ‘å’Œ B+ æ ‘</a></li><li><a href="https://zhuanlan.zhihu.com/p/27700617" target="_blank" rel="noopener">å¹³è¡¡äºŒå‰æ ‘ã€B-Treeã€B+Treeã€B*æ ‘ ç†è§£å…¶ä¸­ä¸€ç§ä½ å°±éƒ½æ˜ç™½äº†</a></li><li><a href="https://zh.wikipedia.org/wiki/B%E6%A0%91" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/B%E6%A0%91</a></li><li>B-Tree gifï¼š<a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noopener">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></li><li><a href="https://www.jianshu.com/p/ed76dbc0536d" target="_blank" rel="noopener">6. æ•°æ®ç»“æ„ - B æ ‘</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç´¢å¼•æ˜¯æ•°æ®åº“å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªåå°å¼€å‘äººå‘˜éƒ½åº”è¯¥å¯¹ç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„æœ‰æ‰€äº†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡é€šè¿‡åˆ†æB-TreeåŠB-/+Treeæ•°æ®ç»“æ„åŠç´¢å¼•æ€§èƒ½åˆ†æåŠç£ç›˜å­˜å–åŸç†å°è¯•ç€å›ç­”ä¸€ä¸‹é—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆB-Treeé€‚åˆæ•°æ®åº“ç´¢å¼•åŠçº¢é»‘æ ‘çš„äºŒå‰å¹³è¡¡æ ‘ä¸é€‚åˆä½œä¸ºç´¢å¼•&lt;/li&gt;
&lt;li&gt;B+Treeæ¯”BTreeåšç´¢å¼•çš„ä¼˜åŠ¿&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆMongoDBé‡‡ç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„è€ŒMySQLé‡‡ç”¨B+Treeä½œä¸ºç´¢å¼•å­˜å‚¨ç»“æ„&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://www.morethink.cn/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æ ‘" scheme="https://www.morethink.cn/tags/%E6%A0%91/"/>
    
      <category term="ç´¢å¼•" scheme="https://www.morethink.cn/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>MACå®‰è£…RabbitMQ</title>
    <link href="https://www.morethink.cn/MAC%E5%AE%89%E8%A3%85RabbitMQ/"/>
    <id>https://www.morethink.cn/MACå®‰è£…RabbitMQ/</id>
    <published>2018-05-11T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:34.553Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew install rabbitmq</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><ol><li>æ·»åŠ ç¯å¢ƒå˜é‡<ul><li>æ‰“å¼€é…ç½®æ–‡ä»¶<code>$ vi ~/.bash_profile</code></li><li>æ·»åŠ  <code>export PATH=$PATH:/usr/local/sbin</code><br>åˆ°æœ«å°¾ï¼Œç¼–è¾‘å®Œå:wqä¿å­˜é€€å‡ºã€‚</li><li>ä½¿ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ <code>$ source ~/.bash_profile</code></li></ul></li><li>å¯åŠ¨RabbitMQæœåŠ¡<br>ä¸Šé¢é…ç½®å®Œæˆåï¼Œéœ€è¦å…³é—­ç»ˆç«¯çª—å£ï¼Œé‡æ–°æ‰“å¼€ï¼Œç„¶åè¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯å¯åŠ¨RabbitMQæœåŠ¡ï¼š<code>rabbitmq-server</code></li><li>ç™»å½•Webç®¡ç†ç•Œé¢<br>æµè§ˆå™¨è¾“å…¥localhostï¼š15672ï¼Œè´¦å·å¯†ç å…¨è¾“å…¥guestå³å¯ç™»å½•ã€‚</li></ol><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼Œä»3.3.1ç‰ˆæœ¬å¼€å§‹ï¼ŒRabbitMQé»˜è®¤ä¸å…è®¸è¿œç¨‹ipç™»å½•ï¼Œå³åªèƒ½ä½¿ç”¨localhostç™»å½•ã€‚å¦‚æœå¸Œæœ›è¿œç¨‹ç™»å½•ï¼Œéœ€è¦æ·»åŠ ç”¨æˆ·æƒé™ã€‚</p><h1 id="è®¾ç½®RabbitMQè¿œç¨‹ipç™»å½•"><a href="#è®¾ç½®RabbitMQè¿œç¨‹ipç™»å½•" class="headerlink" title="è®¾ç½®RabbitMQè¿œç¨‹ipç™»å½•"></a>è®¾ç½®RabbitMQè¿œç¨‹ipç™»å½•</h1><p>ç”±äºè´¦å·guestå…·æœ‰æ‰€æœ‰çš„æ“ä½œæƒé™ï¼Œå¹¶ä¸”åˆæ˜¯é»˜è®¤è´¦å·ï¼Œå‡ºäºå®‰å…¨å› ç´ çš„è€ƒè™‘ï¼Œguestç”¨æˆ·åªèƒ½é€šè¿‡localhostç™»é™†ä½¿ç”¨ï¼Œå¹¶å»ºè®®ä¿®æ”¹guestç”¨æˆ·çš„å¯†ç ä»¥åŠæ–°å»ºå…¶ä»–è´¦å·ç®¡ç†ä½¿ç”¨rabbitmqã€‚<br>è¿™é‡Œæˆ‘ä»¬ä»¥åˆ›å»ºä¸ªtestå¸å·ï¼Œå¯†ç 123456ä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªè´¦å·å¹¶æ”¯æŒè¿œç¨‹ipè®¿é—®ã€‚</p><ul><li><p>åˆ›å»ºè´¦å·</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl add_user test 123456</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç”¨æˆ·è§’è‰²</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  set_user_tags  test  administrator</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç”¨æˆ·æƒé™</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl set_permissions -p &quot;/&quot; test &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®å®Œæˆåå¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·å’Œè§’è‰²(éœ€è¦å¼€å¯æœåŠ¡)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl list_users</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ˜¯ä½ å°±å¯ä»¥é€šè¿‡å…¶ä»–ä¸»æœºçš„è®¿é—®RabbitMQçš„Webç®¡ç†ç•Œé¢äº†ï¼Œè®¿é—®æ–¹å¼ï¼Œæµè§ˆå™¨è¾“å…¥ï¼šserverip:15672ã€‚å…¶ä¸­serveripæ˜¯RabbitMQ-Serveræ‰€åœ¨ä¸»æœºçš„ipã€‚</p><h1 id="RabbitMQå¸¸ç”¨æ“ä½œ"><a href="#RabbitMQå¸¸ç”¨æ“ä½œ" class="headerlink" title="RabbitMQå¸¸ç”¨æ“ä½œ"></a>RabbitMQå¸¸ç”¨æ“ä½œ</h1><ol><li><p>ç”¨æˆ·ç®¡ç†<br>ç”¨æˆ·ç®¡ç†åŒ…æ‹¬å¢åŠ ç”¨æˆ·ï¼Œåˆ é™¤ç”¨æˆ·ï¼ŒæŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œä¿®æ”¹ç”¨æˆ·å¯†ç ã€‚</p><ul><li><p>æ–°å¢ä¸€ä¸ªç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  add_user  Username  Password</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  delete_user  Username</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç”¨æˆ·çš„å¯†ç </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  change_password  Username  Newpassword</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å‰ç”¨æˆ·åˆ—è¡¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rabbitmqctl  list_users</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h1&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;brew update&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;brew install rabbitmq&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="MQ" scheme="https://www.morethink.cn/tags/MQ/"/>
    
      <category term="MAC" scheme="https://www.morethink.cn/tags/MAC/"/>
    
  </entry>
  
  <entry>
    <title>ç§‘å­¦ä¸Šç½‘ä¹‹åœ¨VPSä¸Šå®‰è£…SSR</title>
    <link href="https://www.morethink.cn/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E4%B9%8B%E5%9C%A8VPS%E4%B8%8A%E5%AE%89%E8%A3%85SSR/"/>
    <id>https://www.morethink.cn/ç§‘å­¦ä¸Šç½‘ä¹‹åœ¨VPSä¸Šå®‰è£…SSR/</id>
    <published>2018-05-11T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:30.777Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å¯¹VPSå®‰è£…SSRçš„è¿‡ç¨‹è¿›è¡Œæ€»ç»“ï¼Œå…å¾—å› ä¸ºXXé‡æ–°å®‰è£…SSRæ—¶æ‰¾ä¸åˆ°å®‰è£…æ–¹æ³•ã€‚</p><h1 id="å®‰è£…SSR"><a href="#å®‰è£…SSR" class="headerlink" title="å®‰è£…SSR"></a>å®‰è£…SSR</h1><p>ç®€å•çš„æ¥è¯´ï¼Œå¦‚æœä½ ä»€ä¹ˆéƒ½ä¸æ‡‚ï¼Œé‚£ä¹ˆä½ ç›´æ¥ä¸€è·¯å›è½¦å°±å¯ä»¥äº†ï¼<br><a id="more"></a><br>æœ¬è„šæœ¬éœ€è¦Linux rootè´¦æˆ·æƒé™æ‰èƒ½æ­£å¸¸å®‰è£…è¿è¡Œï¼Œæ‰€ä»¥ <strong>å¦‚æœä¸æ˜¯ rootè´¦å·ï¼Œè¯·å…ˆåˆ‡æ¢ä¸ºrootï¼Œå¦‚æœæ˜¯ rootè´¦å·ï¼Œé‚£ä¹ˆè¯·è·³è¿‡</strong>ï¼</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo su</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸Šé¢ä»£ç å›è½¦åä¼šæç¤ºä½ è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç ï¼Œè¾“å…¥å¹¶å›è½¦åï¼Œæ²¡æœ‰æŠ¥é”™å°±ç»§ç»­ä¸‹é¢çš„æ­¥éª¤å®‰è£…ShadowsocksRã€‚</p><p>v2.0.0 ç‰ˆæœ¬ä»¥åçš„è„šæœ¬ï¼Œè¯·å…ˆå¸è½½æ—§è„šæœ¬ShadowsocksRæœåŠ¡ç«¯ï¼Œå†é‡æ–°å®‰è£…ï¼</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -N --no-check-certificate https://softs.fun/Bash/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh</span><br></pre></td></tr></table></figure><p>å¤‡ç”¨ä¸‹è½½åœ°å€ï¼ˆä¸Šé¢çš„é“¾æ¥æ— æ³•ä¸‹è½½ï¼Œå°±ç”¨è¿™ä¸ªï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½è¿è¡Œåä¼šæç¤ºä½ è¾“å…¥æ•°å­—æ¥é€‰æ‹©è¦åšä»€ä¹ˆã€‚</p><p>è¿è¡Œè„šæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash ssr.sh</span><br></pre></td></tr></table></figure><p>è¾“å…¥å¯¹åº”çš„æ•°å­—æ¥æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—æ¥é€‰æ‹©èœå•é€‰é¡¹</span><br><span class="line"></span><br><span class="line"> 1. å®‰è£… ShadowsocksR</span><br><span class="line"> 2. æ›´æ–° ShadowsocksR</span><br><span class="line"> 3. å¸è½½ ShadowsocksR</span><br><span class="line"> 4. å®‰è£… libsodium(chacha20)</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"> 5. æŸ¥çœ‹ è´¦å·ä¿¡æ¯</span><br><span class="line"> 6. æ˜¾ç¤º è¿æ¥ä¿¡æ¯</span><br><span class="line"> 7. è®¾ç½® ç”¨æˆ·é…ç½®</span><br><span class="line"> 8. æ‰‹åŠ¨ ä¿®æ”¹é…ç½®</span><br><span class="line"> 9. åˆ‡æ¢ ç«¯å£æ¨¡å¼</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"> 10. å¯åŠ¨ ShadowsocksR</span><br><span class="line"> 11. åœæ­¢ ShadowsocksR</span><br><span class="line"> 12. é‡å¯ ShadowsocksR</span><br><span class="line"> 13. æŸ¥çœ‹ ShadowsocksR æ—¥å¿—</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"> 14. å…¶ä»–åŠŸèƒ½</span><br><span class="line"> 15. å‡çº§è„šæœ¬</span><br><span class="line"></span><br><span class="line"> å½“å‰çŠ¶æ€: å·²å®‰è£… å¹¶ å·²å¯åŠ¨</span><br><span class="line"> å½“å‰æ¨¡å¼: å•ç«¯å£</span><br><span class="line"></span><br><span class="line">è¯·è¾“å…¥æ•°å­—(1-15)ï¼š</span><br></pre></td></tr></table></figure></p><h1 id="æ–‡ä»¶ä½ç½®"><a href="#æ–‡ä»¶ä½ç½®" class="headerlink" title="æ–‡ä»¶ä½ç½®"></a>æ–‡ä»¶ä½ç½®</h1><ul><li>å®‰è£…ç›®å½•ï¼š<code>/usr/local/shadowsocksr</code></li><li>é…ç½®æ–‡ä»¶ï¼š<code>/etc/shadowsocksr/user-config.json</code></li></ul><h1 id="è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡"><a href="#è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡" class="headerlink" title="è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡"></a>è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡</h1><p>ShadowsocksR å®‰è£…åï¼Œè‡ªåŠ¨è®¾ç½®ä¸º ç³»ç»ŸæœåŠ¡ï¼Œæ‰€ä»¥æ”¯æŒä½¿ç”¨æœåŠ¡æ¥å¯åŠ¨/åœæ­¢ç­‰æ“ä½œï¼ŒåŒæ—¶æ”¯æŒå¼€æœºå¯åŠ¨ã€‚</p><ul><li>å¯åŠ¨ ShadowsocksRï¼š<code>/etc/init.d/ssr start</code></li><li>åœæ­¢ ShadowsocksRï¼š<code>/etc/init.d/ssr stop</code></li><li>é‡å¯ ShadowsocksRï¼š<code>/etc/init.d/ssr restart</code></li><li>æŸ¥çœ‹ ShadowsocksRçŠ¶æ€ï¼š<code>/etc/init.d/ssr status</code></li></ul><p>ShadowsocksR é»˜è®¤æ”¯æŒUDPè½¬å‘ï¼ŒæœåŠ¡ç«¯æ— éœ€ä»»ä½•è®¾ç½®ã€‚</p><h1 id="å®šæ—¶é‡å¯"><a href="#å®šæ—¶é‡å¯" class="headerlink" title="å®šæ—¶é‡å¯"></a>å®šæ—¶é‡å¯</h1><p>ä¸€äº›äººå¯èƒ½éœ€è¦å®šæ—¶é‡å¯ShadowsocksRæœåŠ¡ç«¯æ¥ä¿è¯ç¨³å®šæ€§ç­‰ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ crontab å®šæ—¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è¾“å…¥è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰é…ç½®çš„å®šæ—¶ä»»åŠ¡</span><br><span class="line">crontab -l</span><br><span class="line"># å¦‚æœæç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œä¸‹é¢æ˜¯å®‰è£…å‘½ä»¤</span><br><span class="line"># CentOSç³»ç»Ÿï¼š</span><br><span class="line">yum update</span><br><span class="line">yum install -y crond</span><br><span class="line"># Debian/Ubuntuç³»ç»Ÿï¼š</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y cron</span><br></pre></td></tr></table></figure><p>å®‰è£… crontab åï¼Œæˆ‘ä»¬å°±èƒ½å¼€å§‹æ·»åŠ å®šæ—¶ä»»åŠ¡äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crontab -l &gt; &quot;crontab.bak&quot;</span><br><span class="line">sed -i &quot;/ssr restart/d&quot; &quot;crontab.bak&quot;</span><br><span class="line">echo -e &quot;\n10 3 * * * /etc/init.d/ssr restart&quot; &gt;&gt; &quot;crontab.bak&quot;</span><br><span class="line">crontab &quot;crontab.bak&quot;</span><br><span class="line">rm -r &quot;crontab.bak&quot;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å®šæ—¶ä»»åŠ¡è§„åˆ™(ä»£ç å‰é¢çš„ <em> </em> <em> </em> * åˆ†åˆ«å¯¹åº”ï¼šåˆ†é’Ÿ å°æ—¶ æ—¥ æœˆ æ˜ŸæœŸ)å‚è€ƒï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10 2 * * * /etc/init.d/ssr restart</span><br><span class="line"># è¿™ä¸ªä»£è¡¨ æ¯å¤©2ç‚¹10åˆ†é‡å¯ä¸€æ¬¡ ShadowsocksR</span><br><span class="line"></span><br><span class="line">10 2 */2 * * /etc/init.d/ssr restart</span><br><span class="line"># è¿™ä¸ªä»£è¡¨ æ¯éš”2å¤©çš„2ç‚¹10åˆ†é‡å¯ä¸€æ¬¡ ShadowsocksR</span><br><span class="line"></span><br><span class="line">10 */4 * * * /etc/init.d/ssr restart</span><br><span class="line"># è¿™ä¸ªä»£è¡¨ æ¯éš”4å°æ—¶çš„ç¬¬10åˆ†é‡å¯ä¸€æ¬¡ ShadowsocksR</span><br></pre></td></tr></table></figure><h1 id="BBRå’Œé”é€Ÿ"><a href="#BBRå’Œé”é€Ÿ" class="headerlink" title="BBRå’Œé”é€Ÿ"></a>BBRå’Œé”é€Ÿ</h1><p>BBRå’Œé”é€Ÿéƒ½æ˜¯ç”¨æ¥æé«˜ç¿»å¢™é€Ÿåº¦çš„ã€‚</p><p>BBRæ˜¯æ¥è‡ªäºGoogleçš„é»‘ç§‘æŠ€ï¼Œç›®çš„æ˜¯é€šè¿‡ä¼˜åŒ–å’Œæ§åˆ¶TCPçš„æ‹¥å¡ï¼Œå……åˆ†åˆ©ç”¨å¸¦å®½å¹¶é™ä½å»¶è¿Ÿï¼Œå…¶ç›®çš„å°±æ˜¯è¦å°½é‡è·‘æ»¡å¸¦å®½ï¼Œå¹¶ä¸”å°½é‡ä¸è¦æœ‰æ’é˜Ÿçš„æƒ…å†µã€‚<br>BBR è¿™ä¸ªç‰¹æ€§å…¶å®æ˜¯åœ¨ Linux å†…æ ¸ 4.9 æ‰è®¡åˆ’åŠ å…¥çš„ã€‚æ‰€ä»¥ï¼Œè¦å¼€å¯BBRï¼Œéœ€è¦å†…æ ¸ç‰ˆæœ¬åœ¨Linux kernel 4.9ä»¥ä¸Šï¼Œè„šæœ¬ä¼šå¸®åŠ©æˆ‘ä»¬å®‰è£…ã€‚</p><p>åœ¨BBRä¹‹å‰ï¼Œæ¯”è¾ƒæœ‰åçš„å°±æ˜¯å›½äº§çš„é”é€Ÿäº†ï¼Œä¸è¿‡ï¼Œç”±äºé”é€Ÿæ˜¯ä¸ªå›½äº§çš„é—­æºè½¯ä»¶ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨æ€§é—®é¢˜ï¼Œå› æ­¤ <strong>æ¨èä½¿ç”¨å®‰è£…BBR</strong>ã€‚</p><ul><li><p>å¯åŠ¨è„šæœ¬ï¼š</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash ssr.sh</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©<code>14. å…¶ä»–åŠŸèƒ½</code></p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  1. é…ç½® BBR</span><br><span class="line">  2. é…ç½® é”é€Ÿ(ServerSpeeder)</span><br><span class="line">  3. é…ç½® LotServer(é”é€Ÿæ¯å…¬å¸)</span><br><span class="line">  æ³¨æ„ï¼š é”é€Ÿ/LotServer/BBR ä¸æ”¯æŒ OpenVZï¼</span><br><span class="line">  æ³¨æ„ï¼š é”é€Ÿ/LotServer/BBR ä¸èƒ½å…±å­˜ï¼</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">  4. ä¸€é”®å°ç¦ BT/PT/SPAM (iptables)</span><br><span class="line">  5. ä¸€é”®è§£å° BT/PT/SPAM (iptables)</span><br><span class="line">  6. åˆ‡æ¢ ShadowsocksRæ—¥å¿—è¾“å‡ºæ¨¡å¼</span><br><span class="line">  â€”â€”è¯´æ˜ï¼šSSRé»˜è®¤åªè¾“å‡ºé”™è¯¯æ—¥å¿—ï¼Œæ­¤é¡¹å¯åˆ‡æ¢ä¸ºè¾“å‡ºè¯¦ç»†çš„è®¿é—®æ—¥å¿—</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…BBRæˆ–è€…é”é€Ÿ(æ¨èBBR)</p></li></ul><h1 id="TCPä¼˜åŒ–"><a href="#TCPä¼˜åŒ–" class="headerlink" title="TCPä¼˜åŒ–"></a>TCPä¼˜åŒ–</h1><ul><li><p>å¢åŠ TCPè¿æ¥æ•°é‡</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ä¸¤è¡Œï¼š</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* soft nofile 51200</span><br><span class="line">* hard nofile 51200</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ulimitï¼š</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ulimit -n 51200</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ä¸€äº›ä¼˜åŒ–å†…å®¹</p><ul><li><p>ä¿®æ”¹sysctl.conf</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi  /etc/sysctl.conf</span><br></pre></td></tr></table></figure></li><li><p>æ’å…¥ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#TCPé…ç½®ä¼˜åŒ–(ä¸ç„¶ä½ è‡ªå·±æ ¹æœ¬ä¸çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ)</span><br><span class="line">fs.file-max = 51200</span><br><span class="line">#æé«˜æ•´ä¸ªç³»ç»Ÿçš„æ–‡ä»¶é™åˆ¶</span><br><span class="line">net.core.rmem_max = 67108864</span><br><span class="line">net.core.wmem_max = 67108864</span><br><span class="line">net.core.netdev_max_backlog = 250000</span><br><span class="line">net.core.somaxconn = 4096</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line">net.ipv4.ip_local_port_range = 10000 65000</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 5000</span><br><span class="line">net.ipv4.tcp_fastopen = 3</span><br><span class="line">net.ipv4.tcp_mem = 25600 51200 102400</span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 67108864</span><br><span class="line">net.ipv4.tcp_wmem = 4096 65536 67108864</span><br><span class="line">net.ipv4.tcp_mtu_probing = 1</span><br><span class="line">net.ipv4.tcp_congestion_control = bbr</span><br><span class="line">#END OF LINE</span><br></pre></td></tr></table></figure></li><li><p>åº”ç”¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯SSR</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/etc/init.d/ssr restart</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://jasper-1024.github.io/2016/06/26/VPS%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B%E7%B3%BB%E5%88%97/" target="_blank" rel="noopener">ç§‘å­¦ä¸Šç½‘æ•™ç¨‹ï¼ˆä¸€ï¼‰â€”â€”VPSä¸Šæ­å»ºSSR</a></li><li><a href="https://doub.io/ss-jc42" target="_blank" rel="noopener">ã€åŸåˆ›ã€CentOS/Debian/Ubuntu ShadowsocksR å•/å¤šç«¯å£ ä¸€é”®ç®¡ç†è„šæœ¬</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡å¯¹VPSå®‰è£…SSRçš„è¿‡ç¨‹è¿›è¡Œæ€»ç»“ï¼Œå…å¾—å› ä¸ºXXé‡æ–°å®‰è£…SSRæ—¶æ‰¾ä¸åˆ°å®‰è£…æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å®‰è£…SSR&quot;&gt;&lt;a href=&quot;#å®‰è£…SSR&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…SSR&quot;&gt;&lt;/a&gt;å®‰è£…SSR&lt;/h1&gt;&lt;p&gt;ç®€å•çš„æ¥è¯´ï¼Œå¦‚æœä½ ä»€ä¹ˆéƒ½ä¸æ‡‚ï¼Œé‚£ä¹ˆä½ ç›´æ¥ä¸€è·¯å›è½¦å°±å¯ä»¥äº†ï¼&lt;br&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
  </entry>
  
  <entry>
    <title>ç»™ä½ çš„åšå®¢å›­å›¾ç‰‡æ·»åŠ æ ‡é¢˜</title>
    <link href="https://www.morethink.cn/%E7%BB%99%E4%BD%A0%E7%9A%84%E5%8D%9A%E5%AE%A2%E5%9B%AD%E5%9B%BE%E7%89%87%E6%B7%BB%E5%8A%A0%E6%A0%87%E9%A2%98/"/>
    <id>https://www.morethink.cn/ç»™ä½ çš„åšå®¢å›­å›¾ç‰‡æ·»åŠ æ ‡é¢˜/</id>
    <published>2018-05-05T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:25.381Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ç›´ä»¥æ¥éƒ½è§‰å¾—åœ¨å›¾ç‰‡ä¸‹é¢æ·»åŠ ä¸€ä¸ªæ ‡é¢˜å¯ä»¥æ›´åŠ æ¸…æ™°çš„è¡¨ç¤ºè¿™å¼ å›¾ç‰‡çš„å«ä¹‰ï¼Œå¯æ˜¯åšå®¢å›­åŸç”Ÿå¹¶ä¸æ”¯æŒè¿™ç§æ¸²æŸ“æ–¹å¼ï¼Œå†åŠ ä¸Šåšå®¢å›­å¯ä»¥è‡ªå·±å†™jsæ¥æ›´æ”¹ä¸»é¢˜ï¼Œäºæ˜¯é€šè¿‡æœç´¢èµ„æ–™å®Œæˆç»™åšå®¢å›­å›¾ç‰‡æ·»åŠ æ ‡é¢˜çš„åŠŸèƒ½ã€‚</p><a id="more"></a><p>å½“æˆ‘ä»¬å¦‚ä¸‹ä¹¦å†™markdownæ—¶ï¼š<br><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![](https://images.morethink.cn/092017231747399.jpg "TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹")</span><br></pre></td></tr></table></figure></p><p>ä¼šè¢«åšå®¢å›­æ¸²æŸ“æˆ<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://images.morethink.cn/092017231747399.jpg"</span> <span class="attr">title</span>=<span class="string">"TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>äºæ˜¯æˆ‘å°±æƒ³é€šè¿‡åœ¨imgæ ‡ç­¾åé¢åŠ¨æ€æ·»åŠ ä¸€ä¸ªå¸¦æœ‰<code>title</code>çš„pæ ‡ç­¾æ¥ç»™åšå®¢å›­å›¾ç‰‡æ·»åŠ æ ‡é¢˜ã€‚</p><p>å°†ä¸‹é¢ä»£ç æ”¾å…¥<code>é¡µé¦–Htmlä»£ç </code>ä»£ç ä¸­å³å¯(éœ€è¦ç”³è¯·jsæƒé™)ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥jQuery --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $(<span class="built_in">window</span>).load(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//ç»™æ¯å¼ å›¾ç‰‡æ·»åŠ æ ‡é¢˜,div.cnblogs_post_bodyæ˜¯åšå®¢ä¸»ä½“</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"div[id=cnblogs_post_body] img"</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> title = $(<span class="keyword">this</span>).attr(<span class="string">"title"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (title != <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> boardp_style = <span class="string">"style='display: block; text-align: center; color: #969696;padding: 10px;border-bottom: 1px solid #d9d9d9;margin: 0 auto;"</span> +</span></span><br><span class="line"><span class="javascript">                    <span class="string">"width: "</span> + ($(<span class="keyword">this</span>).width() * <span class="number">0.8</span>) + <span class="string">"px;"</span> +</span></span><br><span class="line"><span class="javascript">                    <span class="string">"height: 28px;"</span> +</span></span><br><span class="line"><span class="javascript">                    <span class="string">"'&gt;"</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> boardp = <span class="string">"&lt;p "</span> + boardp_style + title + <span class="string">"&lt;/p"</span>;</span></span><br><span class="line"><span class="javascript">                $(<span class="keyword">this</span>).after(boardp);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å°†imgå˜ä¸ºå—çº§å…ƒç´  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    img &#123;</span></span><br><span class="line"><span class="undefined">        margin: 0 auto;</span></span><br><span class="line"><span class="undefined">        display: block;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>markdownå›¾ç‰‡ï¼š<br><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![](https://images.morethink.cn/092017231747399.jpg "TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹")</span><br></pre></td></tr></table></figure></p><p><img src="https://images.morethink.cn/092017231747399.jpg" alt="" title="TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ç›´ä»¥æ¥éƒ½è§‰å¾—åœ¨å›¾ç‰‡ä¸‹é¢æ·»åŠ ä¸€ä¸ªæ ‡é¢˜å¯ä»¥æ›´åŠ æ¸…æ™°çš„è¡¨ç¤ºè¿™å¼ å›¾ç‰‡çš„å«ä¹‰ï¼Œå¯æ˜¯åšå®¢å›­åŸç”Ÿå¹¶ä¸æ”¯æŒè¿™ç§æ¸²æŸ“æ–¹å¼ï¼Œå†åŠ ä¸Šåšå®¢å›­å¯ä»¥è‡ªå·±å†™jsæ¥æ›´æ”¹ä¸»é¢˜ï¼Œäºæ˜¯é€šè¿‡æœç´¢èµ„æ–™å®Œæˆç»™åšå®¢å›­å›¾ç‰‡æ·»åŠ æ ‡é¢˜çš„åŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Webå‰ç«¯" scheme="https://www.morethink.cn/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Cronè¡¨è¾¾å¼</title>
    <link href="https://www.morethink.cn/Linux/Cron%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>https://www.morethink.cn/Linux/Cronè¡¨è¾¾å¼/</id>
    <published>2018-04-21T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:23.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Cronè¡¨è¾¾å¼èŒƒä¾‹ï¼š</strong></p><ul><li><code>*/5 * * * * ?</code>  ï¼šæ¯éš”5<code>ç§’</code>æ‰§è¡Œä¸€æ¬¡</li><li><code>0 */1 * * * ?</code>  ï¼šæ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</li><li><code>0 0 23 * * ?</code>   ï¼šæ¯å¤©23ç‚¹æ‰§è¡Œä¸€æ¬¡</li><li><code>0 0 1 * * ?</code>    ï¼šæ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼š</li><li><code>0 0 1 1 * ?</code>  ï¼šæ¯æœˆ1å·å‡Œæ™¨1ç‚¹æ‰§è¡Œä¸€æ¬¡</li><li><code>0 0 23 L * ?</code> ï¼š æ¯æœˆæœ€åä¸€å¤©23ç‚¹æ‰§è¡Œä¸€æ¬¡</li><li><code>0 0 1 ? * L</code>  ï¼šæ¯å‘¨æ˜ŸæœŸå¤©å‡Œæ™¨1ç‚¹å®è¡Œä¸€æ¬¡</li><li><code>0 26,29,33 * * * ?</code> ï¼š åœ¨26åˆ†ã€29åˆ†ã€33åˆ†æ‰§è¡Œä¸€æ¬¡</li><li><code>0 0 0,13,18,21 * * ?</code> ï¼š æ¯å¤©çš„0ç‚¹ã€13ç‚¹ã€18ç‚¹ã€21ç‚¹éƒ½æ‰§è¡Œä¸€æ¬¡<a id="more"></a><h1 id="Cronè¡¨è¾¾å¼"><a href="#Cronè¡¨è¾¾å¼" class="headerlink" title="Cronè¡¨è¾¾å¼"></a>Cronè¡¨è¾¾å¼</h1></li></ul><p>Cronè¡¨è¾¾å¼ç”±7ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå„éƒ¨åˆ†ç”¨ç©ºæ ¼éš”å¼€ï¼ŒCronè¡¨è¾¾å¼çš„7ä¸ªéƒ¨åˆ†ä»å·¦åˆ°å³ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><p><code>ç§’</code> <code>åˆ†</code> <code>æ—¶</code> <code>æ—¥</code> <code>æœˆ</code> <code>å‘¨</code> <code>å¹´</code><br>å…¶ä¸­ <code>å¹´</code>æ˜¯å¯é€‰çš„ã€‚</p><table><thead><tr><th>å­—æ®µå</th><th>å…è®¸çš„å€¼</th><th>å…è®¸çš„ç‰¹æ®Šå­—ç¬¦</th></tr></thead><tbody><tr><td><code>ç§’</code></td><td>0-59</td><td>,- * /</td><td></td></tr><tr><td><code>åˆ†</code></td><td>0-59</td><td>,- * /</td><td></td></tr><tr><td><code>æ—¶</code></td><td>0-23</td><td>,- * /</td><td></td></tr><tr><td><code>æ—¥</code></td><td>1-31</td><td>,- * ? / L W C</td><td></td></tr><tr><td><code>æœˆ</code></td><td>1-12 or JAN-DEC</td><td>,- * /</td><td></td></tr><tr><td><code>å‘¨</code></td><td>1-7 or SUN-SAT</td><td>,- * ? / L C #</td><td></td></tr><tr><td><code>å¹´</code> (å¯é€‰å­—æ®µ)</td><td>emptyï¼Œ1970-2099</td><td>,- * /</td></tr></tbody></table><h1 id="ç¬¦å·è¯´æ˜"><a href="#ç¬¦å·è¯´æ˜" class="headerlink" title="ç¬¦å·è¯´æ˜"></a>ç¬¦å·è¯´æ˜</h1><ul><li><code>,</code>ï¼šè¡¨ç¤ºåˆ—å‡ºæšä¸¾å€¼å€¼ã€‚ä¾‹å¦‚åœ¨<code>åˆ†</code>ä½¿ç”¨5,20ï¼Œåˆ™æ„å‘³ç€åœ¨5å’Œ20åˆ†æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚</li><li><code>-</code>ï¼šè¡¨ç¤ºèŒƒå›´ã€‚ä¾‹å¦‚åœ¨<code>åˆ†</code>ä½¿ç”¨5-20ï¼Œè¡¨ç¤ºä»5åˆ†åˆ°20åˆ†é’Ÿæ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚</li><li><code>*</code> ï¼šè¡¨ç¤ºåŒ¹é…è¯¥åŸŸçš„ä»»æ„å€¼ã€‚å‡å¦‚åœ¨<code>åˆ†</code>åŸŸä½¿ç”¨<code>*</code>ï¼Œå³è¡¨ç¤ºæ¯åˆ†é’Ÿéƒ½ä¼šè§¦å‘äº‹ä»¶ã€‚</li><li><code>/</code> ï¼šè¡¨ç¤ºèµ·å§‹æ—¶é—´å¼€å§‹è§¦å‘ï¼Œç„¶åæ¯éš”å›ºå®šæ—¶é—´è§¦å‘ä¸€æ¬¡ï¼Œä¾‹å¦‚åœ¨MinutesåŸŸä½¿ç”¨5/20,åˆ™æ„å‘³ç€5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œè€Œ25ï¼Œ45ç­‰åˆ†åˆ«è§¦å‘ä¸€æ¬¡ã€‚</li><li><code>?</code> ï¼šåªèƒ½ç”¨åœ¨<code>å‘¨</code>å’Œ<code>æ—¥</code>ã€‚å®ƒä¹ŸåŒ¹é…åŸŸçš„ä»»æ„å€¼ï¼Œä½†å®é™…ä¸ä¼šã€‚å› ä¸º<code>å‘¨</code>å’Œ<code>æ—¥</code>ä¼šç›¸äº’å½±å“ã€‚ä¾‹å¦‚æƒ³åœ¨æ¯æœˆçš„20æ—¥è§¦å‘è°ƒåº¦ï¼Œä¸ç®¡20æ—¥åˆ°åº•æ˜¯æ˜ŸæœŸå‡ ï¼Œåˆ™åªèƒ½ä½¿ç”¨å¦‚ä¸‹å†™æ³•ï¼š 13 13 15 20 <em> ?,å…¶ä¸­æœ€åä¸€ä½åªèƒ½ç”¨ï¼Ÿï¼Œè€Œä¸èƒ½ä½¿ç”¨</em>ï¼Œå¦‚æœä½¿ç”¨*è¡¨ç¤ºä¸ç®¡æ˜ŸæœŸå‡ éƒ½ä¼šè§¦å‘ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚    </li><li><code>L</code> ï¼š è¡¨ç¤ºæœ€åï¼Œåªèƒ½å‡ºç°åœ¨<code>æ—¥</code>å’Œ<code>å‘¨</code>ï¼Œå¦‚æœåœ¨<code>æ—¥</code>ä½¿ç”¨5L,æ„å‘³ç€åœ¨æœ€åçš„ä¸€ä¸ªæ˜ŸæœŸå››è§¦å‘ã€‚  </li><li><code>W</code>ï¼šè¡¨ç¤ºæœ‰æ•ˆå·¥ä½œæ—¥(å‘¨ä¸€åˆ°å‘¨äº”),åªèƒ½å‡ºç°åœ¨<code>å‘¨</code>åŸŸï¼Œç³»ç»Ÿå°†åœ¨ç¦»æŒ‡å®šæ—¥æœŸçš„æœ€è¿‘çš„æœ‰æ•ˆå·¥ä½œæ—¥è§¦å‘äº‹ä»¶ã€‚ä¾‹å¦‚ï¼šåœ¨<code>æ—¥</code>ä½¿ç”¨5Wï¼Œå¦‚æœ5æ—¥æ˜¯æ˜ŸæœŸå…­ï¼Œåˆ™å°†åœ¨æœ€è¿‘çš„å·¥ä½œæ—¥ï¼šæ˜ŸæœŸäº”ï¼Œå³4æ—¥è§¦å‘ã€‚å¦‚æœ5æ—¥æ˜¯æ˜ŸæœŸå¤©ï¼Œåˆ™åœ¨6æ—¥è§¦å‘ï¼›å¦‚æœ5æ—¥åœ¨æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸäº”ä¸­çš„ä¸€å¤©ï¼Œåˆ™å°±åœ¨5æ—¥è§¦å‘ã€‚å¦å¤–ä¸€ç‚¹ï¼ŒWçš„æœ€è¿‘å¯»æ‰¾ä¸ä¼šè·¨è¿‡æœˆä»½ã€‚</li><li><code>#</code>ï¼šç”¨äºç¡®å®šæ¯ä¸ªæœˆç¬¬å‡ ä¸ªæ˜ŸæœŸå‡ ï¼Œåªèƒ½å‡ºç°åœ¨<code>å‘¨</code>ã€‚ä¾‹å¦‚åœ¨4#2ï¼Œè¡¨ç¤ºæŸæœˆçš„ç¬¬äºŒä¸ªæ˜ŸæœŸä¸‰ã€‚</li></ul><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="http://Cron.qqe2.com/" target="_blank" rel="noopener">åœ¨çº¿Cronè¡¨è¾¾å¼ç”Ÿæˆå™¨</a></li><li><a href="https://www.jianshu.com/p/f03b1497122a" target="_blank" rel="noopener">QuartZ Cronè¡¨è¾¾å¼è¯¦è§£</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;Cronè¡¨è¾¾å¼èŒƒä¾‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;*/5 * * * * ?&lt;/code&gt;  ï¼šæ¯éš”5&lt;code&gt;ç§’&lt;/code&gt;æ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 */1 * * * ?&lt;/code&gt;  ï¼šæ¯éš”1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 23 * * ?&lt;/code&gt;   ï¼šæ¯å¤©23ç‚¹æ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 1 * * ?&lt;/code&gt;    ï¼šæ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œä¸€æ¬¡ï¼š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 1 1 * ?&lt;/code&gt;  ï¼šæ¯æœˆ1å·å‡Œæ™¨1ç‚¹æ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 23 L * ?&lt;/code&gt; ï¼š æ¯æœˆæœ€åä¸€å¤©23ç‚¹æ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 1 ? * L&lt;/code&gt;  ï¼šæ¯å‘¨æ˜ŸæœŸå¤©å‡Œæ™¨1ç‚¹å®è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 26,29,33 * * * ?&lt;/code&gt; ï¼š åœ¨26åˆ†ã€29åˆ†ã€33åˆ†æ‰§è¡Œä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;0 0 0,13,18,21 * * ?&lt;/code&gt; ï¼š æ¯å¤©çš„0ç‚¹ã€13ç‚¹ã€18ç‚¹ã€21ç‚¹éƒ½æ‰§è¡Œä¸€æ¬¡
    
    </summary>
    
      <category term="Linux" scheme="https://www.morethink.cn/categories/Linux/"/>
    
    
  </entry>
  
  <entry>
    <title>GitHubæ›´æ–°å·²ç»forkçš„é¡¹ç›®</title>
    <link href="https://www.morethink.cn/%E5%B7%A5%E5%85%B7/GitHub%E6%9B%B4%E6%96%B0%E5%B7%B2%E7%BB%8Ffork%E7%9A%84%E9%A1%B9%E7%9B%AE/"/>
    <id>https://www.morethink.cn/å·¥å…·/GitHubæ›´æ–°å·²ç»forkçš„é¡¹ç›®/</id>
    <published>2018-04-21T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:20.473Z</updated>
    
    <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬forkä¸€ä¸ªé¡¹ç›®åï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ä»£ç çš„æ—¶å€™å°±ä¼šä»¥æˆ‘ä»¬æœ¬åœ°ä¸ºå‡†ï¼Œä¸ä¼šè·Ÿéšæˆ‘ä»¬forkå‰çš„é¡¹ç›®ï¼Œå¦‚æœéœ€è¦åŒæ­¥å¯¹æ–¹çš„ä»£ç ï¼Œéœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚</p><a id="more"></a><ol><li>clone è‡ªå·±çš„ fork åˆ†æ”¯åˆ°æœ¬åœ°<br>å¯ä»¥ç›´æ¥ä½¿ç”¨ GitHub å®¢æˆ·ç«¯ï¼Œclone åˆ°æœ¬åœ°ï¼Œå¦‚æœä½¿ç”¨å‘½ä»¤è¡Œï¼Œå‘½ä»¤ä¸ºï¼š<br><code>$ git clone  git@github.com:morethink/git-recipes.git</code></li><li><p>è¿›å…¥ä»“åº“ï¼Œå¢åŠ æºåˆ†æ”¯åœ°å€åˆ°ä½ é¡¹ç›®è¿œç¨‹åˆ†æ”¯åˆ—è¡¨ä¸­<br>æ­¤å¤„æ˜¯å…³é”®ï¼Œå…ˆå¾—å°†åŸæ¥çš„ä»“åº“æŒ‡å®šä¸º upstreamï¼Œå‘½ä»¤ä¸ºï¼š<br><code>$ git remote add upstream git@github.com:geeeeeeeeek/git-recipes.git</code><br>æ­¤å¤„å¯ä½¿ç”¨ <code>git remote -v</code> æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯åˆ—è¡¨</p> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origingit@github.com:morethink/git-recipes.git (fetch)</span><br><span class="line">origingit@github.com:morethink/git-recipes.git (push)</span><br><span class="line">upstreamgit@github.com:geeeeeeeeek/git-recipes.git (fetch)</span><br><span class="line">upstreamgit@github.com:geeeeeeeeek/git-recipes.git (push)</span><br></pre></td></tr></table></figure></li><li><p>fetch æºåˆ†æ”¯çš„æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°<br><code>$ git fetch upstream</code></p></li><li>åˆ‡æ¢åˆ°æœ¬åœ°masteråˆ†æ”¯<br><code>$ git checkout master</code></li><li>åˆå¹¶ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç <br><code>$ git merge upstream/master</code></li><li>å°†åˆå¹¶åçš„ä»£ç  push åˆ° GitHub ä¸Šå»<br><code>$ git push origin master</code></li></ol><p><strong>å‚è€ƒæ–‡æ¡£ï¼š</strong></p><ol><li>æ·»åŠ è¿œç¨‹åˆ†æ”¯<br><a href="https://help.github.com/articles/configuring-a-remote-for-a-fork/" target="_blank" rel="noopener">https://help.github.com/articles/configuring-a-remote-for-a-fork/</a></li><li>å®ŒæˆåŒæ­¥<br><a href="https://help.github.com/articles/syncing-a-fork/" target="_blank" rel="noopener">https://help.github.com/articles/syncing-a-fork/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å½“æˆ‘ä»¬forkä¸€ä¸ªé¡¹ç›®åï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ä»£ç çš„æ—¶å€™å°±ä¼šä»¥æˆ‘ä»¬æœ¬åœ°ä¸ºå‡†ï¼Œä¸ä¼šè·Ÿéšæˆ‘ä»¬forkå‰çš„é¡¹ç›®ï¼Œå¦‚æœéœ€è¦åŒæ­¥å¯¹æ–¹çš„ä»£ç ï¼Œéœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Git" scheme="https://www.morethink.cn/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§webæ”»å‡»æ€»ç»“</title>
    <link href="https://www.morethink.cn/%E5%B8%B8%E8%A7%81web%E6%94%BB%E5%87%BB%E6%80%BB%E7%BB%93/"/>
    <id>https://www.morethink.cn/å¸¸è§webæ”»å‡»æ€»ç»“/</id>
    <published>2018-04-06T16:00:00.000Z</published>
    <updated>2018-04-07T10:17:36.145Z</updated>
    
    <content type="html"><![CDATA[<p>æWebå¼€å‘ç¦»ä¸å¼€å®‰å…¨è¿™ä¸ªè¯é¢˜ï¼Œç¡®ä¿ç½‘ç«™æˆ–è€…ç½‘é¡µåº”ç”¨çš„å®‰å…¨æ€§ï¼Œæ˜¯æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥äº†è§£çš„äº‹ã€‚æœ¬ç¯‡ä¸»è¦ç®€å•ä»‹ç»åœ¨Webé¢†åŸŸå‡ ç§å¸¸è§çš„æ”»å‡»æ‰‹æ®µåŠJava Webä¸­çš„é¢„é˜²æ–¹å¼ã€‚</p><ul><li><a href="#XSS">XSS</a></li><li><a href="#SQLæ³¨å…¥">SQLæ³¨å…¥</a></li><li><a href="#DDOS">DDOS</a></li><li><a href="#CSRF">CSRF</a></li></ul><a id="more"></a><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/morethink/web-security" target="_blank" rel="noopener">https://github.com/morethink/web-security</a></p><h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="ä»€ä¹ˆæ˜¯XSS"><a href="#ä»€ä¹ˆæ˜¯XSS" class="headerlink" title="ä»€ä¹ˆæ˜¯XSS"></a>ä»€ä¹ˆæ˜¯XSS</h2><p>XSSæ”»å‡»ï¼šè·¨ç«™è„šæœ¬æ”»å‡»(Cross-Site Scripting)ï¼Œä¸ºäº†ä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚XSSæ˜¯ä¸€ç§å¸¸è§çš„webå®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…å°†æ¶æ„ä»£ç æ¤å…¥åˆ°æä¾›ç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨çš„é¡µé¢ä¸­ã€‚ä¸åŒäºå¤§å¤šæ•°æ”»å‡»(ä¸€èˆ¬åªæ¶‰åŠæ”»å‡»è€…å’Œå—å®³è€…)ï¼ŒXSSæ¶‰åŠåˆ°ä¸‰æ–¹ï¼Œå³æ”»å‡»è€…ã€å®¢æˆ·ç«¯ä¸Webåº”ç”¨ã€‚XSSçš„æ”»å‡»ç›®æ ‡æ˜¯ä¸ºäº†ç›—å–å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„cookieæˆ–è€…å…¶ä»–ç½‘ç«™ç”¨äºè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½çš„æ•æ„Ÿä¿¡æ¯ã€‚ä¸€æ—¦è·å–åˆ°åˆæ³•ç”¨æˆ·çš„ä¿¡æ¯åï¼Œæ”»å‡»è€…ç”šè‡³å¯ä»¥å‡å†’åˆæ³•ç”¨æˆ·ä¸ç½‘ç«™è¿›è¡Œäº¤äº’ã€‚</p><p>XSSé€šå¸¸å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ol><li>å­˜å‚¨å‹XSSï¼Œä¸»è¦å‡ºç°åœ¨è®©ç”¨æˆ·è¾“å…¥æ•°æ®ï¼Œä¾›å…¶ä»–æµè§ˆæ­¤é¡µçš„ç”¨æˆ·è¿›è¡ŒæŸ¥çœ‹çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬ç•™è¨€ã€è¯„è®ºã€åšå®¢æ—¥å¿—å’Œå„ç±»è¡¨å•ç­‰ã€‚åº”ç”¨ç¨‹åºä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œåœ¨é¡µé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œæ”»å‡»è€…åœ¨ç›¸å…³é¡µé¢è¾“å…¥æ¶æ„çš„è„šæœ¬æ•°æ®åï¼Œç”¨æˆ·æµè§ˆæ­¤ç±»é¡µé¢æ—¶å°±å¯èƒ½å—åˆ°æ”»å‡»ã€‚è¿™ä¸ªæµç¨‹ç®€å•å¯ä»¥æè¿°ä¸ºï¼š<code>æ¶æ„ç”¨æˆ·çš„Htmlè¾“å…¥Webç¨‹åº-&gt;è¿›å…¥æ•°æ®åº“-&gt;Webç¨‹åº-&gt;ç”¨æˆ·æµè§ˆå™¨</code>ã€‚</li><li>åå°„å‹XSSï¼Œä¸»è¦åšæ³•æ˜¯å°†è„šæœ¬ä»£ç åŠ å…¥URLåœ°å€çš„è¯·æ±‚å‚æ•°é‡Œï¼Œè¯·æ±‚å‚æ•°è¿›å…¥ç¨‹åºååœ¨é¡µé¢ç›´æ¥è¾“å‡ºï¼Œç”¨æˆ·ç‚¹å‡»ç±»ä¼¼çš„æ¶æ„é“¾æ¥å°±å¯èƒ½å—åˆ°æ”»å‡»ã€‚</li></ol><p>æ¯”å¦‚è¯´æˆ‘å†™äº†ä¸€ä¸ªç½‘ç«™ï¼Œç„¶åæ”»å‡»è€…åœ¨ä¸Šé¢å‘å¸ƒäº†ä¸€ä¸ªæ–‡ç« ï¼Œå†…å®¹æ˜¯è¿™æ ·çš„ <code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>,å¦‚æœæˆ‘æ²¡æœ‰å¯¹ä»–çš„å†…å®¹è¿›è¡Œå¤„ç†ï¼Œç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å½“å…¶ä»–ç”¨æˆ·è®¿é—®ä»–çš„è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä»æ•°æ®åº“è¯»å–åç„¶åå“åº”ç»™å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨æ‰§è¡Œäº†è¿™æ®µè„šæœ¬ï¼Œå°±ä¼šå°†cookieå±•ç°å‡ºæ¥ï¼Œè¿™å°±æ˜¯å…¸å‹çš„å­˜å‚¨å‹XSSã€‚</p><p>å¦‚å›¾ï¼š<br><img src="https://images.morethink.cn/a1c6ebf6de227e086d0289f34d8c5f76.png" alt=""></p><h2 id="å¦‚ä½•é¢„é˜²XSS"><a href="#å¦‚ä½•é¢„é˜²XSS" class="headerlink" title="å¦‚ä½•é¢„é˜²XSS"></a>å¦‚ä½•é¢„é˜²XSS</h2><p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œåšå†³ä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥ï¼Œå¹¶è¿‡æ»¤æ‰è¾“å…¥ä¸­çš„æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚è¿™æ ·å°±èƒ½æ¶ˆç­ç»å¤§éƒ¨åˆ†çš„XSSæ”»å‡»ã€‚</p><p>ç›®å‰é˜²å¾¡XSSä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li>è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦<br>é¿å…XSSçš„æ–¹æ³•ä¹‹ä¸€ä¸»è¦æ˜¯å°†ç”¨æˆ·æ‰€æä¾›çš„å†…å®¹è¿›è¡Œè¿‡æ»¤(å¦‚ä¸Šé¢çš„<code>script</code>æ ‡ç­¾)ã€‚</li><li>ä½¿ç”¨HTTPå¤´æŒ‡å®šç±»å‹<br><code>w.Header().Set(&quot;Content-Type&quot;,&quot;text/javascript&quot;)</code><br>è¿™æ ·å°±å¯ä»¥è®©æµè§ˆå™¨è§£æjavascriptä»£ç ï¼Œè€Œä¸ä¼šæ˜¯htmlè¾“å‡ºã€‚</li></ol><h1 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h1><h2 id="ä»€ä¹ˆæ˜¯SQLæ³¨å…¥"><a href="#ä»€ä¹ˆæ˜¯SQLæ³¨å…¥" class="headerlink" title="ä»€ä¹ˆæ˜¯SQLæ³¨å…¥"></a>ä»€ä¹ˆæ˜¯SQLæ³¨å…¥</h2><p>æ”»å‡»è€…æˆåŠŸçš„å‘æœåŠ¡å™¨æäº¤æ¶æ„çš„SQLæŸ¥è¯¢ä»£ç ï¼Œç¨‹åºåœ¨æ¥æ”¶åé”™è¯¯çš„å°†æ”»å‡»è€…çš„è¾“å…¥ä½œä¸ºæŸ¥è¯¢è¯­å¥çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œå¯¼è‡´åŸå§‹çš„æŸ¥è¯¢é€»è¾‘è¢«æ”¹å˜ï¼Œé¢å¤–çš„æ‰§è¡Œäº†æ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„æ¶æ„ä»£ç ã€‚</p><p>ä¸¾ä¾‹ï¼š<code>&#39; OR &#39;1&#39;=&#39;1</code></p><p>è¿™æ˜¯æœ€å¸¸è§çš„ SQLæ³¨å…¥æ”»å‡»ï¼Œå½“æˆ‘ä»¬è¾“å¦‚ç”¨æˆ·å admin ï¼Œç„¶åå¯†ç è¾“å¦‚<code>&#39; OR &#39;1&#39;=1=&#39;1</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®çš„æ—¶å€™ï¼Œæœ¬æ¥è¦æ‰§è¡Œçš„æ˜¯<code>SELECT * FROM user WHERE username=&#39;&#39; and password=&#39;&#39;</code>,ç»è¿‡å‚æ•°æ‹¼æ¥åï¼Œä¼šæ‰§è¡Œ SQLè¯­å¥ <code>SELECT * FROM user WHERE username=&#39;&#39; and password=&#39;&#39; OR &#39;1&#39;=&#39;1&#39;</code>ï¼Œè¿™ä¸ªæ—¶å€™1=1æ˜¯æˆç«‹ï¼Œè‡ªç„¶å°±è·³è¿‡éªŒè¯äº†ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://images.morethink.cn/69855b1538333659f26afc281feb4e30.png" alt=""></p><p>ä½†æ˜¯å¦‚æœå†ä¸¥é‡ä¸€ç‚¹ï¼Œå¯†ç è¾“å¦‚çš„æ˜¯<code>&#39;;DROP TABLE user;--</code>ï¼Œé‚£ä¹ˆ SQLå‘½ä»¤ä¸º<code>SELECT *  FROM user WHERE username=&#39;admin&#39; and password=&#39;&#39;;drop table user;--&#39;</code> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ç›´æ¥æŠŠè¿™ä¸ªè¡¨ç»™åˆ é™¤äº†ã€‚</p><h2 id="å¦‚ä½•é¢„é˜²SQLæ³¨å…¥"><a href="#å¦‚ä½•é¢„é˜²SQLæ³¨å…¥" class="headerlink" title="å¦‚ä½•é¢„é˜²SQLæ³¨å…¥"></a>å¦‚ä½•é¢„é˜²SQLæ³¨å…¥</h2><ul><li>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥(PreparedStatement)ï¼Œè¿™æ ·çš„è¯å³ä½¿æˆ‘ä»¬ä½¿ç”¨ SQLè¯­å¥ä¼ªé€ æˆå‚æ•°ï¼Œåˆ°äº†æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œè¿™ä¸ªä¼ªé€  SQLè¯­å¥çš„å‚æ•°ä¹Ÿåªæ˜¯ç®€å•çš„å­—ç¬¦ï¼Œå¹¶ä¸èƒ½èµ·åˆ°æ”»å‡»çš„ä½œç”¨ã€‚</li><li>å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ<code>&#39;&quot;\å°–æ‹¬å·&amp;*</code>;ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚</li><li>åœ¨åº”ç”¨å‘å¸ƒä¹‹å‰å»ºè®®ä½¿ç”¨ä¸“ä¸šçš„SQLæ³¨å…¥æ£€æµ‹å·¥å…·è¿›è¡Œæ£€æµ‹ï¼Œä»¥åŠæ—¶ä¿®è¡¥è¢«å‘ç°çš„SQLæ³¨å…¥æ¼æ´ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„å¼€æºå·¥å…·ï¼Œä¾‹å¦‚sqlmapã€SQLninjaç­‰ã€‚</li><li>é¿å…ç½‘ç«™æ‰“å°å‡ºSQLé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼ŒæŠŠä»£ç é‡Œçš„SQLè¯­å¥æš´éœ²å‡ºæ¥ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡ŒSQLæ³¨å…¥ã€‚</li></ul><p>åœ¨ä¸Šå›¾å±•ç¤ºä¸­ï¼Œä½¿ç”¨äº†Java JDBCä¸­çš„<code>PreparedStatement</code>é¢„ç¼–è¯‘é¢„é˜²SQLæ³¨å…¥ï¼Œå¯ä»¥çœ‹åˆ°å°†æ‰€æœ‰è¾“å…¥éƒ½ä½œä¸ºäº†å­—ç¬¦ä¸²ï¼Œé¿å…æ‰§è¡Œæ¶æ„SQLã€‚</p><h1 id="DDOS"><a href="#DDOS" class="headerlink" title="DDOS"></a>DDOS</h1><h2 id="ä»€ä¹ˆæ˜¯DDOS"><a href="#ä»€ä¹ˆæ˜¯DDOS" class="headerlink" title="ä»€ä¹ˆæ˜¯DDOS"></a>ä»€ä¹ˆæ˜¯DDOS</h2><p>DDOSï¼šåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDistributed Denial of Serviceï¼‰ï¼Œç®€å•è¯´å°±æ˜¯å‘é€å¤§é‡è¯·æ±‚æ˜¯ä½¿æœåŠ¡å™¨ç˜«ç—ªã€‚DDosæ”»å‡»æ˜¯åœ¨DOSæ”»å‡»åŸºç¡€ä¸Šçš„ï¼Œå¯ä»¥é€šä¿—ç†è§£ï¼Œdosæ˜¯å•æŒ‘ï¼Œè€Œddosæ˜¯ç¾¤æ®´ï¼Œå› ä¸ºç°ä»£æŠ€æœ¯çš„å‘å±•ï¼Œdosæ”»å‡»çš„æ€ä¼¤åŠ›é™ä½ï¼Œæ‰€ä»¥å‡ºç°äº†DDOSï¼Œæ”»å‡»è€…å€ŸåŠ©å…¬å…±ç½‘ç»œï¼Œå°†å¤§æ•°é‡çš„è®¡ç®—æœºè®¾å¤‡è”åˆèµ·æ¥ï¼Œå‘ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡è¿›è¡Œæ”»å‡»ã€‚</p><p>åœ¨æŠ€æœ¯è§’åº¦ä¸Šï¼ŒDDoSæ”»å‡»å¯ä»¥é’ˆå¯¹ç½‘ç»œé€šè®¯åè®®çš„å„å±‚ï¼Œæ‰‹æ®µå¤§è‡´æœ‰ï¼šTCPç±»çš„SYN Floodã€ACK Floodï¼ŒUDPç±»çš„Fraggleã€Trinooï¼ŒDNS Query Floodï¼ŒICMP Floodï¼ŒSlowlorisç±»ç­‰ç­‰ã€‚ä¸€èˆ¬ä¼šæ ¹æ®æ”»å‡»ç›®æ ‡çš„æƒ…å†µï¼Œé’ˆå¯¹æ€§çš„æŠŠæŠ€æœ¯æ‰‹æ³•æ··åˆï¼Œä»¥è¾¾åˆ°æœ€ä½çš„æˆæœ¬æœ€éš¾é˜²å¾¡çš„ç›®çš„ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œåˆç†çš„èŠ‚å¥æ§åˆ¶ï¼Œä»¥åŠéšè—ä¿æŠ¤æ”»å‡»èµ„æºã€‚</p><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹TCPåè®®ä¸­çš„SYNæ”»å‡»ã€‚</p><h2 id="SYNæ”»å‡»"><a href="#SYNæ”»å‡»" class="headerlink" title="SYNæ”»å‡»"></a>SYNæ”»å‡»</h2><p>åœ¨ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å‘é€ <code>SYN-ACK</code> ä¹‹åï¼Œæ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>ACK</code> ä¹‹å‰çš„ TCP è¿æ¥ç§°ä¸ºåŠè¿æ¥(half-open connect)ã€‚æ­¤æ—¶æœåŠ¡å™¨å¤„äº <code>SYN_RCVD</code> çŠ¶æ€ã€‚å½“æ”¶åˆ° ACK åï¼ŒæœåŠ¡å™¨æ‰èƒ½è½¬å…¥ <code>ESTABLISHED</code> çŠ¶æ€.</p><p><code>SYN</code>æ”»å‡»æŒ‡çš„æ˜¯ï¼Œæ”»å‡»å®¢æˆ·ç«¯åœ¨çŸ­æ—¶é—´å†…ä¼ªé€ å¤§é‡ä¸å­˜åœ¨çš„IPåœ°å€ï¼Œå‘æœåŠ¡å™¨ä¸æ–­åœ°å‘é€<code>SYN</code>åŒ…ï¼ŒæœåŠ¡å™¨å›å¤ç¡®è®¤åŒ…ï¼Œå¹¶ç­‰å¾…å®¢æˆ·çš„ç¡®è®¤ã€‚ç”±äºæºåœ°å€æ˜¯ä¸å­˜åœ¨çš„ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸æ–­çš„é‡å‘ç›´è‡³è¶…æ—¶ï¼Œè¿™äº›ä¼ªé€ çš„<code>SYN</code>åŒ…å°†é•¿æ—¶é—´å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œæ­£å¸¸çš„<code>SYN</code>è¯·æ±‚è¢«ä¸¢å¼ƒï¼Œå¯¼è‡´ç›®æ ‡ç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼Œä¸¥é‡è€…ä¼šå¼•èµ·ç½‘ç»œå µå¡ç”šè‡³ç³»ç»Ÿç˜«ç—ªã€‚</p><h2 id="å¦‚ä½•é¢„é˜²DDOS"><a href="#å¦‚ä½•é¢„é˜²DDOS" class="headerlink" title="å¦‚ä½•é¢„é˜²DDOS"></a>å¦‚ä½•é¢„é˜²DDOS</h2><p>é˜¿é‡Œå·´å·´çš„å®‰å…¨å›¢é˜Ÿåœ¨å®æˆ˜ä¸­å‘ç°ï¼ŒDDoS é˜²å¾¡äº§å“çš„æ ¸å¿ƒæ˜¯æ£€æµ‹æŠ€æœ¯å’Œæ¸…æ´—æŠ€æœ¯ã€‚æ£€æµ‹æŠ€æœ¯å°±æ˜¯æ£€æµ‹ç½‘ç«™æ˜¯å¦æ­£åœ¨é­å— DDoS æ”»å‡»ï¼Œè€Œæ¸…æ´—æŠ€æœ¯å°±æ˜¯æ¸…æ´—æ‰å¼‚å¸¸æµé‡ã€‚è€Œæ£€æµ‹æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºå¯¹ä¸šåŠ¡æ·±åˆ»çš„ç†è§£ï¼Œæ‰èƒ½å¿«é€Ÿç²¾ç¡®åˆ¤æ–­å‡ºæ˜¯å¦çœŸçš„å‘ç”Ÿäº† DDoS æ”»å‡»ã€‚æ¸…æ´—æŠ€æœ¯å¯¹æ£€æµ‹æ¥è®²ï¼Œä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹è¦æ±‚çš„ç²’åº¦ä¸ä¸€æ ·ã€‚</p><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="ä»€ä¹ˆæ˜¯CSRF"><a href="#ä»€ä¹ˆæ˜¯CSRF" class="headerlink" title="ä»€ä¹ˆæ˜¯CSRF"></a>ä»€ä¹ˆæ˜¯CSRF</h2><p>CSRFï¼ˆCross-site request forgeryï¼‰ï¼Œä¸­æ–‡åç§°ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä¹Ÿè¢«ç§°ä¸ºï¼šone click attack/session ridingï¼Œç¼©å†™ä¸ºï¼šCSRF/XSRFã€‚</p><p>ä½ è¿™å¯ä»¥è¿™ä¹ˆç†è§£CSRFæ”»å‡»ï¼šæ”»å‡»è€…ç›—ç”¨äº†ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚CSRFèƒ½å¤Ÿåšçš„äº‹æƒ…åŒ…æ‹¬ï¼šä»¥ä½ åä¹‰å‘é€é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç›—å–ä½ çš„è´¦å·ï¼Œç”šè‡³äºè´­ä¹°å•†å“ï¼Œè™šæ‹Ÿè´§å¸è½¬è´¦â€¦â€¦é€ æˆçš„é—®é¢˜åŒ…æ‹¬ï¼šä¸ªäººéšç§æ³„éœ²ä»¥åŠè´¢äº§å®‰å…¨ã€‚</p><h2 id="CSRFçš„åŸç†"><a href="#CSRFçš„åŸç†" class="headerlink" title="CSRFçš„åŸç†"></a>CSRFçš„åŸç†</h2><p>ä¸‹å›¾ç®€å•é˜è¿°äº†CSRFæ”»å‡»çš„æ€<br><img src="https://images.morethink.cn/138ad4f05b47533bf46904dc165167cc.png" alt=""></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¦å®Œæˆä¸€æ¬¡CSRFæ”»å‡»ï¼Œå—å®³è€…å¿…é¡»ä¾æ¬¡å®Œæˆä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li>ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚</li><li>åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚</li></ol><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¹Ÿè®¸ä¼šè¯´ï¼šâ€œå¦‚æœæˆ‘ä¸æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘å°±ä¸ä¼šå—åˆ°CSRFçš„æ”»å‡»â€ã€‚æ˜¯çš„ï¼Œç¡®å®å¦‚æ­¤ï¼Œä½†ä½ ä¸èƒ½ä¿è¯ä»¥ä¸‹æƒ…å†µä¸ä¼šå‘ç”Ÿï¼š</p><ol><li>ä½ ä¸èƒ½ä¿è¯ä½ ç™»å½•äº†ä¸€ä¸ªç½‘ç«™åï¼Œä¸å†æ‰“å¼€ä¸€ä¸ªtabé¡µé¢å¹¶è®¿é—®å¦å¤–çš„ç½‘ç«™ã€‚</li><li>ä½ ä¸èƒ½ä¿è¯ä½ å…³é—­æµè§ˆå™¨äº†åï¼Œä½ æœ¬åœ°çš„Cookieç«‹åˆ»è¿‡æœŸï¼Œä½ ä¸Šæ¬¡çš„ä¼šè¯å·²ç»ç»“æŸã€‚ï¼ˆäº‹å®ä¸Šï¼Œå…³é—­æµè§ˆå™¨ä¸èƒ½ç»“æŸä¸€ä¸ªä¼šè¯ï¼Œä½†å¤§å¤šæ•°äººéƒ½ä¼šé”™è¯¯çš„è®¤ä¸ºå…³é—­æµè§ˆå™¨å°±ç­‰äºé€€å‡ºç™»å½•/ç»“æŸä¼šè¯äº†â€¦â€¦ï¼‰</li><li>ä¸Šå›¾ä¸­æ‰€è°“çš„æ”»å‡»ç½‘ç«™ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå­˜åœ¨å…¶ä»–æ¼æ´çš„å¯ä¿¡ä»»çš„ç»å¸¸è¢«äººè®¿é—®çš„ç½‘ç«™ã€‚</li></ol><p>ä¸‹é¢è®²ä¸€è®²javaè§£å†³CSRFæ”»å‡»çš„æ–¹å¼ã€‚</p><h2 id="æ¨¡æ‹ŸCSRFæ”»å‡»"><a href="#æ¨¡æ‹ŸCSRFæ”»å‡»" class="headerlink" title="æ¨¡æ‹ŸCSRFæ”»å‡»"></a>æ¨¡æ‹ŸCSRFæ”»å‡»</h2><h3 id="ç™»å½•Aç½‘ç«™"><a href="#ç™»å½•Aç½‘ç«™" class="headerlink" title="ç™»å½•Aç½‘ç«™"></a>ç™»å½•Aç½‘ç«™</h3><p>ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯adminã€‚</p><p><code>http://localhost:8081/login.html</code>:<br><img src="https://images.morethink.cn/e298f8ef08869557b8fb60034f06bb80.png" alt=""></p><h3 id="ä½ æœ‰æƒé™åˆ é™¤1å·å¸–å­"><a href="#ä½ æœ‰æƒé™åˆ é™¤1å·å¸–å­" class="headerlink" title="ä½ æœ‰æƒé™åˆ é™¤1å·å¸–å­"></a>ä½ æœ‰æƒé™åˆ é™¤1å·å¸–å­</h3><p><code>http://localhost:8081/deletePost.html</code>:<br><img src="https://images.morethink.cn/897d358f2677d053bb9555ff69d112ac.png" alt=""></p><h3 id="ç™»å½•æœ‰CSRFæ”»å‡»Aç½‘ç«™çš„Bç½‘ç«™"><a href="#ç™»å½•æœ‰CSRFæ”»å‡»Aç½‘ç«™çš„Bç½‘ç«™" class="headerlink" title="ç™»å½•æœ‰CSRFæ”»å‡»Aç½‘ç«™çš„Bç½‘ç«™"></a>ç™»å½•æœ‰CSRFæ”»å‡»Aç½‘ç«™çš„Bç½‘ç«™</h3><p><code>http://localhost:8082/deletePost.html</code>:</p><p><img src="https://images.morethink.cn/csrf-attack.gif" alt=""></p><p>æ˜æ˜¾çœ‹åˆ°Bç½‘ç«™æ˜¯8082ç«¯å£ï¼ŒAç½‘ç«™æ˜¯8081ç«¯å£ï¼Œä½†æ˜¯Bç½‘ç«™çš„åˆ é™¤2å·å¸–å­åŠŸèƒ½ä¾ç„¶å®ç°ã€‚</p><h2 id="å¦‚ä½•é¢„é˜²CSRFæ”»å‡»"><a href="#å¦‚ä½•é¢„é˜²CSRFæ”»å‡»" class="headerlink" title="å¦‚ä½•é¢„é˜²CSRFæ”»å‡»"></a>å¦‚ä½•é¢„é˜²CSRFæ”»å‡»</h2><p>ç®€å•æ¥è¯´ï¼ŒCSRF å°±æ˜¯ç½‘ç«™ A å¯¹ç”¨æˆ·å»ºç«‹ä¿¡ä»»å…³ç³»åï¼Œåœ¨ç½‘ç«™ B ä¸Šåˆ©ç”¨è¿™ç§ä¿¡ä»»å…³ç³»ï¼Œè·¨ç«™ç‚¹å‘ç½‘ç«™ A å‘èµ·ä¸€äº›ä¼ªé€ çš„ç”¨æˆ·æ“ä½œè¯·æ±‚ï¼Œä»¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚</p><p>è€Œä¹‹æ‰€ä»¥å¯ä»¥å®Œæˆæ”»å‡»æ˜¯å› ä¸ºBå‘Aå‘èµ·æ”»å‡»çš„æ—¶å€™ä¼šæŠŠAç½‘ç«™çš„cookieå¸¦ç»™Aç½‘ç«™ï¼Œä¹Ÿå°±æ˜¯è¯´cookieå·²ç»ä¸å®‰å…¨äº†ã€‚</p><h3 id="é€šè¿‡Synchronizer-Tokens"><a href="#é€šè¿‡Synchronizer-Tokens" class="headerlink" title="é€šè¿‡Synchronizer Tokens"></a>é€šè¿‡Synchronizer Tokens</h3><p>Synchronizer Tokensï¼š åœ¨è¡¨å•é‡Œéšè—ä¸€ä¸ªéšæœºå˜åŒ–çš„ csrf_token csrf_token æäº¤åˆ°åå°è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡åˆ™å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚è¿™ç§æƒ…å†µæœ‰æ•ˆçš„ä¸»è¦åŸå› æ˜¯ç½‘ç«™ B æ‹¿ä¸åˆ°ç½‘ç«™ A è¡¨å•é‡Œçš„ csrf_token</p><p>è¿™ç§æ–¹å¼çš„ä½¿ç”¨æ¡ä»¶æ˜¯PHPå’ŒJSPç­‰ã€‚å› ä¸ºcookieå·²ç»ä¸å®‰å…¨äº†ï¼Œå› æ­¤æŠŠcsrf_tokenå€¼å­˜å‚¨åœ¨sessionä¸­ï¼Œç„¶åæ¯æ¬¡è¡¨å•æäº¤æ—¶éƒ½ä»sessionå–å‡ºæ¥æ”¾åˆ°formè¡¨å•çš„éšè—åŸŸä¸­ï¼Œè¿™æ ·Bç½‘ç«™ä¸å¯ä»¥å¾—åˆ°è¿™ä¸ªå­˜å‚¨åˆ°sessionä¸­çš„å€¼ã€‚</p><p>ä¸‹é¢æ˜¯JSPçš„ï¼š<br><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;input type="hidden" name="random_form" value=&lt;%=random%&gt;&gt;&lt;/input&gt;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯æˆ‘ç°åœ¨çš„æƒ…å†µæ˜¯htmlï¼Œä¸æ˜¯JSPï¼Œå¹¶ä¸èƒ½åŠ¨æ€çš„ä»sessionä¸­å–å‡ºcsrf_tokenå€¼ã€‚åªèƒ½é‡‡ç”¨åŠ å¯†çš„æ–¹å¼äº†ã€‚</p><h3 id="HashåŠ å¯†cookieä¸­csrf-tokenå€¼"><a href="#HashåŠ å¯†cookieä¸­csrf-tokenå€¼" class="headerlink" title="HashåŠ å¯†cookieä¸­csrf_tokenå€¼"></a>HashåŠ å¯†cookieä¸­csrf_tokenå€¼</h3><p>è¿™å¯èƒ½æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆäº†ï¼Œå› ä¸ºæ”»å‡»è€…ä¸èƒ½è·å¾—ç¬¬ä¸‰æ–¹çš„Cookie(ç†è®ºä¸Š)ï¼Œæ‰€ä»¥è¡¨å•ä¸­çš„æ•°æ®ä¹Ÿå°±æ„é€ å¤±è´¥äº†ã€‚</p><p>æˆ‘é‡‡ç”¨çš„hashåŠ å¯†æ–¹æ³•æ˜¯JSå®ç°Javaçš„HashCodeæ–¹æ³•ï¼Œå¾—åˆ°hashå€¼ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„hashç®—æ³•ã€‚</p><p>å‰ç«¯å‘åå°ä¼ é€’hashä¹‹åçš„csrf_tokenå€¼å’Œcookieä¸­çš„csrf_tokenå€¼ï¼Œåå°æ‹¿åˆ°cookieä¸­çš„csrf_tokenå€¼åå¾—åˆ°hashCodeå€¼ç„¶åä¸å‰ç«¯ä¼ è¿‡æ¥çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸€æ ·åˆ™é€šè¿‡ã€‚</p><h4 id="ä½ æœ‰æƒé™åˆ é™¤3å·å¸–å­"><a href="#ä½ æœ‰æƒé™åˆ é™¤3å·å¸–å­" class="headerlink" title="ä½ æœ‰æƒé™åˆ é™¤3å·å¸–å­"></a>ä½ æœ‰æƒé™åˆ é™¤3å·å¸–å­</h4><p><code>http://localhost:8081/deletePost.html</code></p><p><img src="https://images.morethink.cn/2ac5eab98780646c6c36dcdc98fa50c7.png" alt=""></p><h4 id="Bç½‘ç«™çš„ä»–å·²ç»æ²¡æœ‰æƒé™äº†"><a href="#Bç½‘ç«™çš„ä»–å·²ç»æ²¡æœ‰æƒé™äº†" class="headerlink" title="Bç½‘ç«™çš„ä»–å·²ç»æ²¡æœ‰æƒé™äº†"></a>Bç½‘ç«™çš„ä»–å·²ç»æ²¡æœ‰æƒé™äº†</h4><p>æˆ‘ä»¬é€šè¿‡UserFilter.javaç»™æ”»å‡»è€…è¿”å›çš„æ˜¯403é”™è¯¯ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç†è§£ç”¨æˆ·å®¢æˆ·ç«¯çš„è¯·æ±‚ä½†æ‹’ç»å¤„ç†ã€‚</p><p><code>http://localhost:8082/deletePost.html</code>:<br><img src="https://images.morethink.cn/csrf-attack-fail-failure.gif" alt=""></p><p>æ”»å‡»è€…ä¸èƒ½åˆ é™¤4å·å¸–å­ã€‚</p><p>å‰ç«¯ä»£ç ï¼š</p><p>deletePost.html</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>deletePost<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">deletePost</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> url = <span class="string">'/post/'</span> + <span class="built_in">document</span>.getElementById(<span class="string">"postId"</span>).value;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> csrf_token = <span class="built_in">document</span>.cookie.replace(<span class="regexp">/(?:(?:^|.*;\s*)csrf_token\s*\=\s*([^;]*).*$)|^.*$/</span>, <span class="string">"$1"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'csrf_token='</span> + csrf_token);</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                type: <span class="string">"post"</span>,<span class="comment">//è¯·æ±‚æ–¹å¼</span></span></span><br><span class="line"><span class="javascript">                url: url,  <span class="comment">//å‘é€è¯·æ±‚åœ°å€</span></span></span><br><span class="line"><span class="javascript">                timeout: <span class="number">30000</span>,<span class="comment">//è¶…æ—¶æ—¶é—´ï¼š30ç§’</span></span></span><br><span class="line"><span class="undefined">                data: &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="string">"_method"</span>: <span class="string">"delete"</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="string">"csrf_token"</span>: hash(csrf_token) <span class="comment">// å¯¹csrf_tokenè¿›è¡ŒhashåŠ å¯†</span></span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="javascript">                dataType: <span class="string">"json"</span>,<span class="comment">//è®¾ç½®è¿”å›æ•°æ®çš„æ ¼å¼</span></span></span><br><span class="line"><span class="javascript">                success: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (result.message == <span class="string">"success"</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">"#result"</span>).text(<span class="string">"åˆ é™¤æˆåŠŸ"</span>);</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">"#result"</span>).text(<span class="string">"åˆ é™¤å¤±è´¥"</span>);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="javascript">                error: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//è¯·æ±‚å‡ºé”™çš„å¤„ç†</span></span></span><br><span class="line"><span class="javascript">                    $(<span class="string">"#result"</span>).text(<span class="string">"è¯·æ±‚å‡ºé”™"</span>);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// javascriptçš„Stringåˆ°int(32ä½)çš„hashç®—æ³•</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">hash</span>(<span class="params">str</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> hash = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (str.length == <span class="number">0</span>) <span class="keyword">return</span> hash;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; str.length; i++) &#123;</span></span><br><span class="line"><span class="undefined">                char = str.charCodeAt(i);</span></span><br><span class="line"><span class="undefined">                hash = ((hash &lt;&lt; 5) - hash) + char;</span></span><br><span class="line"><span class="javascript">                hash = hash &amp; hash; <span class="comment">// Convert to 32bit integer</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> hash;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>åˆ é™¤å¸–å­<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">å¸–å­ç¼–å· ï¼š <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"postId"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"deletePost();"</span>&gt;</span>deletePost<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åå°ä»£ç ï¼š</p><p>UserInterceptor.java</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.morethink.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.morethink.util.JsonUtil;</span><br><span class="line"><span class="keyword">import</span> cn.morethink.util.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ææ–‡æµ©</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/1/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String method = request.getMethod();</span><br><span class="line">        System.out.println(method);</span><br><span class="line">        <span class="keyword">if</span> (method.equalsIgnoreCase(<span class="string">"POST"</span>) || method.equalsIgnoreCase(<span class="string">"DELETE"</span>)</span><br><span class="line">                || method.equalsIgnoreCase(<span class="string">"PUT"</span>)) &#123;</span><br><span class="line">            String csrf_token = request.getParameter(<span class="string">"csrf_token"</span>);</span><br><span class="line">            Cookie[] cookies = request.getCookies();</span><br><span class="line">            <span class="keyword">if</span> (cookies != <span class="keyword">null</span> &amp;&amp; cookies.length &gt; <span class="number">0</span> &amp;&amp; csrf_token != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cookie.getName().equals(<span class="string">"csrf_token"</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (Integer.valueOf(csrf_token) == cookie.getValue().hashCode()) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Result result = <span class="keyword">new</span> Result(<span class="string">"403"</span>, <span class="string">"ä½ è¿˜æƒ³æ”»å‡»æˆ‘??????????"</span>, <span class="string">""</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.write(JsonUtil.toJson(result));</span><br><span class="line">        out.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><ol><li>cookieå¿…é¡»è¦è®¾ç½®PATHæ‰å¯ä»¥ç”Ÿæ•ˆï¼Œå¦åˆ™åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™æ— æ³•å¸¦ç»™æœåŠ¡å™¨ã€‚</li><li>Spring Boot å‡ºç°å¯åŠ¨æ‰¾ä¸åˆ°ä¸»ç±»çš„é—®é¢˜æ—¶å¯ä»¥mvn cleanä¸€ä¸‹ã€‚</li><li>Filterè®¾ç½®response.sendError(403)åœ¨Spring Bootæ²¡æœ‰æ•ˆæœã€‚</li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šé¢ä¸€å…±æåˆ°äº†4ç§æ”»å‡»æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯XSSæ”»å‡»ï¼ˆå…³é”®æ˜¯è„šæœ¬ï¼Œåˆ©ç”¨æ¶æ„è„šæœ¬å‘èµ·æ”»å‡»ï¼‰ï¼ŒSQLæ³¨å…¥ï¼ˆå…³é”®æ˜¯é€šè¿‡ç”¨SQLè¯­å¥ä¼ªé€ å‚æ•°å‘å‡ºæ”»å‡»ï¼‰ï¼ŒDDOSæ”»å‡»ï¼ˆå…³é”®æ˜¯å‘å‡ºå¤§é‡è¯·æ±‚ï¼Œæœ€åä»¤æœåŠ¡å™¨å´©æºƒï¼‰ï¼ŒCSRFæ”»å‡»ï¼ˆå…³é”®æ˜¯å€ŸåŠ©æœ¬åœ°cookieè¿›è¡Œè®¤è¯ï¼Œä¼ªé€ å‘é€è¯·æ±‚ï¼‰ã€‚</p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://zhuanlan.zhihu.com/p/24249045" target="_blank" rel="noopener">XSSå®æˆ˜ï¼šæˆ‘æ˜¯å¦‚ä½•æ‹¿ä¸‹ä½ çš„ç™¾åº¦è´¦å·</a></li><li><a href="http://www.cnblogs.com/-new/p/7135814.html" target="_blank" rel="noopener">æ€»ç»“å‡ ç§å¸¸è§webæ”»å‡»æ‰‹æ®µåŠå…¶é˜²å¾¡æ–¹å¼</a></li><li><a href="https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html" target="_blank" rel="noopener">æµ…è°ˆCSRFæ”»å‡»æ–¹å¼</a></li><li><a href="http://blog.csdn.net/zzhongcy/article/details/20133883" target="_blank" rel="noopener">jQueue åŠ¨æ€è®¾ç½®formè¡¨å•çš„actionå±æ€§çš„å€¼å’Œæ–¹æ³•</a></li><li><a href="https://www.thinksaas.cn/group/topic/304242/" target="_blank" rel="noopener">javascriptçš„Stringåˆ°int(32ä½)çš„hashç®—æ³•</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æWebå¼€å‘ç¦»ä¸å¼€å®‰å…¨è¿™ä¸ªè¯é¢˜ï¼Œç¡®ä¿ç½‘ç«™æˆ–è€…ç½‘é¡µåº”ç”¨çš„å®‰å…¨æ€§ï¼Œæ˜¯æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥äº†è§£çš„äº‹ã€‚æœ¬ç¯‡ä¸»è¦ç®€å•ä»‹ç»åœ¨Webé¢†åŸŸå‡ ç§å¸¸è§çš„æ”»å‡»æ‰‹æ®µåŠJava Webä¸­çš„é¢„é˜²æ–¹å¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#XSS&quot;&gt;XSS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#SQLæ³¨å…¥&quot;&gt;SQLæ³¨å…¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#DDOS&quot;&gt;DDOS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#CSRF&quot;&gt;CSRF&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Webå®‰å…¨" scheme="https://www.morethink.cn/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>GitåŒæ—¶pushåˆ°å¤šä¸ªè¿œç¨‹ä»“åº“</title>
    <link href="https://www.morethink.cn/%E5%B7%A5%E5%85%B7/Git%E5%90%8C%E6%97%B6push%E5%88%B0%E5%A4%9A%E4%B8%AA%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/"/>
    <id>https://www.morethink.cn/å·¥å…·/GitåŒæ—¶pushåˆ°å¤šä¸ªè¿œç¨‹ä»“åº“/</id>
    <published>2018-04-02T16:00:00.000Z</published>
    <updated>2018-05-23T16:31:10.718Z</updated>
    
    <content type="html"><![CDATA[<p>æ·»åŠ ç¬¬äºŒä¸ªè¿œç¨‹åœ°å€æ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<br><code>git remote set-url --add origin git@github.com:morethink/programming.git</code></p><p>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š<code>git remote -v</code></p><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">origingit@git.coding.net:morethink/programming.git (fetch)</span><br><span class="line">origingit@git.coding.net:morethink/programming.git (push)</span><br><span class="line">originhexo@MyHost2:/var/repo/gitbook.git (push)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åŒæ—¶ push åˆ°å¤šä¸ªè¿œç¨‹åœ°å€ï¼š<code>git push origin master</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Everything up-to-date</span><br><span class="line">Everything up-to-date</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ·»åŠ ç¬¬äºŒä¸ªè¿œç¨‹åœ°å€æ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š&lt;br&gt;&lt;code&gt;git remote set-url --add origin git@github.com:morethink/programming.git&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼š&lt;code&gt;git remote -v&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://www.morethink.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Git" scheme="https://www.morethink.cn/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>äºŒå‰æ ‘ä»å³è¾¹çœ‹åˆ°çš„èŠ‚ç‚¹</title>
    <link href="https://www.morethink.cn/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91%E4%BB%8E%E5%8F%B3%E8%BE%B9%E7%9C%8B%E5%88%B0%E7%9A%84%E8%8A%82%E7%82%B9/"/>
    <id>https://www.morethink.cn/ç®—æ³•/äºŒå‰æ ‘ä»å³è¾¹çœ‹åˆ°çš„èŠ‚ç‚¹/</id>
    <published>2018-03-31T16:00:00.000Z</published>
    <updated>2018-06-29T09:32:08.288Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹ LeetCode <a href="https://leetcode.com/problems/binary-tree-right-side-view/description/" target="_blank" rel="noopener">Binary Tree Right Side View</a> è§£æ³•çš„æ¢è®¨ã€‚</p><p>é¢˜ç›®ï¼š<br>Given a binary tree, imagine yourself standing on the right side of it, return the values of the nodes you can see ordered from top to bottom.<br><a id="more"></a><br>For example:<br>Given the following binary tree,<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  1            &lt;---</span><br><span class="line"> /   \</span><br><span class="line">2     3         &lt;---</span><br><span class="line"> \     \</span><br><span class="line">  5     4       &lt;---</span><br></pre></td></tr></table></figure></p><p>You should return [1, 3, 4].</p><p>è§£æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å› ä¸ºé¢˜ç›®çš„äºŒå‰æ ‘å¹¶ä¸æ˜¯æ»¡äºŒå‰æ ‘ï¼Œæ‰€ä»¥é‡‡ç”¨å±‚åºéå†çš„æ–¹å¼ã€‚</span></span><br><span class="line"><span class="comment"> * å°†ä»¥å‰å±‚åºéå†ä¸­ä¸€ä¸ªä¸ªå‡ºé˜Ÿçš„æ–¹å¼å˜ä¸ºä¸€å±‚å±‚å‡ºé˜Ÿï¼Œ</span></span><br><span class="line"><span class="comment"> * è¿™æ ·å°±èƒ½å®šä½æœ€å³è¾¹çš„èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">rightSideView</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    queue.offer(root);</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> size = queue.size();</span><br><span class="line">        <span class="comment">//å°†æ¯ä¸€å±‚çš„èŠ‚ç‚¹éƒ½å‡ºé˜Ÿ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            TreeNode treeNode = queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                list.add(treeNode.val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (treeNode.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.offer(treeNode.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (treeNode.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.offer(treeNode.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ LeetCode &lt;a href=&quot;https://leetcode.com/problems/binary-tree-right-side-view/description/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Binary Tree Right Side View&lt;/a&gt; è§£æ³•çš„æ¢è®¨ã€‚&lt;/p&gt;
&lt;p&gt;é¢˜ç›®ï¼š&lt;br&gt;Given a binary tree, imagine yourself standing on the right side of it, return the values of the nodes you can see ordered from top to bottom.&lt;br&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://www.morethink.cn/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æ ‘" scheme="https://www.morethink.cn/tags/%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>æ±‚å°äºnçš„ç´ æ•°ä¸ªæ•°</title>
    <link href="https://www.morethink.cn/%E6%B1%82%E5%B0%8F%E4%BA%8En%E7%9A%84%E7%B4%A0%E6%95%B0%E4%B8%AA%E6%95%B0/"/>
    <id>https://www.morethink.cn/æ±‚å°äºnçš„ç´ æ•°ä¸ªæ•°/</id>
    <published>2018-03-10T16:00:00.000Z</published>
    <updated>2018-03-23T03:03:50.192Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹ LeetCode <a href="https://leetcode.com/problems/count-primes/description/" target="_blank" rel="noopener">Count Primes</a> è§£æ³•çš„æ¢è®¨ã€‚</p><p>é¢˜ç›®ï¼š<br>Count the number of prime numbers less than a non-negative number, n.</p><p>å°½ç®¡é¢˜ç›®å¹¶æ²¡æœ‰è¦æˆ‘ä»¬å†™ä¸€ä¸ªæœ€ä¼˜çš„ç®—æ³•ï¼Œä½†æ˜¯èº«ä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä¼˜åŒ–åº”è¯¥æ˜¯ä¸€ç§ä¹ æƒ¯ï¼Œåœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œéšç€æ€è€ƒè¿›è¡Œä¼˜åŒ–ã€‚åªè¦æ±‚æˆ‘ä»¬æ»¡è¶³ç»™å®šçš„æ—¶é—´å’Œç©ºé—´å³å¯ã€‚</p><p>å¦‚æœä½ åªèƒ½æƒ³å‡ºä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ³•ï¼Œéš¾é“ä½ ä¼šæœ‰ä»€ä¹ˆç«äº‰åŠ›å—ï¼Ÿ</p><a id="more"></a><h1 id="ç©·ä¸¾"><a href="#ç©·ä¸¾" class="headerlink" title="ç©·ä¸¾"></a>ç©·ä¸¾</h1><p>æœ€å¼€å§‹æˆ‘ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¯´è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹æ³•äº†ï¼Œè€Œä¸”æœ€å¼€å§‹ï¼Œæˆ‘å°±æ˜¯æƒ³çš„è¿™ç§æ–¹æ³•ï¼Œè¯´æ˜ï¼šæˆ‘æ²¡æœ‰å¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œæ€è€ƒï¼Œæ²¡æœ‰å»ä¼˜åŒ–å®ƒï¼Œè€Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¦‚ä½•æé«˜æ•ˆç‡æ˜¯æ‹¿åˆ°ä¸€ä¸ªé—®é¢˜é¦–å…ˆè¦æ€è€ƒçš„äº‹æƒ…ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countPrimes</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; i - <span class="number">1</span>; j++)</span><br><span class="line">            <span class="keyword">if</span> (i % j == <span class="number">0</span>) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–å¼€å§‹æ—¶</span></span><br><span class="line">    <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"The num is "</span> + <span class="keyword">new</span> L_204_Count_Primes().countPrimes(<span class="number">2000000</span>));</span><br><span class="line">    <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//è·å–ç»“æŸæ—¶é—´</span></span><br><span class="line">    System.out.println(<span class="string">"ç¨‹åºè¿è¡Œæ—¶é—´ï¼š "</span> + (endTime - startTime) + <span class="string">"ms"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ—¶é—´å¤ªé•¿ï¼Œå·²ç»ä¸èƒ½è®¡ç®—ã€‚</p></blockquote><h1 id="åªèƒ½æ˜¯å¥‡æ•°ä¸”å°äº-sqrt-n"><a href="#åªèƒ½æ˜¯å¥‡æ•°ä¸”å°äº-sqrt-n" class="headerlink" title="åªèƒ½æ˜¯å¥‡æ•°ä¸”å°äº$\sqrt{n}$"></a>åªèƒ½æ˜¯å¥‡æ•°ä¸”å°äº$\sqrt{n}$</h1><p>æ€è€ƒåå‘ç°</p><ol><li>ç´ æ•°ä¸€å®šæ˜¯å¥‡æ•°</li><li>è‹¥ n=ab æ˜¯ä¸ªåˆæ•°ï¼ˆå…¶ä¸­ a ä¸ b â‰  1ï¼‰, åˆ™å…¶ä¸­ä¸€ä¸ªçº¦æ•° a æˆ– b å¿…å®šè‡³å¤§ä¸º  $\sqrt{n}$.</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countPrimes2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt; n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt;= (<span class="keyword">int</span>) Math.sqrt(i); j++)</span><br><span class="line">            <span class="keyword">if</span> (i % j == <span class="number">0</span>) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>The num is 148933<br>ç¨‹åºè¿è¡Œæ—¶é—´ï¼š 1124ms</p></blockquote><h1 id="è¯•é™¤æ³•ï¼šæ•°å­¦çŸ¥è¯†çš„è¿ç”¨"><a href="#è¯•é™¤æ³•ï¼šæ•°å­¦çŸ¥è¯†çš„è¿ç”¨" class="headerlink" title="è¯•é™¤æ³•ï¼šæ•°å­¦çŸ¥è¯†çš„è¿ç”¨"></a>è¯•é™¤æ³•ï¼šæ•°å­¦çŸ¥è¯†çš„è¿ç”¨</h1><p>æŸ¥é˜… <a href="https://zh.wikipedia.org/wiki/%E7%AE%97%E6%9C%AF%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86" target="_blank" rel="noopener">ç®—æœ¯åŸºæœ¬å®šç†</a>å¯çŸ¥ï¼š</p><blockquote><p><strong>ç®—æœ¯åŸºæœ¬å®šç†</strong> :<br>æ¯ä¸ªå¤§äº1çš„æ•´æ•°å‡å¯å†™æˆä¸€ä¸ªä»¥ä¸Šçš„ç´ æ•°ä¹‹ä¹˜ç§¯ï¼Œä¸”é™¤äº†è´¨çº¦æ•°çš„æ’åºä¸åŒå¤–æ˜¯å”¯ä¸€çš„</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ¯ä¸ªæ•°æ¥é™¤ä»¥å¾—åˆ°çš„ç´ æ•°ï¼Œè¿™æ ·å¯å¤§å¤§å‡å°‘è¿è¡Œæ¬¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countPrimes3</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//0 1 ä¸ç®—åšç´ æ•°,2ä¸€å®šæ˜¯ç´ æ•°</span></span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">boolean</span> flag;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt; n; i += <span class="number">2</span>) &#123;</span><br><span class="line">        flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; list.size() &amp;&amp; list.get(j) &lt;= (<span class="keyword">int</span>) Math.sqrt(n); j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % list.get(j) == <span class="number">0</span>) &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list.size();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>The num is 148933<br>ç¨‹åºè¿è¡Œæ—¶é—´ï¼š 383ms</p></blockquote><h1 id="ç­›é€‰æ³•"><a href="#ç­›é€‰æ³•" class="headerlink" title="ç­›é€‰æ³•"></a>ç­›é€‰æ³•</h1><blockquote><p>åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•ï¼Œç®€ç§°åŸƒæ°ç­›ï¼Œä¹Ÿæœ‰äººç§°ç´ æ•°ç­›ã€‚è¿™æ˜¯ä¸€ç§ç®€å•ä¸”å†å²æ‚ ä¹…çš„ç­›æ³•ï¼Œç”¨æ¥æ‰¾å‡ºä¸€å®šèŒƒå›´å†…æ‰€æœ‰çš„ç´ æ•°ã€‚</p><p>æ‰€ä½¿ç”¨çš„åŸç†æ˜¯ä»2å¼€å§‹ï¼Œå°†æ¯ä¸ªç´ æ•°çš„å„ä¸ªå€æ•°ï¼Œæ ‡è®°æˆåˆæ•°ã€‚ä¸€ä¸ªç´ æ•°çš„å„ä¸ªå€æ•°ï¼Œæ˜¯ä¸€ä¸ªå·®ä¸ºæ­¤ç´ æ•°æœ¬èº«çš„ç­‰å·®æ•°åˆ—ã€‚æ­¤ä¸ºè¿™ä¸ªç­›æ³•å’Œè¯•é™¤æ³•ä¸åŒçš„å…³é”®ä¹‹å¤„ï¼Œåè€…æ˜¯ä»¥ç´ æ•°æ¥æµ‹è¯•æ¯ä¸ªå¾…æµ‹æ•°èƒ½å¦è¢«æ•´é™¤ã€‚</p></blockquote><p>ç­›é€‰æ³•çš„ç­–ç•¥æ˜¯å°†ç´ æ•°çš„å€æ•°å…¨éƒ¨ç­›æ‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç´ æ•°äº†ï¼Œä¸‹å›¾å¾ˆç”ŸåŠ¨çš„ä½“ç°äº†ç­›é€‰çš„è¿‡ç¨‹ï¼š</p><p><img src="https://images.morethink.cn/dcp5x843_338cbm3tmg7_b.gif" alt="" title="ç­›é€‰æ³•"></p><p>ç­›é€‰çš„è¿‡ç¨‹æ˜¯å…ˆç­›æ‰éç´ æ•°ï¼Œé’ˆå¯¹æœ¬æ–‡çš„é¢˜ç›®ï¼Œæ¯ç­›æ‰ä¸€ä¸ªï¼Œç´ æ•°æ•°é‡-1å³å¯ï¼Œä¸Šé¢è¯´è¿‡ç´ æ•°çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œé™¤äº†2ï¼Œå…¶å®ƒçš„ç´ æ•°éƒ½æ˜¯å¥‡æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€åœ¨å¥‡æ•°èŒƒå›´å†…ç­›é€‰å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countPrimes4</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//falseä»£è¡¨ç´ æ•°ï¼Œtrueä»£è¡¨éç´ æ•°</span></span><br><span class="line">    <span class="keyword">boolean</span>[] flags = <span class="keyword">new</span> <span class="keyword">boolean</span>[n];</span><br><span class="line">    <span class="comment">//0ä¸æ˜¯ç´ æ•°</span></span><br><span class="line">    flags[<span class="number">0</span>] = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">//1ä¸æ˜¯ç´ æ•°</span></span><br><span class="line">    flags[<span class="number">1</span>] = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">int</span> num = n - <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= (<span class="keyword">int</span>) Math.sqrt(n); i++) &#123;</span><br><span class="line">        <span class="comment">//å½“iä¸ºç´ æ•°æ—¶ï¼Œiçš„æ‰€æœ‰å€æ•°éƒ½ä¸æ˜¯ç´ æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (!flags[i]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> * i; j &lt; n; j += i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!flags[j]) &#123;</span><br><span class="line">                    flags[j] = <span class="keyword">true</span>;</span><br><span class="line">                    num--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>The num is 148933<br>ç¨‹åºè¿è¡Œæ—¶é—´ï¼š 43ms</p></blockquote><p>å…¨éƒ¨ä»£ç æ”¾åœ¨ï¼š<br> <a href="https://github.com/morethink/algorithm/blob/master/src/algorithm/leetcode/L_204_Count_Primes.java" target="_blank" rel="noopener">https://github.com/morethink/algorithm/blob/master/src/algorithm/leetcode/L_204_Count_Primes.java</a></p><p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p><ol><li><a href="https://program-think.blogspot.com/2011/12/prime-algorithm-1.html" target="_blank" rel="noopener">æ±‚è´¨æ•°ç®—æ³•çš„Nç§å¢ƒç•Œ[1] - è¯•é™¤æ³•å’Œåˆçº§ç­›æ³•</a></li><li><a href="http://blog.csdn.net/ghsau/article/details/78768157" target="_blank" rel="noopener"> æ±‚ç´ æ•°ä¸ªæ•°</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%9F%83%E6%8B%89%E6%89%98%E6%96%AF%E7%89%B9%E5%B0%BC%E7%AD%9B%E6%B3%95" target="_blank" rel="noopener">åŸƒæ‹‰æ‰˜æ–¯ç‰¹å°¼ç­›æ³•</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ LeetCode &lt;a href=&quot;https://leetcode.com/problems/count-primes/description/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Count Primes&lt;/a&gt; è§£æ³•çš„æ¢è®¨ã€‚&lt;/p&gt;
&lt;p&gt;é¢˜ç›®ï¼š&lt;br&gt;Count the number of prime numbers less than a non-negative number, n.&lt;/p&gt;
&lt;p&gt;å°½ç®¡é¢˜ç›®å¹¶æ²¡æœ‰è¦æˆ‘ä»¬å†™ä¸€ä¸ªæœ€ä¼˜çš„ç®—æ³•ï¼Œä½†æ˜¯èº«ä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä¼˜åŒ–åº”è¯¥æ˜¯ä¸€ç§ä¹ æƒ¯ï¼Œåœ¨ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œéšç€æ€è€ƒè¿›è¡Œä¼˜åŒ–ã€‚åªè¦æ±‚æˆ‘ä»¬æ»¡è¶³ç»™å®šçš„æ—¶é—´å’Œç©ºé—´å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åªèƒ½æƒ³å‡ºä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ³•ï¼Œéš¾é“ä½ ä¼šæœ‰ä»€ä¹ˆç«äº‰åŠ›å—ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://www.morethink.cn/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="ç´ æ•°" scheme="https://www.morethink.cn/tags/%E7%B4%A0%E6%95%B0/"/>
    
  </entry>
  
</feed>
